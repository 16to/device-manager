# SSH终端快捷命令功能

## 功能概述

管理员可以创建最多5个自定义快捷命令按钮，所有用户在SSH终端窗口中可以直接点击这些按钮来快速执行常用命令。

## 功能特性

- ✅ 管理员可创建、编辑、删除快捷命令（最多5个）
- ✅ 自定义按钮名称、命令内容和描述
- ✅ 支持启用/禁用状态控制
- ✅ 支持排序控制按钮显示顺序
- ✅ 所有用户在SSH终端中可见并使用
- ✅ 支持单行或多行命令
- ✅ 实时更新，无需重启服务

## 使用方法

### 管理员配置快捷命令

1. **进入管理界面**
   - 以管理员身份登录系统
   - 点击顶部导航栏的 **"快捷命令"** 标签页

2. **创建快捷命令**
   - 点击 **"➕ 添加快捷命令"** 按钮
   - 填写以下信息：
     - **按钮名称**：显示在SSH终端按钮上的文字（最多20字符）
     - **命令内容**：要执行的命令（支持多行）
     - **命令描述**：可选，说明此命令的用途
     - **排序顺序**：数字越小越靠前（0-100）
     - **启用状态**：勾选后按钮才会在终端中显示
   - 点击 **"创建"** 保存

3. **编辑快捷命令**
   - 在命令列表中点击 **"✏️ 编辑"** 按钮
   - 修改相关信息后点击 **"保存"**

4. **删除快捷命令**
   - 在命令列表中点击 **"🗑️ 删除"** 按钮
   - 确认删除操作

### 用户使用快捷命令

1. **打开SSH终端**
   - 在设备列表中，点击设备的SSH连接按钮
   - SSH终端窗口会自动打开

2. **使用快捷按钮**
   - 在终端窗口底部会显示所有已启用的快捷命令按钮
   - 点击任意按钮，对应的命令会立即在终端中执行
   - 无需手动输入命令

## 配置示例

### 示例1：查看系统信息

- **按钮名称**：系统信息
- **命令内容**：`uname -a`
- **描述**：显示系统内核信息
- **排序**：1

### 示例2：查看磁盘使用

- **按钮名称**：磁盘空间
- **命令内容**：`df -h`
- **描述**：查看磁盘使用情况
- **排序**：2

### 示例3：查看进程

- **按钮名称**：进程列表
- **命令内容**：`ps aux | head -20`
- **描述**：显示前20个进程
- **排序**：3

### 示例4：清屏

- **按钮名称**：清屏
- **命令内容**：`clear`
- **描述**：清除终端屏幕
- **排序**：99

### 示例5：多行命令

- **按钮名称**：系统检查
- **命令内容**：
  ```bash
  echo "=== 系统信息 ==="
  uname -a
  echo ""
  echo "=== 磁盘空间 ==="
  df -h
  echo ""
  echo "=== 内存使用 ==="
  free -h
  ```
- **描述**：执行一系列系统检查命令
- **排序**：10

## 技术实现

### 数据库模型

新增 `QuickCommand` 模型（`quick_commands` 表）：

```python
class QuickCommand(db.Model):
    id              # 主键
    name            # 按钮显示名称
    command         # 要执行的命令
    description     # 命令描述
    order           # 排序顺序
    enabled         # 是否启用
    created_at      # 创建时间
    updated_at      # 更新时间
```

### API接口

#### 获取启用的快捷命令（所有用户）
```
GET /api/quick-commands
```

#### 获取所有快捷命令（管理员）
```
GET /api/quick-commands/all
Authorization: Bearer {token}
```

#### 创建快捷命令（管理员）
```
POST /api/quick-commands
Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "系统信息",
  "command": "uname -a",
  "description": "显示系统内核信息",
  "order": 1,
  "enabled": true
}
```

#### 更新快捷命令（管理员）
```
PUT /api/quick-commands/{command_id}
Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "系统信息",
  "command": "uname -a",
  "description": "显示系统内核信息",
  "order": 1,
  "enabled": true
}
```

#### 删除快捷命令（管理员）
```
DELETE /api/quick-commands/{command_id}
Authorization: Bearer {token}
```

### 前端集成

1. **管理界面**
   - 位置：顶部导航 → 快捷命令（仅管理员可见）
   - 功能：创建、编辑、删除快捷命令
   - 限制：最多5个命令

2. **SSH终端集成**
   - 位置：SSH终端窗口底部
   - 显示：所有启用的快捷命令按钮
   - 行为：点击按钮 → 发送命令到SSH会话

## 数据库迁移

### 新部署

运行初始化脚本会自动创建 `quick_commands` 表：

```bash
python3 init_db.py
```

### 已有系统升级

运行迁移脚本会自动添加新表：

```bash
cd /opt/device-manager
python3 migrate_db.py
```

或者：

```bash
python3 check_and_fix_db.py  # 仅添加缺失字段
```

## 注意事项

1. **命令安全性**
   - 管理员应谨慎配置命令，避免危险操作
   - 建议只添加只读查询命令
   - 避免添加可能破坏系统的命令

2. **命令格式**
   - 命令会自动添加换行符执行
   - 支持多行命令，每行会依次执行
   - 交互式命令可能无法正常工作（如 `vi`、`top` 等）

3. **数量限制**
   - 最多创建5个快捷命令
   - 超过限制时添加按钮会被禁用

4. **权限控制**
   - 只有管理员可以管理快捷命令
   - 所有登录用户都可以使用快捷命令
   - 命令执行使用当前SSH会话的权限

## 常见问题

### Q: 为什么限制只能创建5个命令？
A: 为了保持终端界面简洁，避免按钮过多影响用户体验。5个命令足以覆盖最常用的操作。

### Q: 可以为不同设备配置不同的快捷命令吗？
A: 当前版本的快捷命令是全局的，对所有设备生效。如需设备专属命令，可以在命令中使用条件判断。

### Q: 快捷命令支持参数吗？
A: 当前版本不支持动态参数。命令是固定的，点击后会原样执行。

### Q: 修改快捷命令后需要重启服务吗？
A: 不需要。修改会立即生效，用户下次打开SSH终端时会看到更新后的按钮。

### Q: 快捷命令可以执行需要确认的命令吗？
A: 可以，但建议避免。例如 `rm` 等需要确认的命令可能会在终端中等待用户输入。

## 更新日志

### 2026-01-20
- ✨ 新增快捷命令管理功能
- ✨ 支持管理员创建、编辑、删除快捷命令
- ✨ SSH终端集成快捷按钮
- ✨ 支持命令启用/禁用和排序
- 📝 添加完整的API接口和文档
