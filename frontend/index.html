<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÆæÂ§á‰ΩøÁî®ÁÆ°ÁêÜÁ≥ªÁªü</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="static/js/vue.global.js"></script>
    <script src="static/js/axios.min.js"></script>
    <script src="static/js/socket.io.min.js"></script>
    <!-- Xterm.js -->
    <link rel="stylesheet" href="static/css/xterm.min.css" />
    <script src="static/js/xterm.min.js"></script>
    <script src="static/js/xterm-addon-fit.min.js"></script>
    <!-- XLSX for Excel import/export -->
    <script src="static/js/xlsx.full.min.js"></script>
    <!-- Chart.js for charts -->
    <script src="static/js/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(168, 85, 247, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        #app {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* ÁôªÂΩïÂºπÁ™óË°®ÂçïÊ†∑Âºè */
        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-form label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .login-form input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
            box-sizing: border-box;
            background: #f7fafc;
        }

        .login-form input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* ÂØÜÁ†ÅËæìÂÖ•Ê°ÜÂÆπÂô® */
        .password-input-wrapper {
            position: relative;
        }

        .password-input-wrapper input {
            padding-right: 45px;
        }

        /* ÂØÜÁ†ÅÊòæÁ§∫/ÈöêËóèÊåâÈíÆ */
        .password-toggle-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #999;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s;
        }

        .password-toggle-btn:hover {
            color: #667eea;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 24px 32px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: #f7fafc;
            border-radius: 20px;
        }

        .user-info span {
            color: #666;
            font-size: 14px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            background: #667eea;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: #764ba2;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #f56565;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #e53e3e;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 12px;
            background: #f7fafc;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.online {
            background: #48bb78;
        }

        .status-dot.offline {
            background: #f56565;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* ÊêúÁ¥¢ÂíåËøáÊª§Âô®Ê†∑Âºè */
        /* Êï¥ÂêàÁöÑÂàóË°®Â§¥ÈÉ®Âå∫Âüü */
        .list-header-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .title-stats-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f4f8;
            gap: 20px;
        }

        .title-stats-row h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
            color: #2d3748;
            flex-shrink: 0;
        }

        .stats-inline-group {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-tags-row {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .header-search-box {
            flex: 1;
            max-width: 350px;
            position: relative;
        }

        .header-search-box input {
            width: 100%;
            padding: 8px 12px 8px 35px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        .header-search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .header-search-box .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
        }
        
        /* title-stats-row ‰∏≠ÁöÑÊåâÈíÆÊ†∑Âºè‰ºòÂåñ */
        .title-stats-row .btn {
            padding: 6px 12px;
            font-size: 13px;
            white-space: nowrap;
        }

        .stats-filter-row {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
            flex-wrap: wrap;
        }

        .inline-stat-card {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: #f7fafc;
            border-radius: 6px;
            border: 2px solid #e2e8f0;
        }

        .inline-stat-card.success {
            background: #f0fff4;
            border-color: #9ae6b4;
        }

        .inline-stat-card.danger {
            background: #fff5f5;
            border-color: #fc8181;
        }

        .inline-stat-card.warning {
            background: #fffaf0;
            border-color: #fbd38d;
        }

        .stat-label {
            font-size: 12px;
            color: #718096;
            font-weight: 500;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 700;
            color: #2d3748;
        }

        .inline-stat-card.success .stat-value {
            color: #38a169;
        }

        .inline-stat-card.danger .stat-value {
            color: #e53e3e;
        }

        .inline-stat-card.warning .stat-value {
            color: #dd6b20;
        }

        .filter-divider {
            width: 2px;
            height: 30px;
            background: #e2e8f0;
            margin: 0 5px;
        }

        .count-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            vertical-align: middle;
        }

        .search-filter-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .search-filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 0 0 350px;
            min-width: 280px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 10px 12px 10px 38px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: #f7fafc;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-select {
            padding: 7px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.5;
            cursor: pointer;
            background: white;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .tag-filter {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .tag-filter-label {
            color: #666;
            font-size: 13px;
            line-height: 1.5;
            font-weight: normal;
            margin-right: 5px;
        }

        .tag-chip {
            padding: 7px 14px;
            background: rgba(226, 232, 240, 0.6);
            backdrop-filter: blur(5px);
            border: 2px solid transparent;
            border-radius: 20px;
            font-size: 13px;
            line-height: 1.5;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag-chip:hover {
            background: rgba(203, 213, 224, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .tag-chip.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
        }

        .content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            color: #333;
            font-size: 24px;
        }
        
        /* section-header ‰∏≠ÁöÑÊåâÈíÆÊ†∑Âºè‰ºòÂåñ */
        .section-header .btn {
            padding: 6px 12px;
            font-size: 13px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5568d3 0%, #653a8b 100%);
        }

        .btn-primary:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #dd6b20 0%, #c05621 100%);
        }

        .btn-info {
            background: #4299e1;
            color: white;
        }

        .btn-info:hover {
            background: #3182ce;
        }

        .devices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .user-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .user-card:hover {
            border-color: #cbd5e0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .user-card-selected {
            border-color: #667eea !important;
            background: #f7f9ff !important;
        }

        .user-card-checkbox {
            position: absolute;
            top: 12px;
            right: 12px;
        }

        .user-card-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .user-card-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 10px;
        }

        .user-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .user-info {
            flex: 1;
            min-width: 0;
            padding-right: 25px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .user-name {
            font-size: 16px;
            font-weight: 700;
            color: #1a202c;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .user-account {
            font-size: 13px;
            color: #667eea;
            font-weight: 600;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .user-department-row {
            font-size: 13px;
            color: #4a5568;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .user-date {
            font-size: 11px;
            color: #a0aec0;
        }

        .user-meta {
            font-size: 12px;
            color: #718096;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .user-department {
            display: inline-block;
            padding: 2px 6px;
            background: #edf2f7;
            border-radius: 3px;
            font-size: 11px;
            color: #4a5568;
            word-wrap: break-word;
            word-break: break-all;
            line-height: 1.4;
        }

        .user-card-actions {
            display: flex;
            gap: 8px;
            padding-top: 10px;
            border-top: 1px solid #edf2f7;
            margin-top: auto;
        }

        .device-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            height: 400px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .device-card:hover {
            border-color: #cbd5e0;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transform: translateY(-4px);
        }
        
        .device-card.selected {
            border: 3px solid #667eea !important;
            background: #f7faff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        .device-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            cursor: pointer;
        }
        
        .device-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .device-card.available {
            border-left: 5px solid #48bb78;
            border-top-color: #48bb78;
        }

        .device-card.available:hover {
            border-color: #48bb78;
            box-shadow: 0 20px 25px -5px rgba(72, 187, 120, 0.2), 0 10px 10px -5px rgba(72, 187, 120, 0.1);
        }

        .device-card.occupied {
            border-left: 5px solid #f56565;
            border-top-color: #f56565;
            background: #fffafa;
        }

        .device-card.occupied:hover {
            border-color: #f56565;
            box-shadow: 0 20px 25px -5px rgba(245, 101, 101, 0.2), 0 10px 10px -5px rgba(245, 101, 101, 0.1);
        }

        .device-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 2px solid #edf2f7;
        }

        .device-name {
            font-size: 20px;
            font-weight: 700;
            color: #1a202c;
            letter-spacing: -0.5px;
        }

        .status-badge {
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            border: 2px solid;
        }

        .status-badge.available {
            background: #f0fff4;
            color: #22543d;
            border-color: #48bb78;
        }

        .status-badge.occupied {
            background: #fff5f5;
            color: #742a2a;
            border-color: #f56565;
        }

        .device-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .device-tag {
            padding: 4px 10px;
            background: #edf2f7;
            border-radius: 4px;
            font-size: 12px;
            color: #5a67d8;
            font-weight: 600;
            transition: all 0.2s;
        }

        .device-tag:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        .device-content-scroll {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
            padding-right: 8px;
            margin-right: -8px;
        }

        /* Ëá™ÂÆö‰πâÊªöÂä®Êù°Ê†∑Âºè */
        .device-content-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .device-content-scroll::-webkit-scrollbar-track {
            background: rgba(241, 241, 241, 0.5);
            border-radius: 3px;
        }

        .device-content-scroll::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #cbd5e0 0%, #a0aec0 100%);
            border-radius: 3px;
        }

        .device-content-scroll::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
        }

        .device-info p {
            color: #4a5568;
            margin: 6px 0;
            font-size: 14px;
            line-height: 1.5;
        }

        .device-info p strong {
            color: #1a202c;
            font-weight: 600;
            min-width: 70px;
            display: inline-block;
        }

        .password-row {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .password-row span {
            flex-shrink: 0;
        }

        .icon-btn-inline {
            padding: 2px 6px !important;
            font-size: 14px !important;
            line-height: 1 !important;
            vertical-align: middle;
        }

        .device-connections {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px solid #edf2f7;
        }

        .device-connections > p {
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .connection-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 6px 0;
            padding: 6px 8px;
            background: #f7fafc;
            border-radius: 6px;
            font-size: 13px;
            transition: background 0.2s;
        }

        .connection-item:hover {
            background: #edf2f7;
        }

        .connection-item span {
            color: #4a5568;
            font-weight: 500;
        }

        .connection-btn {
            padding: 6px 14px;
            font-size: 12px;
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(66, 153, 225, 0.25);
        }

        .connection-btn:hover {
            background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.35);
        }

        .device-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
            padding-top: 14px;
            border-top: 2px solid #edf2f7;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .device-actions button {
            flex: 1;
            min-width: 80px;
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 600;
        }

        .icon-btn {
            background: #edf2f7;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            font-size: 16px;
            padding: 5px 8px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: #667eea;
            border-color: #667eea;
            transform: scale(1.1);
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        .icon-btn:active {
            transform: scale(1.05);
        }

        /* ÂºπÁ™óÈÅÆÁΩ©Â±Ç */
        .modal, .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: #333;
            font-size: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            line-height: 1;
            transition: color 0.3s;
            position: relative;
            z-index: 10;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .connection-list {
            margin-top: 10px;
        }

        .connection-entry {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: flex-end;
        }

        .connection-entry button {
            padding: 10px 15px;
            min-width: auto;
        }

        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            min-height: 45px;
        }

        .tags-input:focus-within {
            border-color: #667eea;
        }

        .tag-item {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border-radius: 15px;
            font-size: 13px;
        }

        .tag-item button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            padding: 0;
        }

        .tag-input-field {
            flex: 1;
            border: none;
            outline: none;
            padding: 5px;
            min-width: 100px;
        }

        .purpose-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .suggestion-chip {
            padding: 6px 12px;
            background: #edf2f7;
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .suggestion-chip:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Ëá™ÂÆö‰πâÁ°ÆËÆ§ÂØπËØùÊ°Ü */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s;
        }

        .confirm-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: slideIn 0.3s;
        }

        .confirm-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .confirm-icon.warning {
            color: #ed8936;
        }

        .confirm-icon.success {
            color: #48bb78;
        }

        .confirm-icon.error {
            color: #f56565;
        }

        .confirm-icon.info {
            color: #4299e1;
        }

        .confirm-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .confirm-message {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .confirm-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        table th {
            background: #f7fafc;
            color: #333;
            font-weight: 600;
        }

        table th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            transition: background 0.2s;
        }

        table th.sortable:hover {
            background: #edf2f7;
        }

        .sort-icon {
            margin-left: 5px;
            color: #667eea;
            font-weight: bold;
        }

        table tr:hover {
            background: #f7fafc;
        }
        
        .record-filters {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .filter-row {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .record-search {
            flex: 1;
            min-width: 250px;
            padding: 10px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: #f7fafc;
            transition: all 0.3s;
        }
        
        .record-search:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .filter-select {
            padding: 10px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: #f7fafc;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn-secondary {
            background: #edf2f7;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
            border-color: #cbd5e0;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .ranking-list {
            list-style: none;
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .ranking-item:last-child {
            border-bottom: none;
        }

        .ranking-number {
            font-weight: bold;
            color: #667eea;
            margin-right: 15px;
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-count {
            color: #999;
            font-size: 14px;
        }

        /* WebÁªàÁ´ØÊ†∑Âºè */
        .terminal-modal {
            z-index: 10000;
            animation: none;
            display: block;
        }

        .terminal-modal .modal-content {
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            padding: 0;
            background: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
        }

        .terminal-modal .modal-content.maximized {
            max-width: 100%;
            width: 100vw !important;
            max-height: 100vh;
            height: 100vh !important;
            border-radius: 0;
            top: 0 !important;
            left: 0 !important;
            transform: none !important;
            display: flex;
            flex-direction: column;
        }

        .terminal-modal .modal-header {
            background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
            padding: 15px 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
            height: 51px;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .terminal-modal .modal-header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .terminal-modal .maximize-btn {
            color: #999;
            font-size: 16px;
            padding: 0 10px;
            cursor: pointer;
            background: none;
            border: none;
        }

        .terminal-modal .maximize-btn:hover {
            color: #fff;
        }

        .terminal-modal .modal-header h3 {
            margin: 0;
            font-size: 16px;
            color: #fff;
            font-weight: 500;
        }

        .terminal-modal .close-btn {
            color: #999;
            font-size: 20px;
            padding: 0 10px;
        }

        .terminal-modal .close-btn:hover {
            color: #fff;
        }

        .terminal-container {
            background: #000;
            height: 600px;
            width: 100%;
            overflow: hidden;
            position: relative;
            transition: background-color 0.3s;
            flex: 1;
            min-height: 0;
        }

        .terminal-container.drag-over {
            background: rgba(102, 126, 234, 0.1);
            outline: 2px dashed #667eea;
            outline-offset: -10px;
        }

        .terminal-container.drag-over::after {
            content: 'üìÅ ÊãñÊîæÊñá‰ª∂Âà∞ËøôÈáå‰∏ä‰º†';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #667eea;
            font-size: 18px;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 40px;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
        }

        .terminal-modal .modal-content.maximized .terminal-container {
            height: calc(100vh - 51px);
            width: 100%;
            flex: 1;
        }

        /* xterm.js Ê†∑ÂºèË∞ÉÊï¥ */
        #xterm-container {
            height: 100%;
            width: 100%;
            padding: 0;
        }

        #xterm-container .xterm {
            height: 100% !important;
            width: 100% !important;
            padding: 15px;
        }
        
        #xterm-container .xterm-viewport {
            background-color: #000 !important;
            width: 100% !important;
        }

        #xterm-container .xterm-screen {
            height: 100%;
            width: 100% !important;
        }

        .upload-area {
            margin-top: 15px;
            padding: 20px;
            border: 2px dashed #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: #edf2f7;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ÁÆ°ÁêÜÂëòÁôªÂΩïÂºπÁ™ó -->
        <div v-if="showLoginModal" class="modal-overlay">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h3>üîê ÁÆ°ÁêÜÂëòÁôªÂΩï</h3>
                    <button class="close-btn" @click="showLoginModal = false">‚úï</button>
                </div>
                <div class="modal-body">
                    <form class="login-form" @submit.prevent="login">
                        <div class="form-group">
                            <label>Áî®Êà∑Âêç</label>
                            <input v-model="loginForm.username" type="text" placeholder="ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòÁî®Êà∑Âêç" required>
                        </div>
                        <div class="form-group">
                            <label>ÂØÜÁ†Å</label>
                            <input v-model="loginForm.password" type="password" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">ÁôªÂΩï</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ÊôÆÈÄöÁî®Êà∑ÁôªÂΩïÂºπÁ™ó -->
        <div v-if="showUserLoginModal" class="modal-overlay">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h3>üë§ Áî®Êà∑ÁôªÂΩï</h3>
                    <button class="close-btn" @click="showUserLoginModal = false">‚úï</button>
                </div>
                <div class="modal-body">
                    <form class="login-form" @submit.prevent="userLogin">
                        <div class="form-group">
                            <label>Ë¥¶Âè∑</label>
                            <input v-model="userLoginForm.account" type="text" placeholder="ËØ∑ËæìÂÖ•Ë¥¶Âè∑" required>
                        </div>
                        <div class="form-group">
                            <label>ÂØÜÁ†Å</label>
                            <input v-model="userLoginForm.password" type="password" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" required>
                        </div>
                        <div style="margin-top: 10px; color: #999; font-size: 13px;">
                            <p>üí° È¶ñÊ¨°ÁôªÂΩïÈªòËÆ§ÂØÜÁ†ÅÔºö123456</p>
                            <p style="margin-top: 5px;">ÁôªÂΩïÂêéÂèØÂú®Âè≥‰∏äËßí‰øÆÊîπÂØÜÁ†Å</p>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">ÁôªÂΩï</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ‰øÆÊîπÂØÜÁ†ÅÂºπÁ™ó -->
        <div v-if="showChangePasswordModal" class="modal-overlay">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h3>üîë ‰øÆÊîπÂØÜÁ†Å</h3>
                    <button class="close-btn" @click="closeChangePasswordModal">‚úï</button>
                </div>
                <div class="modal-body">
                    <form class="login-form" @submit.prevent="changePassword">
                        <div class="form-group">
                            <label>ÂéüÂØÜÁ†Å</label>
                            <div class="password-input-wrapper">
                                <input v-model="passwordForm.oldPassword" :type="showOldPassword ? 'text' : 'password'" placeholder="ËØ∑ËæìÂÖ•ÂéüÂØÜÁ†Å" required>
                                <button type="button" class="password-toggle-btn" @click="showOldPassword = !showOldPassword" :title="showOldPassword ? 'ÈöêËóèÂØÜÁ†Å' : 'ÊòæÁ§∫ÂØÜÁ†Å'">
                                    {{ showOldPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Êñ∞ÂØÜÁ†Å</label>
                            <div class="password-input-wrapper">
                                <input v-model="passwordForm.newPassword" :type="showNewPassword ? 'text' : 'password'" placeholder="ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†ÅÔºàËá≥Â∞ë6‰ΩçÔºâ" required minlength="6">
                                <button type="button" class="password-toggle-btn" @click="showNewPassword = !showNewPassword" :title="showNewPassword ? 'ÈöêËóèÂØÜÁ†Å' : 'ÊòæÁ§∫ÂØÜÁ†Å'">
                                    {{ showNewPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Á°ÆËÆ§Êñ∞ÂØÜÁ†Å</label>
                            <div class="password-input-wrapper">
                                <input v-model="passwordForm.confirmPassword" :type="showConfirmPassword ? 'text' : 'password'" placeholder="ËØ∑ÂÜçÊ¨°ËæìÂÖ•Êñ∞ÂØÜÁ†Å" required minlength="6">
                                <button type="button" class="password-toggle-btn" @click="showConfirmPassword = !showConfirmPassword" :title="showConfirmPassword ? 'ÈöêËóèÂØÜÁ†Å' : 'ÊòæÁ§∫ÂØÜÁ†Å'">
                                    {{ showConfirmPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
                                </button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" class="btn btn-secondary" style="flex: 1;" @click="closeChangePasswordModal">ÂèñÊ∂à</button>
                            <button type="submit" class="btn btn-primary" style="flex: 1;">Á°ÆËÆ§‰øÆÊîπ</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Ê∑ªÂä†Áî®Êà∑Ê®°ÊÄÅÊ°Ü -->
        <div v-if="showAddUserModal" class="modal-overlay">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h3>‚ûï Ê∑ªÂä†ÊéàÊùÉÁî®Êà∑</h3>
                    <button class="close-btn" @click="closeAddUserModal">‚úï</button>
                </div>
                <div class="modal-body">
                    <form @submit.prevent="addUser">
                        <div class="form-group">
                            <label>Ë¥¶Âè∑ *</label>
                            <input v-model="newUserForm.account" type="text" placeholder="ËØ∑ËæìÂÖ•Ë¥¶Âè∑ÔºàËã±ÊñáÊàñÊãºÈü≥Ôºâ" required>
                        </div>
                        <div class="form-group">
                            <label>‰∏≠ÊñáÂêç *</label>
                            <input v-model="newUserForm.chinese_name" type="text" placeholder="ËØ∑ËæìÂÖ•‰∏≠ÊñáÂêç" required>
                        </div>
                        <div class="form-group">
                            <label>ÈÉ®Èó®</label>
                            <input v-model="newUserForm.department" type="text" placeholder="ËØ∑ËæìÂÖ•ÈÉ®Èó®ÔºàÂèØÈÄâÔºâ">
                        </div>
                        <div class="form-group">
                            <label>ÂØÜÁ†Å</label>
                            <input v-model="newUserForm.password" type="text" placeholder="‰∏çÂ°´Âàô‰ΩøÁî®ÈªòËÆ§ÂØÜÁ†Å123456" minlength="6">
                            <small style="color: #999; margin-top: 5px; display: block;">ÂØÜÁ†ÅËá≥Â∞ë6‰ΩçÔºå‰∏çÂ°´ÂÜôÂàôÈªòËÆ§‰∏∫123456</small>
                        </div>
                        <small style="color: #999; margin-top: 5px; display: block;">Âè™ÊúâÂú®Ê≠§ÂàóË°®‰∏≠ÁöÑË¥¶Âè∑ÊâçËÉΩÂç†Áî®ËÆæÂ§á</small>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" class="btn btn-secondary" style="flex: 1;" @click="closeAddUserModal">ÂèñÊ∂à</button>
                            <button type="submit" class="btn btn-primary" style="flex: 1;">Ê∑ªÂä†</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ÁôªÂΩïÊ¨¢ËøéÈ°µÈù¢ -->
        <div v-if="!isInitialized" style="display: flex; align-items: center; justify-content: center; min-height: 80vh;">
            <div style="background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 60px; max-width: 480px; width: 100%;">
                <div style="text-align: center;">
                    <div style="font-size: 64px; margin-bottom: 20px;">üñ•Ô∏è</div>
                    <h1 style="color: #333; margin-bottom: 10px; font-size: 32px;">ËÆæÂ§á‰ΩøÁî®ÁÆ°ÁêÜÁ≥ªÁªü</h1>
                    <p style="color: #666; margin-bottom: 30px; font-size: 16px;">{{ loginPageMode === 'user' ? 'Áî®Êà∑ÁôªÂΩï' : 'ÁÆ°ÁêÜÂëòÁôªÂΩï' }}</p>
                </div>
                
                <!-- Áî®Êà∑ÁôªÂΩïË°®Âçï -->
                <form v-if="loginPageMode === 'user'" @submit.prevent="userLogin" class="login-form">
                    <div class="form-group">
                        <label>Ë¥¶Âè∑</label>
                        <input v-model="userLoginForm.account" type="text" placeholder="ËØ∑ËæìÂÖ•Ë¥¶Âè∑" required autofocus>
                    </div>
                    <div class="form-group">
                        <label>ÂØÜÁ†Å</label>
                        <div class="password-input-wrapper">
                            <input v-model="userLoginForm.password" :type="showUserLoginPassword ? 'text' : 'password'" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" required>
                            <button type="button" class="password-toggle-btn" @click="showUserLoginPassword = !showUserLoginPassword" :title="showUserLoginPassword ? 'ÈöêËóèÂØÜÁ†Å' : 'ÊòæÁ§∫ÂØÜÁ†Å'">
                                {{ showUserLoginPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
                            </button>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px; font-size: 16px;">ÁôªÂΩï</button>
                    </div>
                    <div style="text-align: center;">
                        <a href="javascript:void(0)" @click="switchLoginMode('admin')" style="color: #667eea; text-decoration: none; font-size: 14px;">ÂàáÊç¢Âà∞ÁÆ°ÁêÜÂëòÁôªÂΩï</a>
                    </div>
                </form>
                
                <!-- ÁÆ°ÁêÜÂëòÁôªÂΩïË°®Âçï -->
                <form v-else @submit.prevent="login" class="login-form">
                    <div class="form-group">
                        <label>Áî®Êà∑Âêç</label>
                        <input v-model="loginForm.username" type="text" placeholder="ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòË¥¶Âè∑" required autofocus>
                    </div>
                    <div class="form-group">
                        <label>ÂØÜÁ†Å</label>
                        <div class="password-input-wrapper">
                            <input v-model="loginForm.password" :type="showAdminLoginPassword ? 'text' : 'password'" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" required>
                            <button type="button" class="password-toggle-btn" @click="showAdminLoginPassword = !showAdminLoginPassword" :title="showAdminLoginPassword ? 'ÈöêËóèÂØÜÁ†Å' : 'ÊòæÁ§∫ÂØÜÁ†Å'">
                                {{ showAdminLoginPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
                            </button>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px; font-size: 16px;">ÁôªÂΩï</button>
                    </div>
                    <div style="text-align: center;">
                        <a href="javascript:void(0)" @click="switchLoginMode('user')" style="color: #667eea; text-decoration: none; font-size: 14px;">ÂàáÊç¢Âà∞Áî®Êà∑ÁôªÂΩï</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- ‰∏ªÁïåÈù¢ -->
        <div v-if="isInitialized">
            <div class="header">
                <h1>üñ•Ô∏è ËÆæÂ§á‰ΩøÁî®ÁÆ°ÁêÜÁ≥ªÁªü</h1>
                <div class="header-right">
                    <div class="connection-status">
                        <div class="status-dot" :class="connectionStatus === 'online' ? 'online' : 'offline'"></div>
                        <span>{{ connectionStatus === 'online' ? 'Â∑≤ËøûÊé•' : (connectionStatus === 'offline' ? 'Êú™ËøûÊé•' : 'Ê£ÄÊü•‰∏≠...') }}</span>
                    </div>
                    <div class="user-info" v-if="isLoggedIn">
                        <span>üë§ {{ currentUser.chinese_name || currentUser.username }} ({{ currentUser.username }})</span>
                        <span v-if="currentUser.is_admin" style="color: #667eea; font-weight: bold;">ÁÆ°ÁêÜÂëò</span>
                    </div>
                    <div class="nav-tabs">
                        <button class="nav-btn" :class="{active: currentView === 'devices'}" @click="currentView = 'devices'">ËÆæÂ§áÂàóË°®</button>
                        <button class="nav-btn" :class="{active: currentView === 'records'}" @click="currentView = 'records'">‰ΩøÁî®ËÆ∞ÂΩï</button>
                        <button class="nav-btn" :class="{active: currentView === 'users'}" @click="currentView = 'users'" v-if="isLoggedIn && currentUser.is_admin">Áî®Êà∑ÁÆ°ÁêÜ</button>
                        <button class="nav-btn" :class="{active: currentView === 'statistics'}" @click="currentView = 'statistics'">ÁªüËÆ°Êä•Ë°®</button>
                    </div>
                    <div v-if="!isLoggedIn" style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" @click="showUserLoginModal = true">Áî®Êà∑ÁôªÂΩï</button>
                        <button class="btn btn-secondary" @click="showLoginModal = true">ÁÆ°ÁêÜÂëòÁôªÂΩï</button>
                    </div>
                    <div v-else style="display: flex; gap: 10px; align-items: center;">
                        <button v-if="!currentUser.is_admin" class="btn btn-secondary" @click="showChangePasswordModal = true" style="font-size: 14px; padding: 8px 16px;">‰øÆÊîπÂØÜÁ†Å</button>
                        <button class="logout-btn" @click="logout">ÈÄÄÂá∫ÁôªÂΩï</button>
                    </div>
                </div>
            </div>

            <!-- ËÆæÂ§áÂàóË°®ËßÜÂõæ -->
            <template v-if="currentView === 'devices'">
                <div class="content">
                    <!-- Êï¥ÂêàÁöÑÊ†áÈ¢òÂíåÁªüËÆ°Âç°Áâá -->
                    <div class="list-header-section">
                        <!-- Á¨¨‰∏ÄË°åÔºöÊ†áÈ¢ò + ÁªüËÆ°Âç°Áâá + ÊåâÈíÆ -->
                        <div class="title-stats-row" v-if="statistics">
                            <h2>ËÆæÂ§áÂàóË°® <span class="count-badge">{{ filteredDevices.length }}</span></h2>
                            
                            <div class="stats-inline-group">
                                <div class="inline-stat-card">
                                    <span class="stat-label">ÊÄªËÆæÂ§á</span>
                                    <span class="stat-value">{{ statistics.total_devices }}</span>
                                </div>
                                <div class="inline-stat-card success">
                                    <span class="stat-label">Á©∫Èó≤</span>
                                    <span class="stat-value">{{ statistics.available_devices }}</span>
                                </div>
                                <div class="inline-stat-card danger">
                                    <span class="stat-label">Âç†Áî®</span>
                                    <span class="stat-value">{{ statistics.occupied_devices }}</span>
                                </div>
                                <div class="inline-stat-card warning">
                                    <span class="stat-label">ËÆ∞ÂΩï</span>
                                    <span class="stat-value">{{ statistics.total_records }}</span>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn btn-primary" @click="showAddDeviceModal">‚ûï Ê∑ªÂä†ËÆæÂ§á</button>
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn btn-secondary" @click="exportDevicesToExcel">üì• ÂØºÂá∫Excel</button>
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn btn-secondary" @click="triggerDeviceExcelUpload">üì§ ÂØºÂÖ•Excel</button>
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn" style="background: #48bb78; color: white;" @click="downloadDeviceExcelTemplate">üìÑ ‰∏ãËΩΩÊ®°Êùø</button>
                                <input type="file" ref="deviceExcelInput" @change="handleDeviceExcelUpload" accept=".xlsx,.xls" style="display: none;">
                                
                                <!-- ÊâπÈáèÂà†Èô§ÊåâÈíÆ -->
                                <div v-if="isLoggedIn && currentUser.is_admin" style="display: flex; gap: 10px; margin-left: auto;">
                                    <button v-if="!bulkDeleteMode" class="btn" style="background: #f56565; color: white;" @click="toggleBulkDeleteMode">
                                        üóëÔ∏è ÊâπÈáèÂà†Èô§
                                    </button>
                                    <template v-else>
                                        <button class="btn" style="background: #667eea; color: white;" @click="selectAllDevices">
                                            {{ selectedDeviceIds.length === filteredDevices.length ? 'ÂèñÊ∂àÂÖ®ÈÄâ' : 'ÂÖ®ÈÄâ' }}
                                        </button>
                                        <button class="btn" style="background: #f56565; color: white;" @click="batchDeleteDevices" :disabled="selectedDeviceIds.length === 0">
                                            üóëÔ∏è Âà†Èô§ÈÄâ‰∏≠ ({{ selectedDeviceIds.length }})
                                        </button>
                                        <button class="btn btn-secondary" @click="toggleBulkDeleteMode">
                                            ÂèñÊ∂à
                                        </button>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Á¨¨‰∫åË°åÔºöÁä∂ÊÄÅËøáÊª§ + Êú¨‰∫∫Âç†Áî®Á≠õÈÄâ + Ê†áÁ≠æÁ≠õÈÄâ -->
                        <div class="filter-tags-row">
                            <div class="filter-group">
                                <label style="font-size: 13px; color: #666; margin-right: 10px; line-height: 1.5;">Áä∂ÊÄÅÁ≠õÈÄâÔºö</label>
                                <select v-model="statusFilter" class="filter-select">
                                    <option value="">ÂÖ®ÈÉ®Áä∂ÊÄÅ</option>
                                    <option value="available">Á©∫Èó≤</option>
                                    <option value="occupied">Âç†Áî®</option>
                                </select>
                            </div>
                            
                            <div v-if="isLoggedIn" class="filter-group">
                                <label style="font-size: 13px; color: #666; margin-right: 10px; line-height: 1.5;">Âç†Áî®Á≠õÈÄâÔºö</label>
                                <select v-model="occupiedByMeFilter" class="filter-select">
                                    <option value="">ÂÖ®ÈÉ®ËÆæÂ§á</option>
                                    <option value="yes">Êú¨‰∫∫Âç†Áî®</option>
                                    <option value="no">ÈùûÊú¨‰∫∫Âç†Áî®</option>
                                </select>
                            </div>
                            
                            <div v-if="allTags.length > 0" class="tag-filter">
                                <span class="tag-filter-label">Ê†áÁ≠æÁ≠õÈÄâÔºö</span>
                                <div class="tag-chip" 
                                     v-for="tag in allTags" 
                                     :key="tag"
                                     :class="{active: selectedTags.includes(tag)}"
                                     @click="toggleTagFilter(tag)">
                                    {{ tag }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div v-if="filteredDevices.length === 0" class="empty-state">
                        <div class="empty-state-icon">{{ connectionStatus === 'offline' ? '‚ö†Ô∏è' : 'üì¶' }}</div>
                        <p v-if="connectionStatus === 'offline'">
                            Êó†Ê≥ïËøûÊé•Âà∞ÂêéÁ´ØÊúçÂä°Âô®<br>
                            <small style="color: #999;">ËØ∑Á°Æ‰øùÂêéÁ´ØÊúçÂä°Â∑≤ÂêØÂä®ÔºàÁ´ØÂè£5001Ôºâ</small>
                        </p>
                        <p v-else>{{ searchQuery || statusFilter || selectedTags.length ? 'Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑËÆæÂ§á' : 'ËøòÊ≤°ÊúâËÆæÂ§áÔºåÁÇπÂáª‰∏äÊñπÊåâÈíÆÊ∑ªÂä†Á¨¨‰∏ÄÂè∞ËÆæÂ§áÂêßÔºÅ' }}</p>
                        <button v-if="connectionStatus === 'offline'" class="btn btn-primary" @click="retryConnection" style="margin-top: 15px;">üîÑ ÈáçËØïËøûÊé•</button>
                    </div>

                    <div v-else class="devices-grid">
                        <div v-for="device in filteredDevices" :key="device.id" 
                             class="device-card" 
                             :class="[device.status, { 'selected': bulkDeleteMode && selectedDeviceIds.includes(device.id) }]">
                            <!-- ÊâπÈáèÂà†Èô§Ê®°Âºè‰∏ãÁöÑÂ§çÈÄâÊ°Ü -->
                            <div v-if="isLoggedIn && currentUser.is_admin && bulkDeleteMode" class="device-checkbox" @click.stop="toggleDeviceSelection(device.id)">
                                <input type="checkbox" :checked="selectedDeviceIds.includes(device.id)" @click.stop>
                            </div>
                            
                            <div class="device-header">
                                <div class="device-name">{{ device.name }}</div>
                                <span class="status-badge" :class="device.status">
                                    {{ device.status === 'available' ? 'Á©∫Èó≤' : 'Âç†Áî®' }}
                                </span>
                            </div>
                            
                            <div class="device-tags" v-if="device.tags && device.tags.length > 0">
                                <span class="device-tag" v-for="tag in device.tags" :key="tag">{{ tag }}</span>
                            </div>

                            <div class="device-content-scroll">
                                <div class="device-info">
                                    <p v-if="device.status === 'occupied'">
                                        <strong>‰ΩøÁî®ËÄÖÔºö</strong>
                                        <span>{{ device.current_user || 'Êú™Áü•' }}</span>
                                        <span v-if="device.current_user_account" style="color: #667eea; font-weight: 600; margin-left: 8px;">
                                            ({{ device.current_user_account }})
                                        </span>
                                    </p>
                                    <p v-if="device.status === 'occupied' && device.remaining_minutes > 0">
                                        <strong>Ââ©‰ΩôÊó∂Èó¥Ôºö</strong>
                                        <span style="color: #f56565; font-weight: bold;">
                                            {{ Math.floor(device.remaining_minutes / 60) }}Â∞èÊó∂{{ device.remaining_minutes % 60 }}ÂàÜÈíü
                                        </span>
                                    </p>
                                    <p><strong>Ë¥¶Âè∑Ôºö</strong>{{ device.username || 'Êú™ËÆæÁΩÆ' }}</p>
                                    <p class="password-row">
                                        <strong>ÂØÜÁ†ÅÔºö</strong>
                                        <span>{{ passwordVisible[device.id] ? (device.password || 'Êú™ËÆæÁΩÆ') : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' }}</span>
                                        <button @click="device.status === 'occupied' && device.current_user_account === currentUser.username ? togglePasswordVisibility(device.id) : null" 
                                                class="icon-btn icon-btn-inline" 
                                                :style="device.status === 'occupied' && device.current_user_account === currentUser.username ? '' : 'opacity: 0.5; cursor: not-allowed; pointer-events: auto;'"
                                                :title="device.status === 'occupied' && device.current_user_account === currentUser.username ? (passwordVisible[device.id] ? 'ÈöêËóèÂØÜÁ†Å' : 'ÊòæÁ§∫ÂØÜÁ†Å') : 'Âç†Áî®ÂêéÂèØËßÅ'">
                                            {{ passwordVisible[device.id] ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
                                        </button>
                                        <button @click="device.status === 'occupied' && device.current_user_account === currentUser.username ? copyPassword(device.password) : null" 
                                                class="icon-btn icon-btn-inline" 
                                                :style="device.status === 'occupied' && device.current_user_account === currentUser.username ? '' : 'opacity: 0.5; cursor: not-allowed; pointer-events: auto;'"
                                                :title="device.status === 'occupied' && device.current_user_account === currentUser.username ? 'Â§çÂà∂ÂØÜÁ†Å' : 'Âç†Áî®ÂêéÂèØËßÅ'">
                                            üìã
                                        </button>
                                    </p>
                                </div>

                                <!-- SSHÂíå‰∏≤Âè£ËøûÊé• -->
                                <div class="device-connections" v-if="device.ssh_connections && device.ssh_connections.length > 0">
                                    <p style="font-weight: bold; margin-bottom: 8px; font-size: 13px;">ËøûÊé•ÊñπÂºèÔºö</p>
                                    <div class="connection-item" v-for="(conn, idx) in device.ssh_connections" :key="'conn-'+idx">
                                        <span v-if="conn.type === 'SSH'">üñ•Ô∏è SSH: {{ conn.ip }}:{{ conn.port }}</span>
                                        <span v-else-if="conn.type === 'Telnet'">üìü Telnet: {{ conn.ip }}:{{ conn.port }}</span>
                                        <span v-else>ÔøΩ {{ conn.type }}: {{ conn.ip }}:{{ conn.port }}</span>
                                        <button class="connection-btn" 
                                                @click="device.status === 'occupied' && device.current_user_account === currentUser.username ? openConnection(device, conn) : null"
                                                :style="device.status === 'occupied' && device.current_user_account === currentUser.username ? '' : 'opacity: 0.5; cursor: not-allowed; pointer-events: auto;'"
                                                :title="device.status === 'occupied' && device.current_user_account === currentUser.username ? 'ÁÇπÂáªËøûÊé•' : 'Âç†Áî®ÂêéÂèØËøûÊé•'">ËøûÊé•</button>
                                    </div>
                                </div>
                            </div>

                            <div class="device-actions">
                                <button v-if="device.status === 'available'" 
                                        class="btn btn-success" 
                                        @click="showOccupyModal(device)">
                                    Âç†Áî®
                                </button>
                                <button v-else-if="isLoggedIn && (currentUser.is_admin || device.current_user_account === currentUser.username)" 
                                        class="btn btn-warning" 
                                        @click="confirmAction('ÈáäÊîæËÆæÂ§á', 'Á°ÆÂÆöË¶ÅÈáäÊîæËøôÂè∞ËÆæÂ§áÂêóÔºü', () => releaseDevice(device.id))">
                                    ÈáäÊîæ
                                </button>
                                <button v-else-if="device.status === 'occupied'"
                                        class="btn btn-warning" 
                                        style="opacity: 0.5; cursor: not-allowed;"
                                        disabled
                                        title="Âè™ÊúâÂç†Áî®ËÄÖÊú¨‰∫∫ÊàñÁÆ°ÁêÜÂëòÊâçËÉΩÈáäÊîæ">
                                    ÈáäÊîæ
                                </button>
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn btn-primary" @click="showEditDeviceModal(device)">ÁºñËæë</button>
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn btn-danger" @click="confirmAction('Âà†Èô§ËÆæÂ§á', 'Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÂè∞ËÆæÂ§áÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ', () => deleteDevice(device.id))">Âà†Èô§</button>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <!-- ‰ΩøÁî®ËÆ∞ÂΩïËßÜÂõæ -->
            <div class="content" v-if="currentView === 'records'">
                <div class="section-header">
                    <h2>‰ΩøÁî®ËÆ∞ÂΩï</h2>
                    <span v-if="records.length > 200" style="font-size: 14px; color: #718096; font-weight: normal;">
                        ÔºàÊòæÁ§∫ÊúÄËøë 200 Êù°ËÆ∞ÂΩïÔºåÂÖ± {{ records.length }} Êù°Ôºâ
                    </span>
                </div>
                
                <!-- Á≠õÈÄâÂíåÊêúÁ¥¢ -->
                <div class="record-filters" v-if="records.length > 0">
                    <div class="filter-row">
                        <input 
                            v-model="recordSearchQuery" 
                            type="text" 
                            placeholder="üîç ÊêúÁ¥¢ËÆæÂ§á„ÄÅÁî®Êà∑ÊàñÁõÆÁöÑ..."
                            class="record-search">
                        
                        <select v-model="recordDeviceFilter" class="filter-select">
                            <option value="">ÊâÄÊúâËÆæÂ§á</option>
                            <option v-for="device in uniqueDeviceNames" :key="device" :value="device">
                                {{ device }}
                            </option>
                        </select>
                        
                        <select v-model="recordUserFilter" class="filter-select">
                            <option value="">ÊâÄÊúâÁî®Êà∑</option>
                            <option v-for="user in uniqueUserNames" :key="user" :value="user">
                                {{ user }}
                            </option>
                        </select>
                        
                        <button @click="recordSearchQuery = ''; recordDeviceFilter = ''; recordUserFilter = ''" 
                                class="btn btn-secondary"
                                style="padding: 8px 16px; font-size: 13px;">
                            üîÑ Ê∏ÖÁ©∫Á≠õÈÄâ
                        </button>
                    </div>
                </div>
                
                <div v-if="records.length === 0" class="empty-state">
                    <div class="empty-state-icon">üìù</div>
                    <p>ÊöÇÊó†‰ΩøÁî®ËÆ∞ÂΩï</p>
                </div>

                <table v-else-if="filteredRecords.length > 0">
                    <thead>
                        <tr>
                            <th @click="sortRecords('device_name')" class="sortable">
                                ËÆæÂ§áÂêçÁß∞
                                <span class="sort-icon" v-if="recordSortBy === 'device_name'">
                                    {{ recordSortOrder === 'asc' ? '‚Üë' : '‚Üì' }}
                                </span>
                            </th>
                            <th @click="sortRecords('user_name')" class="sortable">
                                ‰ΩøÁî®‰∫∫
                                <span class="sort-icon" v-if="recordSortBy === 'user_name'">
                                    {{ recordSortOrder === 'asc' ? '‚Üë' : '‚Üì' }}
                                </span>
                            </th>
                            <th>‰ΩøÁî®ÁõÆÁöÑ</th>
                            <th @click="sortRecords('start_time')" class="sortable">
                                ÂºÄÂßãÊó∂Èó¥
                                <span class="sort-icon" v-if="recordSortBy === 'start_time'">
                                    {{ recordSortOrder === 'asc' ? '‚Üë' : '‚Üì' }}
                                </span>
                            </th>
                            <th @click="sortRecords('end_time')" class="sortable">
                                ÁªìÊùüÊó∂Èó¥
                                <span class="sort-icon" v-if="recordSortBy === 'end_time'">
                                    {{ recordSortOrder === 'asc' ? '‚Üë' : '‚Üì' }}
                                </span>
                            </th>
                            <th @click="sortRecords('duration')" class="sortable">
                                ‰ΩøÁî®Êó∂Èïø(Â∞èÊó∂)
                                <span class="sort-icon" v-if="recordSortBy === 'duration'">
                                    {{ recordSortOrder === 'asc' ? '‚Üë' : '‚Üì' }}
                                </span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="record in filteredRecords" :key="record.id">
                            <td>{{ record.device_name }}</td>
                            <td>
                                {{ record.user_name }}
                                <span v-if="record.user_account" style="color: #667eea; font-weight: 600; margin-left: 8px;">
                                    ({{ record.user_account }})
                                </span>
                            </td>
                            <td>{{ record.purpose || '-' }}</td>
                            <td>{{ record.start_time }}</td>
                            <td>{{ record.end_time || '‰ΩøÁî®‰∏≠' }}</td>
                            <td>{{ record.duration }}</td>
                        </tr>
                    </tbody>
                </table>
                
                <div v-else class="empty-state">
                    <div class="empty-state-icon">üîç</div>
                    <p>Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑËÆ∞ÂΩï</p>
                </div>
            </div>

            <!-- Áî®Êà∑ÁÆ°ÁêÜËßÜÂõæ -->
            <div class="content" v-if="currentView === 'users' && isLoggedIn">
                <div class="section-header">
                    <h2>Áî®Êà∑ÁÆ°ÁêÜ <span class="count-badge">{{ allowedUsers.length }}</span></h2>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-primary" @click="showAddUserModal = true">‚ûï Ê∑ªÂä†Áî®Êà∑</button>
                        <button class="btn btn-secondary" @click="exportUsersToExcel">üì§ ÂØºÂá∫Excel</button>
                        <button class="btn btn-secondary" @click="triggerExcelUpload">üì§ ÂØºÂÖ•Excel</button>
                        <button class="btn" style="background: #48bb78; color: white;" @click="downloadExcelTemplate">üìÑ ‰∏ãËΩΩÊ®°Êùø</button>
                        <button class="btn btn-danger" @click="batchDeleteUsers" v-if="selectedUsers.length > 0">
                            üóëÔ∏è ÊâπÈáèÂà†Èô§ ({{ selectedUsers.length }})
                        </button>
                    </div>
                    <input type="file" ref="excelFileInput" @change="handleExcelUpload" accept=".xlsx,.xls" style="display: none;">
                </div>

                <div v-if="allowedUsers.length === 0" class="empty-state">
                    <div class="empty-state-icon">üë•</div>
                    <p>ËøòÊ≤°ÊúâÊéàÊùÉÁî®Êà∑</p>
                    <small style="color: #999; margin-top: 10px; display: block;">Ê∑ªÂä†Áî®Êà∑ÂêéÔºåÂè™ÊúâÂú®ÂàóË°®‰∏≠ÁöÑÁî®Êà∑ÊâçËÉΩÂç†Áî®ËÆæÂ§á</small>
                </div>

                <div v-else>
                    <div style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" @change="toggleSelectAll" :checked="isAllSelected">
                            <span>ÂÖ®ÈÄâ</span>
                        </label>
                        <span v-if="selectedUsers.length > 0" style="color: #667eea; font-weight: 600;">
                            Â∑≤ÈÄâÊã© {{ selectedUsers.length }} ‰∏™Áî®Êà∑
                        </span>
                    </div>
                    <div class="users-grid">
                    <div v-for="user in allowedUsers" :key="user.id" class="user-card" :class="{'user-card-selected': selectedUsers.includes(user.id)}">
                        <div class="user-card-checkbox">
                            <input type="checkbox" :value="user.id" v-model="selectedUsers">
                        </div>
                        <div class="user-card-header">
                            <div class="user-info">
                                <div class="user-name">{{ user.chinese_name }}</div>
                                <div class="user-account">Ë¥¶Âè∑: {{ user.account }}</div>
                                <div class="user-department-row">ÈÉ®Èó®: {{ user.department }}</div>
                                <div class="user-account" style="margin-top: 5px;">
                                    ÂØÜÁ†Å: {{ userPasswordVisible[user.id] ? user.password : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' }}
                                    <button @click="toggleUserPasswordVisibility(user.id)" 
                                            style="margin-left: 8px; padding: 2px 8px; font-size: 12px; border: none; background: #667eea; color: white; border-radius: 3px; cursor: pointer;">
                                        {{ userPasswordVisible[user.id] ? 'ÈöêËóè' : 'ÊòæÁ§∫' }}
                                    </button>
                                </div>
                                <div class="user-date">Ê∑ªÂä†‰∫é: {{ formatDateTime(user.created_at) }}</div>
                            </div>
                        </div>
                        <div class="user-card-actions">
                            <button class="btn btn-danger btn-sm" @click="deleteUser(user.id, user.account)">Âà†Èô§</button>
                        </div>
                    </div>
                </div>
                </div>
            </div>

            <!-- ÁªüËÆ°Êä•Ë°®ËßÜÂõæ -->
            <div class="content" v-if="currentView === 'statistics'">
                <div class="section-header">
                    <h2>ÁªüËÆ°Êä•Ë°®</h2>
                </div>
                
                <!-- È•ºÂõæÂå∫Âüü -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <!-- ËÆæÂ§á‰ΩøÁî®È•ºÂõæ -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 15px; color: #333;">üìä ËÆæÂ§á‰ΩøÁî®Âç†ÊØî</h3>
                        <div v-if="statistics && statistics.device_usage_ranking.length === 0" class="empty-state">
                            <div class="empty-state-icon">üìä</div>
                            <p>ÊöÇÊó†ÁªüËÆ°Êï∞ÊçÆ</p>
                        </div>
                        <div v-else style="position: relative; height: 300px;">
                            <canvas ref="devicePieChart"></canvas>
                        </div>
                    </div>

                    <!-- ‰ΩøÁî®‰∫∫Êó∂ÈïøÈ•ºÂõæ -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 15px; color: #333;">‚è±Ô∏è ‰ΩøÁî®‰∫∫Êó∂ÈïøÂç†ÊØî</h3>
                        <div v-if="statistics && statistics.user_duration_ranking.length === 0" class="empty-state">
                            <div class="empty-state-icon">‚è±Ô∏è</div>
                            <p>ÊöÇÊó†ÁªüËÆ°Êï∞ÊçÆ</p>
                        </div>
                        <div v-else style="position: relative; height: 300px;">
                            <canvas ref="userPieChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <!-- ËÆæÂ§á‰ΩøÁî®ÊéíË°åÊ¶ú -->
                    <div>
                        <h3 style="margin-bottom: 15px; color: #333;">üìä ËÆæÂ§á‰ΩøÁî®ÊéíË°åÊ¶ú TOP 10</h3>
                        
                        <div v-if="statistics && statistics.device_usage_ranking.length === 0" class="empty-state">
                            <div class="empty-state-icon">üìä</div>
                            <p>ÊöÇÊó†ÁªüËÆ°Êï∞ÊçÆ</p>
                        </div>

                        <ul v-else class="ranking-list">
                            <li v-for="(item, index) in statistics.device_usage_ranking" :key="index" class="ranking-item">
                                <span class="ranking-number">{{ index + 1 }}.</span>
                                <div class="ranking-info">
                                    <div><strong>{{ item.device_name }}</strong></div>
                                    <div class="ranking-count">‰ΩøÁî®Ê¨°Êï∞Ôºö{{ item.usage_count }} Ê¨°</div>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <!-- ‰ΩøÁî®‰∫∫Êó∂ÈïøÊéíË°åÊ¶ú -->
                    <div>
                        <h3 style="margin-bottom: 15px; color: #333;">‚è±Ô∏è ‰ΩøÁî®‰∫∫Êó∂ÈïøÊéíË°åÊ¶ú TOP 10</h3>
                        
                        <div v-if="statistics && statistics.user_duration_ranking.length === 0" class="empty-state">
                            <div class="empty-state-icon">‚è±Ô∏è</div>
                            <p>ÊöÇÊó†ÁªüËÆ°Êï∞ÊçÆ</p>
                        </div>

                        <ul v-else class="ranking-list">
                            <li v-for="(item, index) in statistics.user_duration_ranking" :key="index" class="ranking-item">
                                <span class="ranking-number">{{ index + 1 }}.</span>
                                <div class="ranking-info">
                                    <div><strong>{{ item.user_name }}</strong></div>
                                    <div class="ranking-count">‰ΩøÁî®Êó∂ÈïøÔºö{{ item.total_hours }} Â∞èÊó∂ ({{ item.usage_count }} Ê¨°)</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </template>

        <!-- Ê∑ªÂä†/ÁºñËæëËÆæÂ§áÊ®°ÊÄÅÊ°Ü -->
        <div v-if="showDeviceModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>{{ isEditing ? 'ÁºñËæëËÆæÂ§á' : 'Ê∑ªÂä†ËÆæÂ§á' }}</h3>
                    <button class="close-btn" @click="closeDeviceModal">√ó</button>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ËÆæÂ§áÂêçÁß∞ *</label>
                        <input v-model="deviceForm.name" placeholder="ËØ∑ËæìÂÖ•ËÆæÂ§áÂêçÁß∞">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ÁôªÂΩïË¥¶Âè∑</label>
                        <input v-model="deviceForm.username" placeholder="ËØ∑ËæìÂÖ•ÁôªÂΩïË¥¶Âè∑">
                    </div>
                    <div class="form-group">
                        <label>ÁôªÂΩïÂØÜÁ†Å</label>
                        <div class="password-input-wrapper">
                            <input v-model="deviceForm.password" :type="showDevicePassword ? 'text' : 'password'" placeholder="ËØ∑ËæìÂÖ•ÁôªÂΩïÂØÜÁ†Å">
                            <button type="button" class="password-toggle-btn" @click="showDevicePassword = !showDevicePassword" :title="showDevicePassword ? 'ÈöêËóèÂØÜÁ†Å' : 'ÊòæÁ§∫ÂØÜÁ†Å'">
                                {{ showDevicePassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
                            </button>
                        </div>
                    </div>
                </div>

                <!-- SSHËøûÊé•ÈÖçÁΩÆ -->
                <div class="form-group">
                    <label>SSHËøûÊé•</label>
                    <div class="connection-list">
                        <div class="connection-entry" v-for="(conn, idx) in deviceForm.ssh_connections" :key="'ssh-'+idx">
                            <div class="form-group" style="flex: 2; margin: 0;">
                                <input v-model="conn.ip" placeholder="IPÂú∞ÂùÄ">
                            </div>
                            <div class="form-group" style="flex: 1; margin: 0;">
                                <input v-model="conn.port" type="number" placeholder="Á´ØÂè£">
                            </div>
                            <button class="btn btn-danger" @click="deviceForm.ssh_connections.splice(idx, 1)">Âà†Èô§</button>
                        </div>
                        <button class="btn btn-primary" style="margin-top: 10px;" @click="deviceForm.ssh_connections.push({ip: '', port: 22})">+ Ê∑ªÂä†SSHËøûÊé•</button>
                    </div>
                </div>

                <!-- TelnetËøûÊé•ÈÖçÁΩÆ -->
                <div class="form-group">
                    <label>TelnetËøûÊé•</label>
                    <div class="connection-list">
                        <div class="connection-entry" v-for="(conn, idx) in deviceForm.telnet_connections" :key="'telnet-'+idx">
                            <div class="form-group" style="flex: 2; margin: 0;">
                                <input v-model="conn.ip" placeholder="IPÂú∞ÂùÄ">
                            </div>
                            <div class="form-group" style="flex: 1; margin: 0;">
                                <input v-model="conn.port" type="number" placeholder="Á´ØÂè£">
                            </div>
                            <button class="btn btn-danger" @click="deviceForm.telnet_connections.splice(idx, 1)">Âà†Èô§</button>
                        </div>
                        <button class="btn btn-primary" style="margin-top: 10px;" @click="deviceForm.telnet_connections.push({type: 'Telnet', ip: '', port: 23})">+ Ê∑ªÂä†TelnetËøûÊé•</button>
                    </div>
                </div>

                <!-- Ê†áÁ≠æ -->
                <div class="form-group">
                    <label>ËÆæÂ§áÊ†áÁ≠æ</label>
                    <div class="tags-input" @click="$refs.tagInput && $refs.tagInput.focus()">
                        <span class="tag-item" v-for="tag in deviceForm.tags" :key="tag">
                            {{ tag }}
                            <button @click="removeTag(tag)">√ó</button>
                        </span>
                        <input ref="tagInput" 
                               class="tag-input-field" 
                               v-model="newTag"
                               @keypress.enter.prevent="addTag"
                               @keypress.comma.prevent="addTag"
                               placeholder="ËæìÂÖ•Ê†áÁ≠æÂêéÊåâÂõûËΩ¶">
                    </div>
                    <small style="color: #999;">ÊåâÂõûËΩ¶ÊàñÈÄóÂè∑Ê∑ªÂä†Ê†áÁ≠æ</small>
                </div>

                <div class="form-actions">
                    <button class="btn btn-primary" @click="saveDevice">‰øùÂ≠ò</button>
                    <button class="btn" style="background: #ccc;" @click="closeDeviceModal">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>

        <!-- Âç†Áî®ËÆæÂ§áÊ®°ÊÄÅÊ°Ü -->
        <div v-if="showOccupyDeviceModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Âç†Áî®ËÆæÂ§áÔºö{{ occupyForm.deviceName }}</h3>
                    <button class="close-btn" @click="closeOccupyModal">√ó</button>
                </div>
                <div class="form-group">
                    <label>Ë¥¶Âè∑ *</label>
                    <input v-model="occupyForm.user_account" 
                           placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑË¥¶Âè∑"
                           :disabled="isLoggedIn && !currentUser.is_admin"
                           :style="(isLoggedIn && !currentUser.is_admin) ? 'background: #f0f0f0; cursor: not-allowed;' : ''">
                    <small style="color: #999; margin-top: 5px; display: block;">
                        {{ (isLoggedIn && !currentUser.is_admin) ? 'Â∑≤Ëá™Âä®Â°´ÂÖÖÊÇ®ÁöÑË¥¶Âè∑' : 'ËØ∑ËæìÂÖ•Â∑≤ÊéàÊùÉÁöÑË¥¶Âè∑' }}
                    </small>
                </div>
                <div class="form-group">
                    <label>Âç†Áî®Êó∂Èïø *</label>
                    <select v-model="occupyForm.duration" class="filter-select" style="width: 100%;">
                        <option :value="0.5">0.5Â∞èÊó∂</option>
                        <option :value="1">1Â∞èÊó∂</option>
                        <option :value="2">2Â∞èÊó∂ÔºàÈªòËÆ§Ôºâ</option>
                        <option :value="4">4Â∞èÊó∂</option>
                        <option :value="8">8Â∞èÊó∂</option>
                        <option :value="12">12Â∞èÊó∂</option>
                        <option :value="24">24Â∞èÊó∂</option>
                        <option :value="48">48Â∞èÊó∂</option>
                    </select>
                    <small style="color: #999;">ÊúÄÈïøÂèØÂç†Áî®48Â∞èÊó∂</small>
                </div>
                <div class="form-group">
                    <label>‰ΩøÁî®ÁõÆÁöÑ</label>
                    <textarea v-model="occupyForm.purpose" placeholder="ËØ∑ËæìÂÖ•‰ΩøÁî®ÁõÆÁöÑÔºàÂèØÈÄâÔºâ"></textarea>
                    <div class="purpose-suggestions">
                        <div class="suggestion-chip" 
                             v-for="suggestion in purposeSuggestions" 
                             :key="suggestion"
                             @click="occupyForm.purpose = suggestion">
                            {{ suggestion }}
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-success" @click="confirmOccupy">Á°ÆËÆ§Âç†Áî®</button>
                    <button class="btn" style="background: #ccc;" @click="closeOccupyModal">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>

        <!-- WebÁªàÁ´ØÊ®°ÊÄÅÊ°Ü -->
        <div v-if="showTerminalModal" class="modal terminal-modal">
            <div class="modal-content" :class="{ maximized: terminalMaximized }" ref="terminalModalContent">
                <div class="modal-header" @mousedown="startDragTerminal">
                    <h3>
                        <span style="margin-right: 10px;">üñ•Ô∏è</span>
                        {{ terminalInfo.title }}
                    </h3>
                    <div class="modal-header-buttons">
                        <button class="maximize-btn" @click="toggleMaximizeTerminal" :title="terminalMaximized ? 'ËøòÂéü' : 'ÊúÄÂ§ßÂåñ'">
                            <span v-if="terminalMaximized">‚ñ£</span>
                            <span v-else>‚ñ¢</span>
                        </button>
                        <button class="close-btn" @click="closeTerminal" title="ÂÖ≥Èó≠ÁªàÁ´Ø">√ó</button>
                    </div>
                </div>
                <div 
                    ref="terminalContainer"
                    id="xterm-container"
                    class="terminal-container"
                    @drop.prevent="handleTerminalFileDrop"
                    @dragover.prevent="handleTerminalDragOver"
                    @dragleave.prevent="handleTerminalDragLeave"
                >
                </div>
            </div>
        </div>

        </div><!-- ‰∏ªÁïåÈù¢ÁªìÊùü -->

        <!-- Ëá™ÂÆö‰πâÁ°ÆËÆ§ÂØπËØùÊ°Ü -->
        <div v-if="confirmDialog.show" class="confirm-dialog">
            <div class="confirm-box">
                <div class="confirm-icon" :class="confirmDialog.type">
                    {{ confirmDialog.icon }}
                </div>
                <div class="confirm-title">{{ confirmDialog.title }}</div>
                <div class="confirm-message">{{ confirmDialog.message }}</div>
                <div class="confirm-actions">
                    <button class="btn btn-primary" @click="confirmDialog.onConfirm(); confirmDialog.show = false">Á°ÆÂÆö</button>
                    <button class="btn" style="background: #ccc;" @click="confirmDialog.show = false">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>

        <!-- Ê∂àÊÅØÊèêÁ§∫ÂØπËØùÊ°Ü -->
        <div v-if="messageDialog.show" class="confirm-dialog" @click="messageDialog.show = false">
            <div class="confirm-box">
                <div class="confirm-icon" :class="messageDialog.type">
                    {{ messageDialog.icon }}
                </div>
                <div class="confirm-title">{{ messageDialog.title }}</div>
                <div class="confirm-message">{{ messageDialog.message }}</div>
                <div class="confirm-actions">
                    <button class="btn btn-primary" @click="messageDialog.show = false">Á°ÆÂÆö</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    isInitialized: false, // ÊòØÂê¶Â∑≤ÂàùÂßãÂåñÔºàÊòæÁ§∫‰∏ªÁïåÈù¢Ôºâ
                    loginPageMode: 'user', // ÁôªÂΩïÈ°µÊ®°ÂºèÔºö'user' Êàñ 'admin'
                    isLoggedIn: false,
                    currentUser: null,
                    showLoginModal: false,
                    showUserLoginModal: false,
                    showChangePasswordModal: false,
                    connectionStatus: 'checking', // online, offline, checking
                    
                    // ÂØÜÁ†ÅÂèØËßÅÊÄßÊéßÂà∂
                    showUserLoginPassword: false, // Áî®Êà∑ÁôªÂΩïÂØÜÁ†ÅÂèØËßÅ
                    showAdminLoginPassword: false, // ÁÆ°ÁêÜÂëòÁôªÂΩïÂØÜÁ†ÅÂèØËßÅ
                    showOldPassword: false, // ‰øÆÊîπÂØÜÁ†Å-ÂéüÂØÜÁ†ÅÂèØËßÅ
                    showNewPassword: false, // ‰øÆÊîπÂØÜÁ†Å-Êñ∞ÂØÜÁ†ÅÂèØËßÅ
                    showConfirmPassword: false, // ‰øÆÊîπÂØÜÁ†Å-Á°ÆËÆ§ÂØÜÁ†ÅÂèØËßÅ
                    showDevicePassword: false, // ËÆæÂ§áÂØÜÁ†ÅÂèØËßÅ
                    loginForm: {
                        username: '',
                        password: ''
                    },
                    userLoginForm: {
                        account: '',
                        password: ''
                    },
                    passwordForm: {
                        oldPassword: '',
                        newPassword: '',
                        confirmPassword: ''
                    },
                    currentView: 'devices',
                    devices: [],
                    records: [],
                    statistics: null,
                    
                    // ÂõæË°®ÂÆû‰æã
                    deviceChart: null,
                    userChart: null,
                    
                    // ÊêúÁ¥¢ÂíåËøáÊª§
                    searchQuery: '',
                    statusFilter: '',
                    occupiedByMeFilter: '', // Êú¨‰∫∫Âç†Áî®Á≠õÈÄâÔºö'' ÂÖ®ÈÉ®, 'yes' Êú¨‰∫∫Âç†Áî®, 'no' ÈùûÊú¨‰∫∫Âç†Áî®
                    selectedTags: [],
                    allTags: [],
                    
                    // ÂØÜÁ†ÅÊòæÁ§∫Áä∂ÊÄÅ
                    passwordVisible: {},
                    userPasswordVisible: {},
                    
                    // ‰ΩøÁî®ËÆ∞ÂΩïÁ≠õÈÄâÂíåÊéíÂ∫è
                    recordSearchQuery: '',
                    recordDeviceFilter: '',
                    recordUserFilter: '',
                    recordSortBy: 'start_time',
                    recordSortOrder: 'desc',
                    
                    showDeviceModal: false,
                    showOccupyDeviceModal: false,
                    showTerminalModal: false,
                    terminalMaximized: false,
                    terminalDragging: false,
                    terminalDragStart: { x: 0, y: 0 },
                    terminalPosition: { x: 0, y: 0 },
                    isEditing: false,
                    
                    deviceForm: {
                        id: null,
                        name: '',
                        ip: '',
                        username: '',
                        password: '',
                        ssh_connections: [],
                        telnet_connections: [],
                        tags: []
                    },
                    newTag: '',
                    
                    occupyForm: {
                        deviceId: null,
                        deviceName: '',
                        user_account: '',
                        purpose: '',
                        duration: 2
                    },
                    
                    purposeSuggestions: [
                        'ÂºÄÂèëÊµãËØï',
                        'ÊÄßËÉΩÊµãËØï',
                        'ÂäüËÉΩÈ™åËØÅ',
                        'ÊºîÁ§∫Â±ïÁ§∫',
                        'BugË∞ÉËØï',
                        'ÂéãÂäõÊµãËØï',
                        'ÂÖºÂÆπÊÄßÊµãËØï',
                        'Â≠¶‰π†Á†îÁ©∂'
                    ],
                    
                    // Áî®Êà∑ÁÆ°ÁêÜ
                    allowedUsers: [],
                    selectedUsers: [],
                    
                    // ÊâπÈáèÂà†Èô§ËÆæÂ§á
                    selectedDeviceIds: [],
                    bulkDeleteMode: false,
                    showAddUserModal: false,
                    newUserForm: {
                        account: '',
                        chinese_name: '',
                        department: '',
                        password: ''
                    },
                    
                    terminalInfo: {
                        title: '',
                        content: ''
                    },
                    
                    confirmDialog: {
                        show: false,
                        title: '',
                        message: '',
                        type: 'warning',
                        icon: '‚ö†Ô∏è',
                        onConfirm: () => {}
                    },
                    
                    messageDialog: {
                        show: false,
                        title: '',
                        message: '',
                        type: 'success',
                        icon: '‚úÖ'
                    },
                    
                    apiBaseUrl: '/api',
                    socket: null,
                    terminalSessionId: null,
                    terminalOutput: '',
                    // Xterm.js ÂÆû‰æã
                    term: null,
                    fitAddon: null
                };
            },
            computed: {
                filteredDevices() {
                    let filtered = this.devices;
                    
                    // ÊêúÁ¥¢ËøáÊª§
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        filtered = filtered.filter(d => 
                            d.name.toLowerCase().includes(query) ||
                            (d.model && d.model.toLowerCase().includes(query)) ||
                            (d.location && d.location.toLowerCase().includes(query))
                        );
                    }
                    
                    // Áä∂ÊÄÅËøáÊª§
                    if (this.statusFilter) {
                        filtered = filtered.filter(d => d.status === this.statusFilter);
                    }
                    
                    // Êú¨‰∫∫Âç†Áî®Á≠õÈÄâ
                    if (this.occupiedByMeFilter && this.isLoggedIn && this.currentUser) {
                        if (this.occupiedByMeFilter === 'yes') {
                            // Âè™ÊòæÁ§∫Êú¨‰∫∫Âç†Áî®ÁöÑËÆæÂ§á
                            filtered = filtered.filter(d => 
                                d.status === 'occupied' && d.current_user_account === this.currentUser.username
                            );
                        } else if (this.occupiedByMeFilter === 'no') {
                            // Âè™ÊòæÁ§∫ÈùûÊú¨‰∫∫Âç†Áî®ÁöÑËÆæÂ§áÔºàÁ©∫Èó≤ÊàñÂÖ∂‰ªñ‰∫∫Âç†Áî®Ôºâ
                            filtered = filtered.filter(d => 
                                d.status === 'available' || d.current_user_account !== this.currentUser.username
                            );
                        }
                    }
                    
                    // Ê†áÁ≠æËøáÊª§
                    if (this.selectedTags.length > 0) {
                        filtered = filtered.filter(d => 
                            d.tags && this.selectedTags.every(tag => d.tags.includes(tag))
                        );
                    }
                    
                    return filtered;
                },
                
                filteredRecords() {
                    // Âè™ÂèñÊúÄËøëÁöÑ200Êù°ËÆ∞ÂΩï
                    let filtered = [...this.records].slice(0, 200);
                    
                    // ÂÖ≥ÈîÆÂ≠óÊêúÁ¥¢
                    if (this.recordSearchQuery) {
                        const query = this.recordSearchQuery.toLowerCase();
                        filtered = filtered.filter(r => 
                            (r.device_name && r.device_name.toLowerCase().includes(query)) ||
                            (r.user_name && r.user_name.toLowerCase().includes(query)) ||
                            (r.purpose && r.purpose.toLowerCase().includes(query))
                        );
                    }
                    
                    // ËÆæÂ§áËøáÊª§
                    if (this.recordDeviceFilter) {
                        filtered = filtered.filter(r => r.device_name === this.recordDeviceFilter);
                    }
                    
                    // Áî®Êà∑ËøáÊª§
                    if (this.recordUserFilter) {
                        filtered = filtered.filter(r => r.user_name === this.recordUserFilter);
                    }
                    
                    // ÊéíÂ∫è
                    filtered.sort((a, b) => {
                        let aVal = a[this.recordSortBy];
                        let bVal = b[this.recordSortBy];
                        
                        // Â§ÑÁêÜÊï∞Â≠óÁ±ªÂûãÔºàÂ¶ÇdurationÔºâ
                        if (this.recordSortBy === 'duration') {
                            aVal = parseFloat(aVal) || 0;
                            bVal = parseFloat(bVal) || 0;
                        }
                        
                        // Â§ÑÁêÜÊó•ÊúüÊó∂Èó¥
                        if (this.recordSortBy === 'start_time' || this.recordSortBy === 'end_time') {
                            aVal = new Date(aVal || '9999-12-31').getTime();
                            bVal = new Date(bVal || '9999-12-31').getTime();
                        }
                        
                        if (aVal < bVal) return this.recordSortOrder === 'asc' ? -1 : 1;
                        if (aVal > bVal) return this.recordSortOrder === 'asc' ? 1 : -1;
                        return 0;
                    });
                    
                    return filtered;
                },
                
                uniqueDeviceNames() {
                    return [...new Set(this.records.map(r => r.device_name))].filter(Boolean);
                },
                
                uniqueUserNames() {
                    return [...new Set(this.records.map(r => r.user_name))].filter(Boolean);
                },
                
                isAllSelected() {
                    return this.allowedUsers.length > 0 && this.selectedUsers.length === this.allowedUsers.length;
                }
            },
            mounted() {
                // ÈÖçÁΩÆaxiosÈîôËØØÊã¶Êà™Âô®
                axios.interceptors.response.use(
                    response => response,
                    error => {
                        // Áªü‰∏ÄÂ§ÑÁêÜÁΩëÁªúÈîôËØØ
                        if (error.code === 'ERR_NETWORK' || error.message === 'Network Error') {
                            console.error('ÁΩëÁªúËøûÊé•Â§±Ë¥•ÔºåÂêéÁ´ØÊúçÂä°ÂèØËÉΩÊú™ÂêØÂä®');
                            this.connectionStatus = 'offline';
                        }
                        return Promise.reject(error);
                    }
                );
                
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁôªÂΩï
                const token = localStorage.getItem('token');
                const user = localStorage.getItem('user');
                if (token && user) {
                    this.isLoggedIn = true;
                    this.isInitialized = true; // ÊÅ¢Â§çÁôªÂΩïÁä∂ÊÄÅÂêéÊòæÁ§∫‰∏ªÁïåÈù¢
                    this.currentUser = JSON.parse(user);
                    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
                    
                    // Âä†ËΩΩÊï∞ÊçÆ
                    this.loadAllData();
                    this.loadAllowedUsers();
                }
                
                // ÊØè30ÁßíÊ£ÄÊü•‰∏ÄÊ¨°ËøûÊé•Áä∂ÊÄÅ
                setInterval(() => {
                    if (this.connectionStatus === 'offline') {
                        this.checkConnection();
                    }
                }, 30000);
                
                // ÂàùÂßãÂåñSocket.IOËøûÊé•
                this.initSocket();
            },
            watch: {
                currentView(newView) {
                    // ÂàáÊç¢Âà∞ÁªüËÆ°ËßÜÂõæÊó∂ÈáçÊñ∞Ê∏≤ÊüìÂõæË°®
                    if (newView === 'statistics') {
                        this.$nextTick(() => {
                            this.renderCharts();
                        });
                    }
                }
            },
            methods: {
                switchLoginMode(mode) {
                    this.loginPageMode = mode;
                    // ÂàáÊç¢ÁôªÂΩïÊ®°ÂºèÊó∂ÈáçÁΩÆÂØÜÁ†ÅÂèØËßÅÁä∂ÊÄÅ
                    this.showUserLoginPassword = false;
                    this.showAdminLoginPassword = false;
                },
                
                togglePasswordVisibility(deviceId) {
                    // Vue 3 ÂìçÂ∫îÂºèÊõ¥Êñ∞
                    this.passwordVisible[deviceId] = !this.passwordVisible[deviceId];
                },
                
                sortRecords(field) {
                    if (this.recordSortBy === field) {
                        // ÂàáÊç¢ÊéíÂ∫èÊñπÂêë
                        this.recordSortOrder = this.recordSortOrder === 'asc' ? 'desc' : 'asc';
                    } else {
                        // Êñ∞Â≠óÊÆµÔºåÈªòËÆ§ÈôçÂ∫è
                        this.recordSortBy = field;
                        this.recordSortOrder = 'desc';
                    }
                },
                
                async copyPassword(password) {
                    if (!password || password === 'Êú™ËÆæÁΩÆ') {
                        this.showMessage('Â§çÂà∂Â§±Ë¥•', 'ÂØÜÁ†ÅÊú™ËÆæÁΩÆ', 'error');
                        return;
                    }
                    
                    try {
                        await navigator.clipboard.writeText(password);
                        this.showMessage('Â§çÂà∂ÊàêÂäü', 'ÂØÜÁ†ÅÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
                    } catch (error) {
                        // ÈôçÁ∫ßÊñπÊ°àÔºö‰ΩøÁî® textarea
                        const textarea = document.createElement('textarea');
                        textarea.value = password;
                        textarea.style.position = 'fixed';
                        textarea.style.opacity = '0';
                        document.body.appendChild(textarea);
                        textarea.select();
                        try {
                            document.execCommand('copy');
                            this.showMessage('Â§çÂà∂ÊàêÂäü', 'ÂØÜÁ†ÅÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
                        } catch (e) {
                            this.showMessage('Â§çÂà∂Â§±Ë¥•', 'ËØ∑ÊâãÂä®Â§çÂà∂', 'error');
                        }
                        document.body.removeChild(textarea);
                    }
                },
                
                formatDateTime(dateStr) {
                    if (!dateStr) return '-';
                    const date = new Date(dateStr);
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    const hours = String(date.getHours()).padStart(2, '0');
                    const minutes = String(date.getMinutes()).padStart(2, '0');
                    return `${year}-${month}-${day} ${hours}:${minutes}`;
                },
                
                async login() {
                    try {
                        // ‰ªéÂêéÁ´ØÈ™åËØÅÁÆ°ÁêÜÂëòË¥¶Âè∑ÂØÜÁ†Å
                        const configResponse = await axios.get(`${this.apiBaseUrl}/config`);
                        const adminUsername = configResponse.data.admin_username;
                        
                        // È™åËØÅÁÆ°ÁêÜÂëòÁî®Êà∑ÂêçÂØÜÁ†ÅÔºàÂØÜÁ†ÅÂú®ÂêéÁ´ØÈ™åËØÅÔºâ
                        const loginResponse = await axios.post(`${this.apiBaseUrl}/admin/login`, {
                            username: this.loginForm.username,
                            password: this.loginForm.password
                        });
                        
                        if (loginResponse.data.success) {
                            const user = { username: adminUsername, is_admin: true };
                            this.currentUser = user;
                            this.isLoggedIn = true;
                            this.isInitialized = true; // ÊòæÁ§∫‰∏ªÁïåÈù¢
                            
                            // ‰øùÂ≠òÂà∞localStorage
                            localStorage.setItem('token', 'admin-token');
                            localStorage.setItem('user', JSON.stringify(user));
                            
                            this.showLoginModal = false;
                            this.loginForm.username = '';
                            this.loginForm.password = '';
                            this.showAdminLoginPassword = false; // ÈáçÁΩÆÂØÜÁ†ÅÂèØËßÅÁä∂ÊÄÅ
                            this.showMessage('ÁôªÂΩïÊàêÂäü', 'Ê¨¢ËøéÂõûÊù•ÔºÅ', 'success');
                            
                            // Âä†ËΩΩÊâÄÊúâÊï∞ÊçÆ
                            this.loadAllData();
                        } else {
                            this.showMessage('ÁôªÂΩïÂ§±Ë¥•', loginResponse.data.message || 'Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ', 'error');
                        }
                    } catch (error) {
                        console.error('ÁÆ°ÁêÜÂëòÁôªÂΩïÂ§±Ë¥•Ôºö', error);
                        const message = error.response?.data?.message || 'ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å';
                        this.showMessage('ÁôªÂΩïÂ§±Ë¥•', message, 'error');
                    }
                },
                
                logout() {
                    this.confirmAction('ÈÄÄÂá∫ÁôªÂΩï', 'Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü', () => {
                        this.isLoggedIn = false;
                        this.isInitialized = false; // ËøîÂõûÁôªÂΩïÈ°µ
                        this.loginPageMode = 'user'; // ÈáçÁΩÆ‰∏∫Áî®Êà∑ÁôªÂΩïÊ®°Âºè
                        this.currentUser = null;
                        this.loginForm = { username: '', password: '' };
                        this.userLoginForm = { account: '', password: '' };
                        // ÈáçÁΩÆÊâÄÊúâÂØÜÁ†ÅÂèØËßÅÁä∂ÊÄÅ
                        this.showUserLoginPassword = false;
                        this.showAdminLoginPassword = false;
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        delete axios.defaults.headers.common['Authorization'];
                    });
                },
                
                async userLogin() {
                    try {
                        const response = await axios.post(`${this.apiBaseUrl}/users/login`, {
                            account: this.userLoginForm.account,
                            password: this.userLoginForm.password
                        });
                        
                        const user = response.data.user;
                        this.currentUser = user;
                        this.isLoggedIn = true;
                        this.isInitialized = true; // ÊòæÁ§∫‰∏ªÁïåÈù¢
                        
                        // ‰øùÂ≠òÂà∞localStorage
                        localStorage.setItem('token', 'user-token-' + user.username);
                        localStorage.setItem('user', JSON.stringify(user));
                        
                        this.showUserLoginModal = false;
                        this.userLoginForm.account = '';
                        this.userLoginForm.password = '';
                        this.showUserLoginPassword = false; // ÈáçÁΩÆÂØÜÁ†ÅÂèØËßÅÁä∂ÊÄÅ
                        this.showMessage('ÁôªÂΩïÊàêÂäü', `Ê¨¢ËøéÂõûÊù•Ôºå${user.chinese_name}ÔºÅ`, 'success');
                        
                        this.loadAllData();
                    } catch (error) {
                        console.error('Áî®Êà∑ÁôªÂΩïÂ§±Ë¥•Ôºö', error);
                        const message = error.response?.data?.message || 'ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Ë¥¶Âè∑ÂíåÂØÜÁ†Å';
                        this.showMessage('ÁôªÂΩïÂ§±Ë¥•', message, 'error');
                    }
                },
                
                async changePassword() {
                    // È™åËØÅÊñ∞ÂØÜÁ†ÅÂíåÁ°ÆËÆ§ÂØÜÁ†ÅÊòØÂê¶‰∏ÄËá¥
                    if (this.passwordForm.newPassword !== this.passwordForm.confirmPassword) {
                        this.showMessage('ÂØÜÁ†Å‰∏ç‰∏ÄËá¥', '‰∏§Ê¨°ËæìÂÖ•ÁöÑÊñ∞ÂØÜÁ†Å‰∏ç‰∏ÄËá¥ÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•', 'error');
                        return;
                    }
                    
                    // È™åËØÅÊñ∞ÂØÜÁ†ÅÈïøÂ∫¶
                    if (this.passwordForm.newPassword.length < 6) {
                        this.showMessage('ÂØÜÁ†ÅÂ§™Áü≠', 'Êñ∞ÂØÜÁ†ÅËá≥Â∞ëÈúÄË¶Å6‰∏™Â≠óÁ¨¶', 'error');
                        return;
                    }
                    
                    try {
                        await axios.post(`${this.apiBaseUrl}/users/change-password`, {
                            account: this.currentUser.username,
                            old_password: this.passwordForm.oldPassword,
                            new_password: this.passwordForm.newPassword
                        });
                        
                        this.showMessage('‰øÆÊîπÊàêÂäü', 'ÂØÜÁ†ÅÂ∑≤‰øÆÊîπÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï', 'success');
                        this.closeChangePasswordModal();
                        
                        // Âª∂Ëøü1ÁßíÂêéËá™Âä®ÈÄÄÂá∫ÁôªÂΩï
                        setTimeout(() => {
                            this.logout();
                        }, 1000);
                    } catch (error) {
                        console.error('‰øÆÊîπÂØÜÁ†ÅÂ§±Ë¥•Ôºö', error);
                        const message = error.response?.data?.message || '‰øÆÊîπÂØÜÁ†ÅÂ§±Ë¥•';
                        this.showMessage('‰øÆÊîπÂ§±Ë¥•', message, 'error');
                    }
                },
                
                closeChangePasswordModal() {
                    this.showChangePasswordModal = false;
                    this.passwordForm = {
                        oldPassword: '',
                        newPassword: '',
                        confirmPassword: ''
                    };
                    // ÈáçÁΩÆÂØÜÁ†ÅÂèØËßÅÁä∂ÊÄÅ
                    this.showOldPassword = false;
                    this.showNewPassword = false;
                    this.showConfirmPassword = false;
                },
                
                loadAllData() {
                    this.loadDevices();
                    this.loadRecords();
                    this.loadStatistics();
                    if (this.isLoggedIn) {
                        this.loadAllowedUsers();
                    }
                },
                
                async loadDevices() {
                    try {
                        const response = await axios.get(`${this.apiBaseUrl}/devices`);
                        this.devices = response.data;
                        this.extractAllTags();
                        this.connectionStatus = 'online'; // ËøûÊé•ÊàêÂäü
                    } catch (error) {
                        console.error('Âä†ËΩΩËÆæÂ§áÂàóË°®Â§±Ë¥•Ôºö', error);
                        this.connectionStatus = 'offline'; // ËøûÊé•Â§±Ë¥•
                        let errorMsg = 'Âä†ËΩΩËÆæÂ§áÂàóË°®Â§±Ë¥•';
                        
                        if (error.code === 'ERR_NETWORK' || error.message === 'Network Error') {
                            errorMsg = '‚ö†Ô∏è Êó†Ê≥ïËøûÊé•Âà∞ÂêéÁ´ØÊúçÂä°Âô®\n\nËØ∑Ê£ÄÊü•Ôºö\n\n1. ÂêéÁ´ØÊúçÂä°ÊòØÂê¶ÂêØÂä®ÔºàÁ´ØÂè£5001Ôºâ\n   ËøêË°å: cd backend && python app.py\n\n2. ÁΩëÁªúËøûÊé•ÊòØÂê¶Ê≠£Â∏∏\n\n3. Èò≤ÁÅ´Â¢ôËÆæÁΩÆÊòØÂê¶ÈòªÊ≠¢ËøûÊé•';
                        } else if (error.response) {
                            errorMsg = `ÊúçÂä°Âô®ÈîôËØØ (${error.response.status}): ${error.response.data?.message || error.message}`;
                        } else {
                            errorMsg = `Âä†ËΩΩÂ§±Ë¥•: ${error.message}`;
                        }
                        
                        this.showMessage('Êó†Ê≥ïËøûÊé•Âà∞ÊúçÂä°Âô®', errorMsg, 'error');
                        this.devices = []; // Ê∏ÖÁ©∫ËÆæÂ§áÂàóË°®
                    }
                },
                
                async loadRecords() {
                    try {
                        const response = await axios.get(`${this.apiBaseUrl}/records`);
                        this.records = response.data;
                    } catch (error) {
                        console.error('Âä†ËΩΩ‰ΩøÁî®ËÆ∞ÂΩïÂ§±Ë¥•Ôºö', error);
                        if (error.code === 'ERR_NETWORK' || error.message === 'Network Error') {
                            this.records = [];
                        }
                    }
                },
                
                async loadStatistics() {
                    try {
                        const response = await axios.get(`${this.apiBaseUrl}/statistics`);
                        this.statistics = response.data;
                        
                        // Á≠âÂæÖDOMÊõ¥Êñ∞ÂêéÁªòÂà∂ÂõæË°®
                        this.$nextTick(() => {
                            this.renderCharts();
                        });
                    } catch (error) {
                        console.error('Âä†ËΩΩÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•Ôºö', error);
                        if (error.code === 'ERR_NETWORK' || error.message === 'Network Error') {
                            this.statistics = {
                                total_devices: 0,
                                available_devices: 0,
                                occupied_devices: 0,
                                total_records: 0
                            };
                        }
                    }
                },
                
                renderCharts() {
                    if (!this.statistics) return;
                    
                    // ÈîÄÊØÅ‰πãÂâçÁöÑÂõæË°®ÂÆû‰æã
                    if (this.deviceChart) {
                        this.deviceChart.destroy();
                    }
                    if (this.userChart) {
                        this.userChart.destroy();
                    }
                    
                    // ÁªòÂà∂ËÆæÂ§á‰ΩøÁî®È•ºÂõæ
                    if (this.$refs.devicePieChart && this.statistics.device_usage_ranking && this.statistics.device_usage_ranking.length > 0) {
                        const ctx = this.$refs.devicePieChart.getContext('2d');
                        const topDevices = this.statistics.device_usage_ranking.slice(0, 10);
                        
                        this.deviceChart = new Chart(ctx, {
                            type: 'pie',
                            data: {
                                labels: topDevices.map(item => item.device_name),
                                datasets: [{
                                    data: topDevices.map(item => item.usage_count),
                                    backgroundColor: [
                                        '#667eea', '#764ba2', '#f093fb', '#4facfe',
                                        '#43e97b', '#fa709a', '#fee140', '#30cfd0',
                                        '#a8edea', '#fed6e3'
                                    ],
                                    borderWidth: 2,
                                    borderColor: '#fff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            boxWidth: 12,
                                            padding: 10,
                                            font: {
                                                size: 11
                                            }
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = ((value / total) * 100).toFixed(1);
                                                return `${label}: ${value}Ê¨° (${percentage}%)`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                    
                    // ÁªòÂà∂‰ΩøÁî®‰∫∫Êó∂ÈïøÈ•ºÂõæ
                    if (this.$refs.userPieChart && this.statistics.user_duration_ranking && this.statistics.user_duration_ranking.length > 0) {
                        const ctx = this.$refs.userPieChart.getContext('2d');
                        const topUsers = this.statistics.user_duration_ranking.slice(0, 10);
                        
                        this.userChart = new Chart(ctx, {
                            type: 'pie',
                            data: {
                                labels: topUsers.map(item => item.user_name),
                                datasets: [{
                                    data: topUsers.map(item => item.total_hours),
                                    backgroundColor: [
                                        '#fa709a', '#fee140', '#30cfd0', '#a8edea',
                                        '#fed6e3', '#667eea', '#764ba2', '#f093fb',
                                        '#4facfe', '#43e97b'
                                    ],
                                    borderWidth: 2,
                                    borderColor: '#fff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            boxWidth: 12,
                                            padding: 10,
                                            font: {
                                                size: 11
                                            }
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = ((value / total) * 100).toFixed(1);
                                                return `${label}: ${value}Â∞èÊó∂ (${percentage}%)`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                },
                
                extractAllTags() {
                    const tagsSet = new Set();
                    this.devices.forEach(device => {
                        if (device.tags && Array.isArray(device.tags)) {
                            device.tags.forEach(tag => tagsSet.add(tag));
                        }
                    });
                    this.allTags = Array.from(tagsSet).sort();
                },
                
                toggleTagFilter(tag) {
                    const index = this.selectedTags.indexOf(tag);
                    if (index > -1) {
                        this.selectedTags.splice(index, 1);
                    } else {
                        this.selectedTags.push(tag);
                    }
                },
                
                showAddDeviceModal() {
                    if (!this.isLoggedIn || !this.currentUser.is_admin) {
                        this.showMessage('ÊùÉÈôê‰∏çË∂≥', 'Âè™ÊúâÁÆ°ÁêÜÂëòÊâçËÉΩÊ∑ªÂä†ËÆæÂ§á', 'error');
                        return;
                    }
                    this.isEditing = false;
                    this.deviceForm = {
                        id: null,
                        name: '',
                        ip: '',
                        username: '',
                        password: '',
                        ssh_connections: [],
                        telnet_connections: [],
                        tags: []
                    };
                    this.showDeviceModal = true;
                },
                
                showEditDeviceModal(device) {
                    if (!this.isLoggedIn || !this.currentUser.is_admin) {
                        this.showMessage('ÊùÉÈôê‰∏çË∂≥', 'Âè™ÊúâÁÆ°ÁêÜÂëòÊâçËÉΩÁºñËæëËÆæÂ§á', 'error');
                        return;
                    }
                    this.isEditing = true;
                    // ÂàÜÁ¶ªSSHÂíåTelnetËøûÊé•
                    const ssh_conns = [];
                    const telnet_conns = [];
                    if (device.ssh_connections && Array.isArray(device.ssh_connections)) {
                        device.ssh_connections.forEach(conn => {
                            if (conn.type === 'Telnet') {
                                telnet_conns.push(JSON.parse(JSON.stringify(conn)));
                            } else {
                                ssh_conns.push(JSON.parse(JSON.stringify(conn)));
                            }
                        });
                    }
                    
                    this.deviceForm = {
                        id: device.id,
                        name: device.name,
                        ip: device.ip || '',
                        username: device.username || '',
                        password: device.password || '',
                        ssh_connections: ssh_conns,
                        telnet_connections: telnet_conns,
                        tags: device.tags ? JSON.parse(JSON.stringify(device.tags)) : []
                    };
                    this.showDeviceModal = true;
                },
                
                closeDeviceModal() {
                    this.showDeviceModal = false;
                    this.newTag = '';
                    this.showDevicePassword = false; // ÈáçÁΩÆËÆæÂ§áÂØÜÁ†ÅÂèØËßÅÁä∂ÊÄÅ
                },
                
                addTag() {
                    const tag = this.newTag.trim();
                    if (tag && !this.deviceForm.tags.includes(tag)) {
                        this.deviceForm.tags.push(tag);
                    }
                    this.newTag = '';
                },
                
                removeTag(tag) {
                    const index = this.deviceForm.tags.indexOf(tag);
                    if (index > -1) {
                        this.deviceForm.tags.splice(index, 1);
                    }
                },
                
                async saveDevice() {
                    if (!this.deviceForm.name) {
                        this.showMessage('È™åËØÅÂ§±Ë¥•', 'ËØ∑ËæìÂÖ•ËÆæÂ§áÂêçÁß∞', 'error');
                        return;
                    }

                    try {
                        // ÂêàÂπ∂SSHÂíåTelnetËøûÊé•
                        const allConnections = [];
                        
                        // Ê∑ªÂä†SSHËøûÊé•
                        this.deviceForm.ssh_connections.filter(c => c.ip).forEach(conn => {
                            allConnections.push({
                                type: conn.type || 'SSH',
                                ip: conn.ip,
                                port: conn.port
                            });
                        });
                        
                        // Ê∑ªÂä†TelnetËøûÊé•
                        this.deviceForm.telnet_connections.filter(c => c.ip).forEach(conn => {
                            allConnections.push({
                                type: 'Telnet',
                                ip: conn.ip,
                                port: conn.port
                            });
                        });
                        
                        const data = {
                            name: this.deviceForm.name,
                            ip: this.deviceForm.ip,
                            username: this.deviceForm.username,
                            password: this.deviceForm.password,
                            ssh_connections: allConnections,
                            serial_connections: [],  // ‰∏çÂÜç‰ΩøÁî®serial_connections
                            tags: this.deviceForm.tags
                        };

                        if (this.isEditing) {
                            await axios.put(`${this.apiBaseUrl}/devices/${this.deviceForm.id}`, data);
                            this.showMessage('Êõ¥Êñ∞ÊàêÂäü', 'ËÆæÂ§á‰ø°ÊÅØÂ∑≤Êõ¥Êñ∞', 'success');
                        } else {
                            await axios.post(`${this.apiBaseUrl}/devices`, data);
                            this.showMessage('Ê∑ªÂä†ÊàêÂäü', 'ËÆæÂ§áÂ∑≤ÊàêÂäüÊ∑ªÂä†', 'success');
                        }
                        
                        this.closeDeviceModal();
                        this.loadAllData();
                    } catch (error) {
                        this.showMessage('Êìç‰ΩúÂ§±Ë¥•', error.message, 'error');
                    }
                },
                
                async deleteDevice(deviceId) {
                    try {
                        await axios.delete(`${this.apiBaseUrl}/devices/${deviceId}`);
                        this.showMessage('Âà†Èô§ÊàêÂäü', 'ËÆæÂ§áÂ∑≤Âà†Èô§', 'success');
                        this.loadAllData();
                    } catch (error) {
                        this.showMessage('Âà†Èô§Â§±Ë¥•', error.message, 'error');
                    }
                },
                
                // ÊâπÈáèÂà†Èô§Áõ∏ÂÖ≥ÊñπÊ≥ï
                toggleBulkDeleteMode() {
                    this.bulkDeleteMode = !this.bulkDeleteMode;
                    if (!this.bulkDeleteMode) {
                        this.selectedDeviceIds = [];
                    }
                },
                
                toggleDeviceSelection(deviceId) {
                    const index = this.selectedDeviceIds.indexOf(deviceId);
                    if (index > -1) {
                        this.selectedDeviceIds.splice(index, 1);
                    } else {
                        this.selectedDeviceIds.push(deviceId);
                    }
                },
                
                selectAllDevices() {
                    if (this.selectedDeviceIds.length === this.filteredDevices.length) {
                        this.selectedDeviceIds = [];
                    } else {
                        this.selectedDeviceIds = this.filteredDevices.map(d => d.id);
                    }
                },
                
                async batchDeleteDevices() {
                    if (this.selectedDeviceIds.length === 0) {
                        this.showMessage('ÊèêÁ§∫', 'ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑËÆæÂ§á', 'warning');
                        return;
                    }
                    
                    this.confirmAction(
                        'ÊâπÈáèÂà†Èô§ËÆæÂ§á',
                        `Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${this.selectedDeviceIds.length} Âè∞ËÆæÂ§áÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`,
                        async () => {
                            try {
                                const response = await axios.post(`${this.apiBaseUrl}/devices/batch-delete`, {
                                    device_ids: this.selectedDeviceIds
                                });
                                this.showMessage('Âà†Èô§ÊàêÂäü', response.data.message, 'success');
                                this.selectedDeviceIds = [];
                                this.bulkDeleteMode = false;
                                this.loadAllData();
                            } catch (error) {
                                this.showMessage('Âà†Èô§Â§±Ë¥•', error.response?.data?.message || error.message, 'error');
                            }
                        }
                    );
                },
                
                showOccupyModal(device) {
                    // Â¶ÇÊûúÊòØÊôÆÈÄöÁî®Êà∑ÁôªÂΩï,Ëá™Âä®Â°´ÂÖÖË¥¶Âè∑
                    const userAccount = (this.isLoggedIn && !this.currentUser.is_admin) 
                        ? this.currentUser.username 
                        : '';
                    
                    this.occupyForm = {
                        deviceId: device.id,
                        deviceName: device.name,
                        user_account: userAccount,
                        purpose: '',
                        duration: 2
                    };
                    this.showOccupyDeviceModal = true;
                },
                
                closeOccupyModal() {
                    this.showOccupyDeviceModal = false;
                },
                
                // Áî®Êà∑ÁÆ°ÁêÜÊñπÊ≥ï
                async loadAllowedUsers() {
                    try {
                        const response = await axios.get(`${this.apiBaseUrl}/users`);
                        this.allowedUsers = response.data;
                    } catch (error) {
                        console.error('Âä†ËΩΩÁî®Êà∑ÂàóË°®Â§±Ë¥•Ôºö', error);
                    }
                },
                
                closeAddUserModal() {
                    this.showAddUserModal = false;
                    this.newUserForm = {
                        account: '',
                        chinese_name: '',
                        department: '',
                        password: ''
                    };
                },
                
                async addUser() {
                    if (!this.newUserForm.account.trim()) {
                        this.showMessage('È™åËØÅÂ§±Ë¥•', 'ËØ∑ËæìÂÖ•Ë¥¶Âè∑', 'error');
                        return;
                    }
                    if (!this.newUserForm.chinese_name.trim()) {
                        this.showMessage('È™åËØÅÂ§±Ë¥•', 'ËØ∑ËæìÂÖ•‰∏≠ÊñáÂêç', 'error');
                        return;
                    }
                    
                    try {
                        const password = this.newUserForm.password.trim() || '123456';
                        
                        await axios.post(`${this.apiBaseUrl}/users`, {
                            account: this.newUserForm.account.trim(),
                            chinese_name: this.newUserForm.chinese_name.trim(),
                            department: this.newUserForm.department.trim() || 'Êú™Â°´ÂÜô',
                            password: password
                        });
                        this.showMessage('Ê∑ªÂä†ÊàêÂäü', `Áî®Êà∑ "${this.newUserForm.chinese_name}" (${this.newUserForm.account}) Â∑≤Ê∑ªÂä†ÔºåÂàùÂßãÂØÜÁ†ÅÔºö${password}`, 'success');
                        this.closeAddUserModal();
                        this.loadAllowedUsers();
                    } catch (error) {
                        this.showMessage('Ê∑ªÂä†Â§±Ë¥•', error.response?.data?.message || error.message, 'error');
                    }
                },
                
                async deleteUser(userId, userAccount) {
                    if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§Ë¥¶Âè∑ "${userAccount}" ÂêóÔºüÂà†Èô§ÂêéËØ•Ë¥¶Âè∑Â∞ÜÊó†Ê≥ïÂç†Áî®ËÆæÂ§á„ÄÇ`)) {
                        return;
                    }
                    
                    try {
                        await axios.delete(`${this.apiBaseUrl}/users/${userId}`);
                        this.showMessage('Âà†Èô§ÊàêÂäü', `Ë¥¶Âè∑ "${userAccount}" Â∑≤Âà†Èô§`, 'success');
                        this.loadAllowedUsers();
                    } catch (error) {
                        this.showMessage('Âà†Èô§Â§±Ë¥•', error.response?.data?.message || error.message, 'error');
                    }
                },
                
                toggleSelectAll(event) {
                    if (event.target.checked) {
                        this.selectedUsers = this.allowedUsers.map(u => u.id);
                    } else {
                        this.selectedUsers = [];
                    }
                },
                
                async batchDeleteUsers() {
                    if (this.selectedUsers.length === 0) {
                        this.showMessage('ÊèêÁ§∫', 'ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÁî®Êà∑', 'error');
                        return;
                    }
                    
                    if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${this.selectedUsers.length} ‰∏™Áî®Êà∑ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ`)) {
                        return;
                    }
                    
                    try {
                        // ÊâπÈáèÂà†Èô§
                        await axios.post(`${this.apiBaseUrl}/users/batch-delete`, {
                            user_ids: this.selectedUsers
                        });
                        
                        this.showMessage('Âà†Èô§ÊàêÂäü', `Â∑≤Âà†Èô§ ${this.selectedUsers.length} ‰∏™Áî®Êà∑`, 'success');
                        this.selectedUsers = [];
                        this.loadAllowedUsers();
                    } catch (error) {
                        this.showMessage('Âà†Èô§Â§±Ë¥•', error.response?.data?.message || error.message, 'error');
                    }
                },
                
                toggleUserPasswordVisibility(userId) {
                    // Vue 3 ÂìçÂ∫îÂºèÊõ¥Êñ∞
                    this.userPasswordVisible[userId] = !this.userPasswordVisible[userId];
                },
                
                exportUsersToExcel() {
                    if (!this.allowedUsers || this.allowedUsers.length === 0) {
                        this.showMessage('ÂØºÂá∫Â§±Ë¥•', 'Ê≤°ÊúâÁî®Êà∑Êï∞ÊçÆÂèØÂØºÂá∫', 'warning');
                        return;
                    }
                    
                    // ÂáÜÂ§áÂØºÂá∫Êï∞ÊçÆ
                    const exportData = this.allowedUsers.map(user => {
                        return {
                            'Ë¥¶Âè∑': user.account,
                            '‰∏≠ÊñáÂêç': user.chinese_name,
                            'ÈÉ®Èó®': user.department || 'Êú™Â°´ÂÜô',
                            'ÂØÜÁ†Å': user.password || '123456',
                            'ÂàõÂª∫Êó∂Èó¥': this.formatDateTime(user.created_at)
                        };
                    });
                    
                    // ÂàõÂª∫Â∑•‰ΩúË°®
                    const ws = XLSX.utils.json_to_sheet(exportData);
                    
                    // ËÆæÁΩÆÂàóÂÆΩ
                    ws['!cols'] = [
                        { wch: 15 },  // Ë¥¶Âè∑
                        { wch: 15 },  // ‰∏≠ÊñáÂêç
                        { wch: 15 },  // ÈÉ®Èó®
                        { wch: 15 },  // ÂØÜÁ†Å
                        { wch: 20 }   // ÂàõÂª∫Êó∂Èó¥
                    ];
                    
                    // ÂàõÂª∫ËØ¥ÊòéÂ∑•‰ΩúË°®
                    const instructions = [
                        { 'Â≠óÊÆµÂêç': 'Ë¥¶Âè∑', 'ËØ¥Êòé': 'Áî®Êà∑ÁôªÂΩïË¥¶Âè∑ÔºåÂøÖÈ°ªÂîØ‰∏ÄÔºàÂøÖÂ°´Ôºâ', 'Á§∫‰æã': 'zhangsan' },
                        { 'Â≠óÊÆµÂêç': '‰∏≠ÊñáÂêç', 'ËØ¥Êòé': 'Áî®Êà∑‰∏≠ÊñáÂßìÂêçÔºàÂøÖÂ°´Ôºâ', 'Á§∫‰æã': 'Âº†‰∏â' },
                        { 'Â≠óÊÆµÂêç': 'ÈÉ®Èó®', 'ËØ¥Êòé': 'Áî®Êà∑ÊâÄÂ±ûÈÉ®Èó®ÔºàÂèØÈÄâÔºâ', 'Á§∫‰æã': 'ÊäÄÊúØÈÉ®' },
                        { 'Â≠óÊÆµÂêç': 'ÂØÜÁ†Å', 'ËØ¥Êòé': 'ÁôªÂΩïÂØÜÁ†ÅÔºå‰∏çÂ°´Âàô‰ΩøÁî®ÈªòËÆ§ÂØÜÁ†Å123456ÔºàÂèØÈÄâÔºâ', 'Á§∫‰æã': '123456' },
                        { 'Â≠óÊÆµÂêç': 'ÂàõÂª∫Êó∂Èó¥', 'ËØ¥Êòé': 'Áî®Êà∑ÂàõÂª∫Êó∂Èó¥ÔºàÂØºÂá∫Êó∂Ëá™Âä®ÁîüÊàêÔºåÂØºÂÖ•Êó∂ÂøΩÁï•Ôºâ', 'Á§∫‰æã': '2024-01-01 12:00' }
                    ];
                    const wsInstructions = XLSX.utils.json_to_sheet(instructions);
                    wsInstructions['!cols'] = [
                        { wch: 15 },  // Â≠óÊÆµÂêç
                        { wch: 45 },  // ËØ¥Êòé
                        { wch: 25 }   // Á§∫‰æã
                    ];
                    
                    // ÂàõÂª∫Â∑•‰ΩúÁ∞ø
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Áî®Êà∑ÂàóË°®');
                    XLSX.utils.book_append_sheet(wb, wsInstructions, 'Â≠óÊÆµËØ¥Êòé');
                    
                    // ÁîüÊàêÊñá‰ª∂ÂêçÔºàÂåÖÂê´ÂØºÂá∫Êó∂Èó¥Ôºâ
                    const now = new Date();
                    const dateStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
                    const filename = `Áî®Êà∑ÂàóË°®_${dateStr}.xlsx`;
                    
                    // ‰∏ãËΩΩÊñá‰ª∂
                    XLSX.writeFile(wb, filename);
                    
                    this.showMessage('ÂØºÂá∫ÊàêÂäü', `Â∑≤ÂØºÂá∫ ${this.allowedUsers.length} ‰∏™Áî®Êà∑Âà∞ ${filename}`, 'success');
                },
                
                triggerExcelUpload() {
                    this.$refs.excelFileInput.click();
                },
                
                async handleExcelUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    try {
                        const reader = new FileReader();
                        reader.onload = async (e) => {
                            try {
                                const data = new Uint8Array(e.target.result);
                                const workbook = XLSX.read(data, { type: 'array' });
                                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                                const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                                
                                if (jsonData.length === 0) {
                                    this.showMessage('ÂØºÂÖ•Â§±Ë¥•', 'ExcelÊñá‰ª∂‰∏∫Á©∫', 'error');
                                    return;
                                }
                                
                                // È™åËØÅÊï∞ÊçÆÊ†ºÂºèÂπ∂ËΩ¨Êç¢
                                const users = [];
                                for (let i = 0; i < jsonData.length; i++) {
                                    const row = jsonData[i];
                                    // ÊîØÊåÅÂ§öÁßçÂàóÂêçÊ†ºÂºè
                                    const account = row['Ë¥¶Âè∑'] || row['account'] || row['Account'];
                                    const chinese_name = row['‰∏≠ÊñáÂêç'] || row['ÂßìÂêç'] || row['chinese_name'] || row['name'];
                                    const department = row['ÈÉ®Èó®'] || row['department'] || row['Department'] || 'Êú™Â°´ÂÜô';
                                    const password = row['ÂØÜÁ†Å'] || row['password'] || row['Password'] || '123456';
                                    
                                    if (!account || !chinese_name) {
                                        this.showMessage('ÂØºÂÖ•Â§±Ë¥•', `Á¨¨ ${i + 2} Ë°åÊï∞ÊçÆ‰∏çÂÆåÊï¥ÔºàÁº∫Â∞ëË¥¶Âè∑Êàñ‰∏≠ÊñáÂêçÔºâ`, 'error');
                                        return;
                                    }
                                    
                                    users.push({
                                        account: String(account).trim(),
                                        chinese_name: String(chinese_name).trim(),
                                        department: String(department).trim(),
                                        password: String(password).trim()
                                    });
                                }
                                
                                // ÊâπÈáèÂØºÂÖ•
                                const response = await axios.post(`${this.apiBaseUrl}/users/batch-import`, {
                                    users: users
                                });
                                
                                this.showMessage('ÂØºÂÖ•ÊàêÂäü', 
                                    `ÊàêÂäüÂØºÂÖ• ${response.data.success_count} ‰∏™Áî®Êà∑ÔºåÂ§±Ë¥• ${response.data.fail_count} ‰∏™`, 
                                    'success'
                                );
                                this.loadAllowedUsers();
                                
                            } catch (error) {
                                this.showMessage('ÂØºÂÖ•Â§±Ë¥•', error.response?.data?.message || error.message, 'error');
                            }
                        };
                        reader.readAsArrayBuffer(file);
                        
                    } catch (error) {
                        this.showMessage('ËØªÂèñÊñá‰ª∂Â§±Ë¥•', error.message, 'error');
                    }
                    
                    // Ê∏ÖÁ©∫Êñá‰ª∂ÈÄâÊã©ÔºåÂÖÅËÆ∏ÈáçÂ§çÈÄâÊã©Âêå‰∏ÄÊñá‰ª∂
                    event.target.value = '';
                },
                
                downloadExcelTemplate() {
                    // ÂàõÂª∫Á§∫‰æãÊï∞ÊçÆ
                    const template = [
                        { 'Ë¥¶Âè∑': 'zhangsan', '‰∏≠ÊñáÂêç': 'Âº†‰∏â', 'ÈÉ®Èó®': 'ÊäÄÊúØÈÉ®', 'ÂØÜÁ†Å': '123456' },
                        { 'Ë¥¶Âè∑': 'lisi', '‰∏≠ÊñáÂêç': 'ÊùéÂõõ', 'ÈÉ®Èó®': '‰∫ßÂìÅÈÉ®', 'ÂØÜÁ†Å': '123456' },
                        { 'Ë¥¶Âè∑': 'wangwu', '‰∏≠ÊñáÂêç': 'Áéã‰∫î', 'ÈÉ®Èó®': 'ÊµãËØïÈÉ®', 'ÂØÜÁ†Å': '123456' }
                    ];
                    
                    // ÂàõÂª∫ËØ¥ÊòéÂ∑•‰ΩúË°®
                    const instructions = [
                        { 'Â≠óÊÆµÂêç': 'Ë¥¶Âè∑', 'ËØ¥Êòé': 'Áî®Êà∑ÁôªÂΩïË¥¶Âè∑ÔºåÂøÖÈ°ªÂîØ‰∏ÄÔºàÂøÖÂ°´Ôºâ', 'Á§∫‰æã': 'zhangsan' },
                        { 'Â≠óÊÆµÂêç': '‰∏≠ÊñáÂêç', 'ËØ¥Êòé': 'Áî®Êà∑‰∏≠ÊñáÂßìÂêçÔºàÂøÖÂ°´Ôºâ', 'Á§∫‰æã': 'Âº†‰∏â' },
                        { 'Â≠óÊÆµÂêç': 'ÈÉ®Èó®', 'ËØ¥Êòé': 'Áî®Êà∑ÊâÄÂ±ûÈÉ®Èó®ÔºàÂèØÈÄâÔºâ', 'Á§∫‰æã': 'ÊäÄÊúØÈÉ®' },
                        { 'Â≠óÊÆµÂêç': 'ÂØÜÁ†Å', 'ËØ¥Êòé': 'ÁôªÂΩïÂØÜÁ†ÅÔºå‰∏çÂ°´Âàô‰ΩøÁî®ÈªòËÆ§ÂØÜÁ†Å123456ÔºàÂèØÈÄâÔºâ', 'Á§∫‰æã': '123456' }
                    ];
                    
                    // ÂàõÂª∫Â∑•‰ΩúË°®
                    const ws = XLSX.utils.json_to_sheet(template);
                    const wsInstructions = XLSX.utils.json_to_sheet(instructions);
                    
                    // ËÆæÁΩÆÂàóÂÆΩ
                    ws['!cols'] = [
                        { wch: 15 },  // Ë¥¶Âè∑ÂàóÂÆΩ
                        { wch: 15 },  // ‰∏≠ÊñáÂêçÂàóÂÆΩ
                        { wch: 15 },  // ÈÉ®Èó®ÂàóÂÆΩ
                        { wch: 15 }   // ÂØÜÁ†ÅÂàóÂÆΩ
                    ];
                    
                    wsInstructions['!cols'] = [
                        { wch: 15 },  // Â≠óÊÆµÂêç
                        { wch: 40 },  // ËØ¥Êòé
                        { wch: 20 }   // Á§∫‰æã
                    ];
                    
                    // ÂàõÂª∫Â∑•‰ΩúÁ∞ø
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Áî®Êà∑ÂàóË°®');
                    XLSX.utils.book_append_sheet(wb, wsInstructions, 'Â≠óÊÆµËØ¥Êòé');
                    
                    // ‰∏ãËΩΩÊñá‰ª∂
                    XLSX.writeFile(wb, 'Áî®Êà∑ÂØºÂÖ•Ê®°Êùø.xlsx');
                    
                    this.showMessage('‰∏ãËΩΩÊàêÂäü', 'Ê®°ÊùøÊñá‰ª∂Â∑≤‰∏ãËΩΩÔºåËØ∑ÊåâÁÖßÊ†ºÂºèÂ°´ÂÜôÂêéÂØºÂÖ•', 'success');
                },
                
                // ËÆæÂ§áExcelÂØºÂá∫
                exportDevicesToExcel() {
                    if (!this.devices || this.devices.length === 0) {
                        this.showMessage('ÂØºÂá∫Â§±Ë¥•', 'Ê≤°ÊúâËÆæÂ§áÊï∞ÊçÆÂèØÂØºÂá∫', 'warning');
                        return;
                    }
                    
                    // ÂáÜÂ§áÂØºÂá∫Êï∞ÊçÆ
                    const exportData = this.devices.map(device => {
                        // ÂêàÂπ∂ÊâÄÊúâËøûÊé•‰ø°ÊÅØ
                        const allConnections = [];
                        
                        // ÊâÄÊúâËøûÊé•ÈÉΩÂú®ssh_connections‰∏≠
                        if (device.ssh_connections && Array.isArray(device.ssh_connections) && device.ssh_connections.length > 0) {
                            device.ssh_connections.forEach(conn => {
                                allConnections.push(`${conn.type || 'SSH'}:${conn.ip}:${conn.port}`);
                            });
                        }
                        
                        const connectionStr = allConnections.join('; ');
                        const tagsStr = (device.tags || []).join(', ');
                        
                        return {
                            'ËÆæÂ§áÂêçÁß∞': device.name,
                            'Áä∂ÊÄÅ': device.status === 'available' ? 'Á©∫Èó≤' : 'Âç†Áî®',
                            '‰ΩøÁî®ËÄÖ': device.current_user || '',
                            '‰ΩøÁî®ËÄÖË¥¶Âè∑': device.current_user_account || '',
                            'Áî®Êà∑Âêç': device.username || '',
                            'ÂØÜÁ†Å': device.password || '',
                            'ËøûÊé•‰ø°ÊÅØ': connectionStr,
                            'Ê†áÁ≠æ': tagsStr
                        };
                    });
                    
                    // ÂàõÂª∫Â∑•‰ΩúË°®
                    const ws = XLSX.utils.json_to_sheet(exportData);
                    
                    // ËÆæÁΩÆÂàóÂÆΩ
                    ws['!cols'] = [
                        { wch: 20 },  // ËÆæÂ§áÂêçÁß∞
                        { wch: 10 },  // Áä∂ÊÄÅ
                        { wch: 15 },  // ‰ΩøÁî®ËÄÖ
                        { wch: 15 },  // ‰ΩøÁî®ËÄÖË¥¶Âè∑
                        { wch: 15 },  // Áî®Êà∑Âêç
                        { wch: 15 },  // ÂØÜÁ†Å
                        { wch: 40 },  // ËøûÊé•‰ø°ÊÅØ
                        { wch: 20 }   // Ê†áÁ≠æ
                    ];
                    
                    // ÂàõÂª∫ËØ¥ÊòéÂ∑•‰ΩúË°®
                    const instructions = [
                        { 'Â≠óÊÆµÂêç': 'ËÆæÂ§áÂêçÁß∞', 'ËØ¥Êòé': 'ËÆæÂ§áÁöÑÂîØ‰∏ÄÂêçÁß∞ÔºàÂøÖÂ°´Ôºâ', 'Á§∫‰æã': 'iPhone 13 Pro' },
                        { 'Â≠óÊÆµÂêç': 'Áä∂ÊÄÅ', 'ËØ¥Êòé': 'ËÆæÂ§áÁä∂ÊÄÅÔºàÂØºÂá∫Êó∂Ëá™Âä®ÁîüÊàêÔºåÂØºÂÖ•Êó∂ÂøΩÁï•Ôºâ', 'Á§∫‰æã': 'Á©∫Èó≤ Êàñ Âç†Áî®' },
                        { 'Â≠óÊÆµÂêç': '‰ΩøÁî®ËÄÖ', 'ËØ¥Êòé': 'ÂΩìÂâç‰ΩøÁî®ËÄÖ‰∏≠ÊñáÂêçÔºàÂØºÂá∫Êó∂Ëá™Âä®ÁîüÊàêÔºåÂØºÂÖ•Êó∂ÂøΩÁï•Ôºâ', 'Á§∫‰æã': 'Âº†‰∏â' },
                        { 'Â≠óÊÆµÂêç': '‰ΩøÁî®ËÄÖË¥¶Âè∑', 'ËØ¥Êòé': 'ÂΩìÂâç‰ΩøÁî®ËÄÖË¥¶Âè∑ÔºàÂØºÂá∫Êó∂Ëá™Âä®ÁîüÊàêÔºåÂØºÂÖ•Êó∂ÂøΩÁï•Ôºâ', 'Á§∫‰æã': 'zhangsan' },
                        { 'Â≠óÊÆµÂêç': 'Áî®Êà∑Âêç', 'ËØ¥Êòé': 'ËÆæÂ§áÁôªÂΩïÁî®Êà∑ÂêçÔºàÂèØÈÄâÔºâ', 'Á§∫‰æã': 'root' },
                        { 'Â≠óÊÆµÂêç': 'ÂØÜÁ†Å', 'ËØ¥Êòé': 'ËÆæÂ§áÁôªÂΩïÂØÜÁ†ÅÔºàÂèØÈÄâÔºâ', 'Á§∫‰æã': '123456' },
                        { 'Â≠óÊÆµÂêç': 'ËøûÊé•‰ø°ÊÅØ', 'ËØ¥Êòé': 'Ê†ºÂºè: Á±ªÂûã:IP:Á´ØÂè£\nÂ§ö‰∏™ËøûÊé•Áî®ÂàÜÂè∑ÂàÜÈöî\nÊîØÊåÅÁ±ªÂûã: SSH„ÄÅTelnet', 'Á§∫‰æã': 'SSH:192.168.1.100:22; Telnet:192.168.1.100:23' },
                        { 'Â≠óÊÆµÂêç': 'Ê†áÁ≠æ', 'ËØ¥Êòé': 'ËÆæÂ§áÊ†áÁ≠æÔºåÂ§ö‰∏™Ê†áÁ≠æÁî®ÈÄóÂè∑ÂàÜÈöîÔºàÂèØÈÄâÔºâ', 'Á§∫‰æã': 'iOS,ÊµãËØïÊú∫,5G' }
                    ];
                    const wsInstructions = XLSX.utils.json_to_sheet(instructions);
                    wsInstructions['!cols'] = [
                        { wch: 15 },  // Â≠óÊÆµÂêç
                        { wch: 50 },  // ËØ¥Êòé
                        { wch: 40 }   // Á§∫‰æã
                    ];
                    
                    // ÂàõÂª∫Â∑•‰ΩúÁ∞ø
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'ËÆæÂ§áÂàóË°®');
                    XLSX.utils.book_append_sheet(wb, wsInstructions, 'Â≠óÊÆµËØ¥Êòé');
                    
                    // ÁîüÊàêÊñá‰ª∂ÂêçÔºàÂåÖÂê´ÂØºÂá∫Êó∂Èó¥Ôºâ
                    const now = new Date();
                    const dateStr = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}`;
                    const filename = `ËÆæÂ§áÂàóË°®_${dateStr}.xlsx`;
                    
                    // ‰∏ãËΩΩÊñá‰ª∂
                    XLSX.writeFile(wb, filename);
                    
                    this.showMessage('ÂØºÂá∫ÊàêÂäü', `Â∑≤ÂØºÂá∫ ${this.devices.length} Êù°ËÆæÂ§áÊï∞ÊçÆ`, 'success');
                },
                
                // ‰∏ãËΩΩËÆæÂ§áÂØºÂÖ•Ê®°Êùø
                downloadDeviceExcelTemplate() {
                    // ÂàõÂª∫Á§∫‰æãÊï∞ÊçÆ
                    const template = [
                        { 
                            'ËÆæÂ§áÂêçÁß∞': 'iPhone 13 Pro', 
                            'Áî®Êà∑Âêç': 'root', 
                            'ÂØÜÁ†Å': '123456', 
                            'ËøûÊé•‰ø°ÊÅØ': 'SSH:192.168.1.100:22; Telnet:192.168.1.100:23', 
                            'Ê†áÁ≠æ': 'iOS,ÊµãËØïÊú∫,5G' 
                        },
                        { 
                            'ËÆæÂ§áÂêçÁß∞': 'MacBook Pro', 
                            'Áî®Êà∑Âêç': 'admin', 
                            'ÂØÜÁ†Å': 'admin123', 
                            'ËøûÊé•‰ø°ÊÅØ': 'SSH:192.168.1.101:22', 
                            'Ê†áÁ≠æ': 'macOS,ÂºÄÂèëÊú∫' 
                        },
                        { 
                            'ËÆæÂ§áÂêçÁß∞': 'Ubuntu Server', 
                            'Áî®Êà∑Âêç': 'ubuntu', 
                            'ÂØÜÁ†Å': 'ubuntu123', 
                            'ËøûÊé•‰ø°ÊÅØ': 'SSH:192.168.1.102:22; Telnet:192.168.1.102:23', 
                            'Ê†áÁ≠æ': 'Linux,ÊúçÂä°Âô®' 
                        }
                    ];
                    
                    // ÂàõÂª∫ËØ¥ÊòéÂ∑•‰ΩúË°®
                    const instructions = [
                        { 'Â≠óÊÆµÂêç': 'ËÆæÂ§áÂêçÁß∞', 'ËØ¥Êòé': 'ËÆæÂ§áÁöÑÂîØ‰∏ÄÂêçÁß∞ÔºàÂøÖÂ°´Ôºâ', 'Á§∫‰æã': 'iPhone 13 Pro' },
                        { 'Â≠óÊÆµÂêç': 'Áî®Êà∑Âêç', 'ËØ¥Êòé': 'ËÆæÂ§áÁôªÂΩïÁî®Êà∑ÂêçÔºàÂèØÈÄâÔºâ', 'Á§∫‰æã': 'root' },
                        { 'Â≠óÊÆµÂêç': 'ÂØÜÁ†Å', 'ËØ¥Êòé': 'ËÆæÂ§áÁôªÂΩïÂØÜÁ†ÅÔºàÂèØÈÄâÔºâ', 'Á§∫‰æã': '123456' },
                        { 'Â≠óÊÆµÂêç': 'ËøûÊé•‰ø°ÊÅØ', 'ËØ¥Êòé': 'Ê†ºÂºè: Á±ªÂûã:IP:Á´ØÂè£\nÂ§ö‰∏™ËøûÊé•Áî®ÂàÜÂè∑ÂàÜÈöî\nÊîØÊåÅÁ±ªÂûã: SSH„ÄÅTelnet', 'Á§∫‰æã': 'SSH:192.168.1.100:22; Telnet:192.168.1.100:23' },
                        { 'Â≠óÊÆµÂêç': 'Ê†áÁ≠æ', 'ËØ¥Êòé': 'ËÆæÂ§áÊ†áÁ≠æÔºåÂ§ö‰∏™Ê†áÁ≠æÁî®ÈÄóÂè∑ÂàÜÈöîÔºàÂèØÈÄâÔºâ', 'Á§∫‰æã': 'iOS,ÊµãËØïÊú∫,5G' }
                    ];
                    
                    // ÂàõÂª∫Â∑•‰ΩúË°®
                    const ws = XLSX.utils.json_to_sheet(template);
                    const wsInstructions = XLSX.utils.json_to_sheet(instructions);
                    
                    // ËÆæÁΩÆÂàóÂÆΩ
                    ws['!cols'] = [
                        { wch: 20 },  // ËÆæÂ§áÂêçÁß∞
                        { wch: 15 },  // Áî®Êà∑Âêç
                        { wch: 15 },  // ÂØÜÁ†Å
                        { wch: 50 },  // ËøûÊé•‰ø°ÊÅØ
                        { wch: 25 }   // Ê†áÁ≠æ
                    ];
                    
                    wsInstructions['!cols'] = [
                        { wch: 15 },  // Â≠óÊÆµÂêç
                        { wch: 50 },  // ËØ¥Êòé
                        { wch: 40 }   // Á§∫‰æã
                    ];
                    
                    // ÂàõÂª∫Â∑•‰ΩúÁ∞ø
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'ËÆæÂ§áÂàóË°®');
                    XLSX.utils.book_append_sheet(wb, wsInstructions, 'Â≠óÊÆµËØ¥Êòé');
                    
                    // ‰∏ãËΩΩÊñá‰ª∂
                    XLSX.writeFile(wb, 'ËÆæÂ§áÂØºÂÖ•Ê®°Êùø.xlsx');
                    
                    this.showMessage('‰∏ãËΩΩÊàêÂäü', 'Ê®°ÊùøÊñá‰ª∂Â∑≤‰∏ãËΩΩÔºåËØ∑ÊåâÁÖßÊ†ºÂºèÂ°´ÂÜôÂêéÂØºÂÖ•', 'success');
                },
                
                // Ëß¶ÂèëËÆæÂ§áExcel‰∏ä‰º†
                triggerDeviceExcelUpload() {
                    this.$refs.deviceExcelInput.click();
                },
                
                // Â§ÑÁêÜËÆæÂ§áExcelÂØºÂÖ•
                async handleDeviceExcelUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                            
                            if (jsonData.length === 0) {
                                this.showMessage('ÂØºÂÖ•Â§±Ë¥•', 'ExcelÊñá‰ª∂‰∏≠Ê≤°ÊúâÊï∞ÊçÆ', 'error');
                                return;
                            }
                            
                            // Ëß£ÊûêËÆæÂ§áÊï∞ÊçÆ
                            const devices = [];
                            const errors = [];
                            
                            jsonData.forEach((row, index) => {
                                try {
                                    const name = row['ËÆæÂ§áÂêçÁß∞'] || row['name'];
                                    
                                    if (!name) {
                                        errors.push(`Á¨¨${index + 2}Ë°å: Áº∫Â∞ëÂøÖÂ°´Â≠óÊÆµÔºàËÆæÂ§áÂêçÁß∞Ôºâ`);
                                        return;
                                    }
                                    
                                    // Ëß£ÊûêËøûÊé•‰ø°ÊÅØ
                                    const connectionStr = row['ËøûÊé•‰ø°ÊÅØ'] || row['connections'] || '';
                                    const connections = [];
                                    if (connectionStr) {
                                        const connParts = connectionStr.split(';');
                                        connParts.forEach(conn => {
                                            const parts = conn.trim().split(':');
                                            if (parts.length === 3) {
                                                // ÊâÄÊúâËøûÊé•ÈÉΩÊòØ: type:ip:port Ê†ºÂºè
                                                connections.push({
                                                    type: parts[0].trim(),
                                                    ip: parts[1].trim(),
                                                    port: parts[2].trim()
                                                });
                                            }
                                        });
                                    }
                                    
                                    // Ëß£ÊûêÊ†áÁ≠æ
                                    const tagsStr = row['Ê†áÁ≠æ'] || row['tags'] || '';
                                    const tags = tagsStr ? tagsStr.split(',').map(t => t.trim()).filter(t => t) : [];
                                    
                                    devices.push({
                                        name: name,
                                        username: row['Áî®Êà∑Âêç'] || row['username'] || '',
                                        password: row['ÂØÜÁ†Å'] || row['password'] || '',
                                        connections: connections,
                                        tags: tags
                                    });
                                } catch (err) {
                                    errors.push(`Á¨¨${index + 2}Ë°å: ${err.message}`);
                                }
                            });
                            
                            if (errors.length > 0) {
                                this.showMessage('ÂØºÂÖ•Ë≠¶Âëä', `Ëß£ÊûêÈîôËØØÔºö\n${errors.join('\n')}`, 'warning');
                            }
                            
                            if (devices.length === 0) {
                                this.showMessage('ÂØºÂÖ•Â§±Ë¥•', 'Ê≤°ÊúâÊúâÊïàÁöÑËÆæÂ§áÊï∞ÊçÆ', 'error');
                                return;
                            }
                            
                            // ÊâπÈáèÂØºÂÖ•ËÆæÂ§á
                            const response = await axios.post(`${this.apiBaseUrl}/devices/batch-import`, {
                                devices: devices
                            });
                            
                            this.showMessage('ÂØºÂÖ•ÊàêÂäü', `ÊàêÂäüÂØºÂÖ• ${response.data.imported_count} Êù°ËÆæÂ§áÊï∞ÊçÆ`, 'success');
                            this.loadAllData();
                            
                        } catch (error) {
                            console.error('ÂØºÂÖ•Â§±Ë¥•Ôºö', error);
                            this.showMessage('ÂØºÂÖ•Â§±Ë¥•', error.response?.data?.message || error.message, 'error');
                        }
                    };
                    
                    reader.readAsArrayBuffer(file);
                    
                    // Ê∏ÖÁ©∫Êñá‰ª∂ÈÄâÊã©
                    event.target.value = '';
                },
                
                async confirmOccupy() {
                    if (!this.occupyForm.user_account) {
                        this.showMessage('È™åËØÅÂ§±Ë¥•', 'ËØ∑Â°´ÂÜôË¥¶Âè∑', 'error');
                        return;
                    }
                    
                    // Â¶ÇÊûúÊú™ÁôªÂΩïÔºåÊèêÁ§∫ÈúÄË¶ÅÁôªÂΩï
                    if (!this.isLoggedIn) {
                        this.showMessage('ÈúÄË¶ÅÁôªÂΩï', 'ËØ∑ÂÖàÁôªÂΩïÂêéÂÜçÂç†Áî®ËÆæÂ§á', 'error');
                        this.closeOccupyModal();
                        this.showUserLoginModal = true;
                        return;
                    }

                    try {
                        const response = await axios.post(`${this.apiBaseUrl}/devices/${this.occupyForm.deviceId}/occupy`, {
                            user_account: this.occupyForm.user_account,
                            purpose: this.occupyForm.purpose || 'Êú™Â°´ÂÜô',
                            duration: this.occupyForm.duration
                        });
                        this.showMessage('Âç†Áî®ÊàêÂäü', `ËÆæÂ§áÂ∑≤Ë¢´Âç†Áî®ÔºåÂ∞ÜÂú®${this.occupyForm.duration}Â∞èÊó∂ÂêéËá™Âä®ÈáäÊîæ`, 'success');
                        this.closeOccupyModal();
                        this.loadAllData();
                    } catch (error) {
                        this.showMessage('Âç†Áî®Â§±Ë¥•', error.response?.data?.message || error.message, 'error');
                    }
                },
                
                async releaseDevice(deviceId) {
                    try {
                        await axios.post(`${this.apiBaseUrl}/devices/${deviceId}/release`);
                        this.showMessage('ÈáäÊîæÊàêÂäü', 'ËÆæÂ§áÂ∑≤ÈáäÊîæ', 'success');
                        this.loadAllData();
                    } catch (error) {
                        this.showMessage('ÈáäÊîæÂ§±Ë¥•', error.response?.data?.message || error.message, 'error');
                    }
                },
                
                openConnection(device, connection) {
                    const connType = connection.type || 'SSH';
                    this.terminalInfo = {
                        title: `${connType} - ${device.name} (${connection.ip}:${connection.port})`
                    };
                    // ÈáçÁΩÆÂºπÁ™óÁä∂ÊÄÅ
                    this.terminalMaximized = false;
                    this.terminalPosition = { x: 0, y: 0 };
                    this.showTerminalModal = true;
                    
                    // Á≠âÂæÖDOMÊõ¥Êñ∞ÂêéÂàùÂßãÂåñÁªàÁ´Ø
                    this.$nextTick(() => {
                        // Á°Æ‰øùÂºπÁ™ótransformÊ≠£Á°Æ
                        const modalContent = this.$refs.terminalModalContent;
                        if (modalContent) {
                            modalContent.style.transform = 'translate(-50%, -50%)';
                        }
                        this.initTerminal();
                        
                        if (connType === 'SSH') {
                            this.term.writeln('Ê≠£Âú®Âª∫Á´ãSSHËøûÊé•...');
                            this.term.writeln(`ÁõÆÊ†á: ${connection.ip}:${connection.port}`);
                            this.term.writeln(`Áî®Êà∑: ${device.username}`);
                            this.term.writeln('ËØ∑Á®çÂÄô...\r\n');
                            
                            const sessionId = 'ssh_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                            this.terminalSessionId = sessionId;
                            
                            if (this.socket && this.socket.connected) {
                                this.socket.emit('ssh_connect', {
                                    session_id: sessionId,
                                    host: connection.ip,
                                    port: parseInt(connection.port),
                                    username: device.username,
                                    password: device.password
                                });
                            } else {
                                this.term.writeln('\r\n========================================');
                                this.term.writeln('‚ùå ÈîôËØØÔºöWebSocketÊú™ËøûÊé•');
                                this.term.writeln('========================================');
                                this.term.writeln('ËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                            }
                        } else if (connType === 'Telnet') {
                            this.term.writeln('Ê≠£Âú®Âª∫Á´ãTelnetËøûÊé•...');
                            this.term.writeln(`ÁõÆÊ†á: ${connection.ip}:${connection.port}`);
                            this.term.writeln('ËØ∑Á®çÂÄô...\r\n');
                            
                            const sessionId = 'telnet_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                            this.terminalSessionId = sessionId;
                            
                            if (this.socket && this.socket.connected) {
                                this.socket.emit('telnet_connect', {
                                    session_id: sessionId,
                                    host: connection.ip,
                                    port: parseInt(connection.port)
                                });
                            } else {
                                this.term.writeln('\r\n========================================');
                                this.term.writeln('‚ùå ÈîôËØØÔºöWebSocketÊú™ËøûÊé•');
                                this.term.writeln('========================================');
                                this.term.writeln('ËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                            }
                        }
                    });
                },
                
                openSSH(device, connection) {
                    // ÂÖºÂÆπÊóßÁöÑË∞ÉÁî®ÊñπÂºè
                    this.openConnection(device, { ...connection, type: 'SSH' });
                },
                
                openSerial(device, connection) {
                    this.terminalInfo = {
                        title: `Telnet - ${device.name} (${connection.ip}:${connection.port})`
                    };
                    // ÈáçÁΩÆÂºπÁ™óÁä∂ÊÄÅ
                    this.terminalMaximized = false;
                    this.terminalPosition = { x: 0, y: 0 };
                    this.showTerminalModal = true;
                    
                    // Á≠âÂæÖDOMÊõ¥Êñ∞ÂêéÂàùÂßãÂåñÁªàÁ´Ø
                    this.$nextTick(() => {
                        // Á°Æ‰øùÂºπÁ™ótransformÊ≠£Á°Æ
                        const modalContent = this.$refs.terminalModalContent;
                        if (modalContent) {
                            modalContent.style.transform = 'translate(-50%, -50%)';
                        }
                        this.initTerminal();
                        
                        this.term.writeln('Ê≠£Âú®Âª∫Á´ãTelnetËøûÊé•...');
                        this.term.writeln(`ÁõÆÊ†á: ${connection.ip}:${connection.port}`);
                        this.term.writeln('ËØ∑Á®çÂÄô...\r\n');
                        
                        // ÁîüÊàêÂîØ‰∏Äsession_id
                        const sessionId = 'telnet_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        this.terminalSessionId = sessionId;
                        
                        // ÂèëÈÄÅTelnetËøûÊé•ËØ∑Ê±Ç
                        if (this.socket && this.socket.connected) {
                            this.socket.emit('telnet_connect', {
                                session_id: sessionId,
                                host: connection.ip,
                                port: parseInt(connection.port)
                            });
                        } else {
                            this.term.writeln('\r\n========================================');
                            this.term.writeln('‚ùå ÈîôËØØÔºöWebSocketÊú™ËøûÊé•');
                            this.term.writeln('========================================');
                            this.term.writeln('ËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                        }
                    });
                },
                
                initTerminal() {
                    // ÈîÄÊØÅÊóßÁªàÁ´Ø
                    if (this.term) {
                        try {
                            this.term.dispose();
                        } catch (e) {
                            console.warn('Terminal disposal error:', e);
                        }
                        this.term = null;
                    }
                    this.fitAddon = null;
                    
                    // ÂàõÂª∫Êñ∞ÁªàÁ´Ø
                    this.term = new Terminal({
                        cursorBlink: true,
                        fontSize: 14,
                        fontFamily: 'Courier New, monospace',
                        theme: {
                            background: '#000000',
                            foreground: '#ffffff',
                            cursor: '#00ff00',
                            cursorAccent: '#00ff00',
                            selection: 'rgba(255, 255, 255, 0.3)'
                        },
                        cols: 80,
                        rows: 24
                    });
                    
                    // ÂàõÂª∫FitAddonÁî®‰∫éËá™ÈÄÇÂ∫îÂ§ßÂ∞è
                    this.fitAddon = new FitAddon.FitAddon();
                    this.term.loadAddon(this.fitAddon);
                    
                    // ÊåÇËΩΩÂà∞DOM
                    const container = document.getElementById('xterm-container');
                    container.innerHTML = ''; // Ê∏ÖÁ©∫ÂÆπÂô®
                    this.term.open(container);
                    this.fitAddon.fit();
                    
                    // ËÅöÁÑ¶ÁªàÁ´Ø
                    this.term.focus();
                    
                    // ÁõëÂê¨Áî®Êà∑ËæìÂÖ•
                    this.term.onData(data => {
                        if (this.socket && this.terminalSessionId) {
                            this.socket.emit('terminal_input', {
                                session_id: this.terminalSessionId,
                                data: data
                            });
                        }
                    });
                    
                    // Á™óÂè£Â§ßÂ∞èÊîπÂèòÊó∂Ëá™ÈÄÇÂ∫î
                    window.addEventListener('resize', () => {
                        if (this.fitAddon) {
                            this.fitAddon.fit();
                        }
                    });
                },
                
                closeTerminal() {
                    if (this.socket && this.terminalSessionId) {
                        this.socket.emit('close_terminal', {
                            session_id: this.terminalSessionId
                        });
                    }
                    
                    // ÈîÄÊØÅÁªàÁ´Ø
                    if (this.term) {
                        try {
                            this.term.dispose();
                        } catch (e) {
                            console.warn('Terminal disposal error:', e);
                        }
                        this.term = null;
                    }
                    
                    this.fitAddon = null;
                    this.showTerminalModal = false;
                    this.terminalOutput = '';
                    this.terminalSessionId = null;
                    this.terminalMaximized = false;
                    this.terminalPosition = { x: 0, y: 0 };
                },

                toggleMaximizeTerminal() {
                    this.terminalMaximized = !this.terminalMaximized;
                    
                    // ÊúÄÂ§ßÂåñÊó∂ÈáçÁΩÆÊãñÂä®‰ΩçÁΩÆ
                    if (this.terminalMaximized) {
                        this.terminalPosition = { x: 0, y: 0 };
                        const modalContent = this.$refs.terminalModalContent;
                        if (modalContent) {
                            modalContent.style.transform = '';
                        }
                    }
                    
                    // ÊúÄÂ§ßÂåñÊàñËøòÂéüÂêéÈáçÊñ∞Ë∞ÉÊï¥ÁªàÁ´ØÂ§ßÂ∞èÂπ∂ËÅöÁÑ¶
                    this.$nextTick(() => {
                        if (this.fitAddon && this.term) {
                            // Á¨¨‰∏ÄÊ¨°Ë∞ÉÊï¥
                            setTimeout(() => {
                                this.fitAddon.fit();
                            }, 50);
                            
                            // Á¨¨‰∫åÊ¨°Ë∞ÉÊï¥ÔºàÁ°Æ‰øùCSSÂä®ÁîªÂÆåÊàêÔºâ
                            setTimeout(() => {
                                this.fitAddon.fit();
                                this.term.focus();
                            }, 200);
                            
                            // Á¨¨‰∏âÊ¨°Ë∞ÉÊï¥ÔºàÊúÄÁªàÁ°ÆËÆ§Ôºâ
                            setTimeout(() => {
                                this.fitAddon.fit();
                            }, 400);
                        }
                    });
                },

                startDragTerminal(e) {
                    // Â¶ÇÊûúÊòØÊúÄÂ§ßÂåñÁä∂ÊÄÅÔºå‰∏çÂÖÅËÆ∏ÊãñÂä®
                    if (this.terminalMaximized) return;
                    
                    // Âè™ÊúâÁÇπÂáªheaderÂå∫ÂüüÊâçËÉΩÊãñÂä®Ôºà‰∏çÂåÖÊã¨ÊåâÈíÆÔºâ
                    if (e.target.tagName === 'BUTTON' || e.target.closest('button')) return;
                    
                    this.terminalDragging = true;
                    this.terminalDragStart = {
                        x: e.clientX - this.terminalPosition.x,
                        y: e.clientY - this.terminalPosition.y
                    };
                    
                    document.addEventListener('mousemove', this.onDragTerminal);
                    document.addEventListener('mouseup', this.stopDragTerminal);
                    e.preventDefault();
                },

                onDragTerminal(e) {
                    if (!this.terminalDragging) return;
                    
                    const modalContent = this.$refs.terminalModalContent;
                    if (!modalContent) return;
                    
                    // ËÆ°ÁÆóÊñ∞‰ΩçÁΩÆ
                    let newX = e.clientX - this.terminalDragStart.x;
                    let newY = e.clientY - this.terminalDragStart.y;
                    
                    // Ëé∑ÂèñÂºπÁ™óÂíåËßÜÂè£Â∞∫ÂØ∏
                    const modalRect = modalContent.getBoundingClientRect();
                    const modalWidth = modalRect.width;
                    const modalHeight = modalRect.height;
                    const viewportWidth = window.innerWidth;
                    const viewportHeight = window.innerHeight;
                    
                    // ËÆ°ÁÆóËæπÁïåÈôêÂà∂
                    const minX = -(viewportWidth / 2 - 100); // Â∑¶ËæπÁïåÔºåËá≥Â∞ë‰øùÁïô100pxÂèØËßÅ
                    const maxX = viewportWidth / 2 - 100; // Âè≥ËæπÁïå
                    const minY = -(viewportHeight / 2 - 50); // ‰∏äËæπÁïåÔºåËá≥Â∞ë‰øùÁïô50pxÔºàheaderÈ´òÂ∫¶Ôºâ
                    const maxY = viewportHeight / 2 - 50; // ‰∏ãËæπÁïå
                    
                    // ÈôêÂà∂Âú®ËæπÁïåÂÜÖ
                    newX = Math.max(minX, Math.min(maxX, newX));
                    newY = Math.max(minY, Math.min(maxY, newY));
                    
                    this.terminalPosition = { x: newX, y: newY };
                    modalContent.style.transform = `translate(calc(-50% + ${newX}px), calc(-50% + ${newY}px))`;
                },

                stopDragTerminal() {
                    this.terminalDragging = false;
                    document.removeEventListener('mousemove', this.onDragTerminal);
                    document.removeEventListener('mouseup', this.stopDragTerminal);
                },

                handleTerminalDragOver(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const container = this.$refs.terminalContainer;
                    if (container && !container.classList.contains('drag-over')) {
                        container.classList.add('drag-over');
                    }
                },

                handleTerminalDragLeave(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const container = this.$refs.terminalContainer;
                    if (container && e.target === container) {
                        container.classList.remove('drag-over');
                    }
                },

                handleTerminalFileDrop(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const container = this.$refs.terminalContainer;
                    if (container) {
                        container.classList.remove('drag-over');
                    }

                    const files = e.dataTransfer.files;
                    if (files.length === 0) {
                        return;
                    }

                    const file = files[0];
                    
                    // Êñá‰ª∂Â§ßÂ∞èÈôêÂà∂Ôºö1GB
                    const maxSize = 1024 * 1024 * 1024;
                    if (file.size > maxSize) {
                        if (this.term) {
                            this.term.writeln(`\r\n‚ùå ÈîôËØØ: Êñá‰ª∂Â§ßÂ∞èË∂ÖËøáÈôêÂà∂ (ÊúÄÂ§ß1GB)\r\n`);
                        }
                        return;
                    }
                    
                    // ÊòæÁ§∫‰∏ä‰º†‰ø°ÊÅØ
                    if (this.term) {
                        this.term.writeln(`\r\nüì§ ÂáÜÂ§á‰∏ä‰º†Êñá‰ª∂: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`);
                        this.term.writeln(`‚è≥ Ê≠£Âú®ËØªÂèñÊñá‰ª∂...\r\n`);
                    }

                    // ËØªÂèñÊñá‰ª∂Âπ∂ÈÄöËøáWebSocketÂèëÈÄÅ
                    const reader = new FileReader();
                    
                    // ËØªÂèñËøõÂ∫¶
                    reader.onprogress = (e) => {
                        if (e.lengthComputable && this.term) {
                            const percentComplete = Math.round((e.loaded / e.total) * 100);
                            // ‰ΩøÁî® \r ÂõûÂà∞Ë°åÈ¶ñÊõ¥Êñ∞ËøõÂ∫¶
                            this.term.write(`\rüìñ ËØªÂèñËøõÂ∫¶: ${percentComplete}%`);
                        }
                    };
                    
                    reader.onload = (event) => {
                        const fileData = event.target.result;
                        
                        if (this.term) {
                            this.term.writeln(`\rüìñ ËØªÂèñËøõÂ∫¶: 100%`);
                        }
                        
                        if (this.socket && this.socket.connected && this.terminalSessionId) {
                            if (this.term) {
                                this.term.writeln(`‚è≥ Ê≠£Âú®‰∏ä‰º†Êñá‰ª∂Âà∞ÊúçÂä°Âô®...\r\n`);
                            }
                            
                            const startTime = Date.now();
                            
                            // ÂèëÈÄÅÊñá‰ª∂‰∏ä‰º†ËØ∑Ê±Ç
                            try {
                                this.socket.emit('upload_file', {
                                    session_id: this.terminalSessionId,
                                    filename: file.name,
                                    filedata: fileData,
                                    filesize: file.size
                                }, (response) => {
                                    // ‰∏ä‰º†ÂÆåÊàêÂõûË∞É
                                    const duration = ((Date.now() - startTime) / 1000).toFixed(2);
                                    
                                    if (response && response.error) {
                                        if (this.term) {
                                            this.term.writeln(`‚ùå ‰∏ä‰º†Â§±Ë¥•: ${response.error}\r\n`);
                                        }
                                    } else {
                                        if (this.term) {
                                            this.term.writeln(`‚úÖ ‰∏ä‰º†ÂÆåÊàêÔºÅËÄóÊó∂: ${duration}Áßí\r\n`);
                                        }
                                    }
                                });
                                
                                // Ê®°Êãü‰∏ä‰º†ËøõÂ∫¶ÔºàÂõ†‰∏∫Socket.IO emit‰∏çÊîØÊåÅÂéüÁîüËøõÂ∫¶Ôºâ
                                let progress = 0;
                                const progressInterval = setInterval(() => {
                                    if (progress < 90) {
                                        progress += 10;
                                        if (this.term) {
                                            this.term.write(`\r‚¨ÜÔ∏è  ‰∏ä‰º†ËøõÂ∫¶: ${progress}%`);
                                        }
                                    } else {
                                        clearInterval(progressInterval);
                                    }
                                }, 200);
                                
                                // Ê∏ÖÁêÜÂÆöÊó∂Âô®
                                setTimeout(() => {
                                    clearInterval(progressInterval);
                                    if (this.term) {
                                        this.term.write(`\r‚¨ÜÔ∏è  ‰∏ä‰º†ËøõÂ∫¶: 100%\r\n`);
                                    }
                                }, 5000);
                                
                            } catch (error) {
                                if (this.term) {
                                    this.term.writeln(`‚ùå ÂèëÈÄÅÂ§±Ë¥•: ${error.message}\r\n`);
                                }
                            }
                        } else {
                            if (this.term) {
                                this.term.writeln(`‚ùå ÈîôËØØ: Socket.IOÊú™ËøûÊé•Êàñ‰ºöËØùÊó†Êïà\r\n`);
                            }
                        }
                    };
                    
                    reader.onerror = () => {
                        if (this.term) {
                            this.term.writeln(`‚ùå ÈîôËØØ: Êñá‰ª∂ËØªÂèñÂ§±Ë¥•\r\n`);
                        }
                    };
                    
                    reader.readAsDataURL(file);
                },
                
                dragOver(e) {
                    e.currentTarget.classList.add('dragover');
                },
                
                handleDrop(e) {
                    e.currentTarget.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.uploadFile(files[0]);
                    }
                },
                
                handleFileUpload(e) {
                    const file = e.target.files[0];
                    if (file) {
                        this.uploadFile(file);
                    }
                },
                
                uploadFile(file) {
                    this.showMessage('‰∏ä‰º†Êñá‰ª∂', `Êñá‰ª∂ ${file.name} ÂáÜÂ§á‰∏ä‰º†\n\nÊ≠§ÂäüËÉΩÈúÄË¶ÅÂêéÁ´ØÊîØÊåÅÔºåÂΩìÂâç‰∏∫ÊºîÁ§∫Ê®°Âºè„ÄÇ`, 'info');
                },
                
                confirmAction(title, message, onConfirm) {
                    this.confirmDialog = {
                        show: true,
                        title: title,
                        message: message,
                        type: 'warning',
                        icon: '‚ö†Ô∏è',
                        onConfirm: onConfirm
                    };
                },
                
                showMessage(title, message, type = 'success') {
                    const icons = {
                        success: '‚úÖ',
                        error: '‚ùå',
                        warning: '‚ö†Ô∏è',
                        info: '‚ÑπÔ∏è'
                    };
                    
                    this.messageDialog = {
                        show: true,
                        title: title,
                        message: message,
                        type: type,
                        icon: icons[type] || icons.info
                    };
                },
                
                async checkConnection() {
                    try {
                        await axios.get(`${this.apiBaseUrl}/health`, { timeout: 3000 });
                        if (this.connectionStatus === 'offline') {
                            this.showMessage('ËøûÊé•ÊÅ¢Â§ç', 'Â∑≤ÊàêÂäüËøûÊé•Âà∞ÂêéÁ´ØÊúçÂä°Âô®', 'success');
                            this.loadAllData(); // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
                        }
                        this.connectionStatus = 'online';
                    } catch (error) {
                        this.connectionStatus = 'offline';
                    }
                },
                
                retryConnection() {
                    this.connectionStatus = 'checking';
                    this.checkConnection();
                },
                
                // Socket.IOÁõ∏ÂÖ≥ÊñπÊ≥ï
                initSocket() {
                    try {
                        this.socket = io({
                            transports: ['polling'],
                            upgrade: false,
                            reconnection: true,
                            reconnectionDelay: 1000,
                            reconnectionAttempts: 10,
                            timeout: 60000,
                            pingTimeout: 60000,
                            pingInterval: 25000
                        });
                        
                        this.socket.on('connect', () => {
                            console.log('Socket.IOÂ∑≤ËøûÊé•');
                        });
                        
                        this.socket.on('disconnect', (reason) => {
                            // Âè™Âú®ÈùûÊ≠£Â∏∏Êñ≠ÂºÄÊó∂ÊòæÁ§∫Ë≠¶Âëä
                            if (reason !== 'io client disconnect' && reason !== 'io server disconnect') {
                                console.warn('Socket.IOËøûÊé•Êñ≠ÂºÄ:', reason);
                            } else {
                                console.log('Socket.IOÂ∑≤Êñ≠ÂºÄ');
                            }
                        });
                        
                        this.socket.on('reconnect', (attemptNumber) => {
                            console.log('Socket.IOÈáçËøûÊàêÂäüÔºåÂ∞ùËØïÊ¨°Êï∞:', attemptNumber);
                        });
                        
                        this.socket.on('reconnect_error', (error) => {
                            console.error('Socket.IOÈáçËøûÂ§±Ë¥•:', error);
                        });
                        
                        // SSH/TelnetËøûÊé•ÊàêÂäü
                        this.socket.on('terminal_connected', (data) => {
                            this.terminalSessionId = data.session_id;
                            if (this.term) {
                                this.term.writeln('\r\n========================================');
                                this.term.writeln(`‚úÖ ${data.type === 'ssh' ? 'SSH' : 'Telnet'} ËøûÊé•ÊàêÂäüÔºÅ`);
                                this.term.writeln('========================================');
                                this.term.writeln(`‰ºöËØùID: ${data.session_id}`);
                                if (data.message) {
                                    this.term.writeln(data.message);
                                }
                                this.term.writeln('\r\nÊÇ®Áé∞Âú®ÂèØ‰ª•ËæìÂÖ•ÂëΩ‰ª§‰∫Ü...\r\n');
                            }
                        });
                        
                        // Êé•Êî∂ÁªàÁ´ØËæìÂá∫
                        this.socket.on('terminal_output', (data) => {
                            if (data.session_id === this.terminalSessionId && this.term) {
                                // xterm.js Ëá™Âä®Â§ÑÁêÜÊâÄÊúâANSIÁ†ÅÂíåÊéßÂà∂Â≠óÁ¨¶
                                this.term.write(data.data);
                            }
                        });
                        
                        // ËøûÊé•ÈîôËØØ
                        this.socket.on('terminal_error', (data) => {
                            if (this.term) {
                                this.term.writeln('\r\n\r\n========================================');
                                this.term.writeln('‚ùå ËøûÊé•Â§±Ë¥•');
                                this.term.writeln('========================================');
                                this.term.writeln(`ÈîôËØØ‰ø°ÊÅØ: ${data.error}`);
                                this.term.writeln('\r\nËØ∑Ê£ÄÊü•:');
                                this.term.writeln('1. ÁõÆÊ†á‰∏ªÊú∫IPÂíåÁ´ØÂè£ÊòØÂê¶Ê≠£Á°Æ');
                                this.term.writeln('2. ÁΩëÁªúËøûÊé•ÊòØÂê¶Ê≠£Â∏∏');
                                this.term.writeln('3. SSH/TelnetÊúçÂä°ÊòØÂê¶Â∑≤ÂêØÂä®');
                                this.term.writeln('4. Áî®Êà∑ÂêçÂíåÂØÜÁ†ÅÊòØÂê¶Ê≠£Á°ÆÔºàSSHÔºâ');
                                this.term.writeln('========================================');
                            }
                        });
                        
                        // ËøûÊé•ÂÖ≥Èó≠
                        this.socket.on('terminal_closed', (data) => {
                            if (data.session_id === this.terminalSessionId && this.term) {
                                this.term.writeln('\r\n\r\nËøûÊé•Â∑≤ÂÖ≥Èó≠');
                            }
                        });
                        
                    } catch (error) {
                        console.error('Socket.IOÂàùÂßãÂåñÂ§±Ë¥•:', error);
                    }
                }
                // Ëøô‰∫õÂáΩÊï∞Â∑≤‰∏çÂÜçÈúÄË¶ÅÔºåxterm.js Ëá™Âä®Â§ÑÁêÜÊâÄÊúâÁªàÁ´ØÈÄªËæë
            }
        }).mount('#app');
    </script>
</body>
</html>
