<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾å¤‡ä½¿ç”¨ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="static/js/vue.global.js"></script>
    <script src="static/js/axios.min.js"></script>
    <script src="static/js/socket.io.min.js"></script>
    <!-- Xterm.js -->
    <link rel="stylesheet" href="static/css/xterm.min.css" />
    <script src="static/js/xterm.min.js"></script>
    <script src="static/js/xterm-addon-fit.min.js"></script>
    <!-- XLSX for Excel import/export -->
    <script src="static/js/xlsx.full.min.js"></script>
    <!-- Chart.js for charts -->
    <script src="static/js/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(168, 85, 247, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        #app {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* ç™»å½•å¼¹çª—è¡¨å•æ ·å¼ */
        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-form label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .login-form input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
            box-sizing: border-box;
            background: #f7fafc;
        }

        .login-form input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* å¯†ç è¾“å…¥æ¡†å®¹å™¨ */
        .password-input-wrapper {
            position: relative;
        }

        .password-input-wrapper input {
            padding-right: 45px;
        }

        /* å¯†ç æ˜¾ç¤º/éšè—æŒ‰é’® */
        .password-toggle-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #999;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s;
        }

        .password-toggle-btn:hover {
            color: #667eea;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 24px 32px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: #f7fafc;
            border-radius: 20px;
        }

        .user-info span {
            color: #666;
            font-size: 14px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            background: #667eea;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: #764ba2;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #f56565;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #e53e3e;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 12px;
            background: #f7fafc;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.online {
            background: #48bb78;
        }

        .status-dot.offline {
            background: #f56565;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* æœç´¢å’Œè¿‡æ»¤å™¨æ ·å¼ */
        /* æ•´åˆçš„åˆ—è¡¨å¤´éƒ¨åŒºåŸŸ */
        .list-header-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .title-stats-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f4f8;
            gap: 20px;
        }

        .title-stats-row h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
            color: #2d3748;
            flex-shrink: 0;
        }

        .stats-inline-group {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-tags-row {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .header-search-box {
            flex: 1;
            max-width: 350px;
            position: relative;
        }

        .header-search-box input {
            width: 100%;
            padding: 8px 12px 8px 35px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        .header-search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .header-search-box .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
        }
        
        /* title-stats-row ä¸­çš„æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        .title-stats-row .btn {
            padding: 6px 12px;
            font-size: 13px;
            white-space: nowrap;
        }

        .stats-filter-row {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
            flex-wrap: wrap;
        }

        .inline-stat-card {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: #f7fafc;
            border-radius: 6px;
            border: 2px solid #e2e8f0;
        }

        .inline-stat-card.success {
            background: #f0fff4;
            border-color: #9ae6b4;
        }

        .inline-stat-card.danger {
            background: #fff5f5;
            border-color: #fc8181;
        }

        .inline-stat-card.warning {
            background: #fffaf0;
            border-color: #fbd38d;
        }

        .stat-label {
            font-size: 12px;
            color: #718096;
            font-weight: 500;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 700;
            color: #2d3748;
        }

        .inline-stat-card.success .stat-value {
            color: #38a169;
        }

        .inline-stat-card.danger .stat-value {
            color: #e53e3e;
        }

        .inline-stat-card.warning .stat-value {
            color: #dd6b20;
        }

        .filter-divider {
            width: 2px;
            height: 30px;
            background: #e2e8f0;
            margin: 0 5px;
        }

        .count-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .search-filter-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .search-filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 0 0 350px;
            min-width: 280px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 10px 12px 10px 38px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: #f7fafc;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-select {
            padding: 7px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.5;
            cursor: pointer;
            background: white;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .tag-filter {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .tag-filter-label {
            color: #666;
            font-size: 13px;
            line-height: 1.5;
            font-weight: normal;
            margin-right: 5px;
        }

        .tag-chip {
            padding: 7px 14px;
            background: rgba(226, 232, 240, 0.6);
            backdrop-filter: blur(5px);
            border: 2px solid transparent;
            border-radius: 20px;
            font-size: 13px;
            line-height: 1.5;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag-chip:hover {
            background: rgba(203, 213, 224, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .tag-chip.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
        }

        .content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            color: #333;
            font-size: 24px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5568d3 0%, #653a8b 100%);
        }

        .btn-primary:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #dd6b20 0%, #c05621 100%);
        }

        .btn-info {
            background: #4299e1;
            color: white;
        }

        .btn-info:hover {
            background: #3182ce;
        }

        .devices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .user-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .user-card:hover {
            border-color: #cbd5e0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .user-card-selected {
            border-color: #667eea !important;
            background: #f7f9ff !important;
        }

        .user-card-checkbox {
            position: absolute;
            top: 12px;
            right: 12px;
        }

        .user-card-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .user-card-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 10px;
        }

        .user-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .user-info {
            flex: 1;
            min-width: 0;
            padding-right: 25px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .user-name {
            font-size: 16px;
            font-weight: 700;
            color: #1a202c;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .user-account {
            font-size: 13px;
            color: #667eea;
            font-weight: 600;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .user-department-row {
            font-size: 13px;
            color: #4a5568;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .user-date {
            font-size: 11px;
            color: #a0aec0;
        }

        .user-meta {
            font-size: 12px;
            color: #718096;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .user-department {
            display: inline-block;
            padding: 2px 6px;
            background: #edf2f7;
            border-radius: 3px;
            font-size: 11px;
            color: #4a5568;
            word-wrap: break-word;
            word-break: break-all;
            line-height: 1.4;
        }

        .user-card-actions {
            display: flex;
            gap: 8px;
            padding-top: 10px;
            border-top: 1px solid #edf2f7;
            margin-top: auto;
        }

        .device-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            height: 400px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .device-card:hover {
            border-color: #cbd5e0;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transform: translateY(-4px);
        }
        
        .device-card.selected {
            border: 3px solid #667eea !important;
            background: #f7faff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        .device-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            cursor: pointer;
        }
        
        .device-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .device-card.available {
            border-left: 5px solid #48bb78;
            border-top-color: #48bb78;
        }

        .device-card.available:hover {
            border-color: #48bb78;
            box-shadow: 0 20px 25px -5px rgba(72, 187, 120, 0.2), 0 10px 10px -5px rgba(72, 187, 120, 0.1);
        }

        .device-card.occupied {
            border-left: 5px solid #f56565;
            border-top-color: #f56565;
            background: #fffafa;
        }

        .device-card.occupied:hover {
            border-color: #f56565;
            box-shadow: 0 20px 25px -5px rgba(245, 101, 101, 0.2), 0 10px 10px -5px rgba(245, 101, 101, 0.1);
        }

        .device-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 2px solid #edf2f7;
        }

        .device-name {
            font-size: 20px;
            font-weight: 700;
            color: #1a202c;
            letter-spacing: -0.5px;
        }

        .status-badge {
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            border: 2px solid;
        }

        .status-badge.available {
            background: #f0fff4;
            color: #22543d;
            border-color: #48bb78;
        }

        .status-badge.occupied {
            background: #fff5f5;
            color: #742a2a;
            border-color: #f56565;
        }

        .device-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .device-tag {
            padding: 4px 10px;
            background: #edf2f7;
            border-radius: 4px;
            font-size: 12px;
            color: #5a67d8;
            font-weight: 600;
            transition: all 0.2s;
        }

        .device-tag:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        .device-content-scroll {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
            padding-right: 8px;
            margin-right: -8px;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .device-content-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .device-content-scroll::-webkit-scrollbar-track {
            background: rgba(241, 241, 241, 0.5);
            border-radius: 3px;
        }

        .device-content-scroll::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #cbd5e0 0%, #a0aec0 100%);
            border-radius: 3px;
        }

        .device-content-scroll::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
        }

        .device-info p {
            color: #4a5568;
            margin: 6px 0;
            font-size: 14px;
            line-height: 1.5;
        }

        .device-info p strong {
            color: #1a202c;
            font-weight: 600;
            min-width: 70px;
            display: inline-block;
        }

        .password-row {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .password-row span {
            flex-shrink: 0;
        }

        .icon-btn-inline {
            padding: 2px 6px !important;
            font-size: 14px !important;
            line-height: 1 !important;
            vertical-align: middle;
        }

        .device-connections {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px solid #edf2f7;
        }

        .device-connections > p {
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .connection-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 6px 0;
            padding: 6px 8px;
            background: #f7fafc;
            border-radius: 6px;
            font-size: 13px;
            transition: background 0.2s;
        }

        .connection-item:hover {
            background: #edf2f7;
        }

        .connection-item span {
            color: #4a5568;
            font-weight: 500;
        }

        .connection-btn {
            padding: 6px 14px;
            font-size: 12px;
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(66, 153, 225, 0.25);
        }

        .connection-btn:hover {
            background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.35);
        }

        .device-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
            padding-top: 14px;
            border-top: 2px solid #edf2f7;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .device-actions button {
            flex: 1;
            min-width: 80px;
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 600;
        }

        .icon-btn {
            background: #edf2f7;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            font-size: 16px;
            padding: 5px 8px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: #667eea;
            border-color: #667eea;
            transform: scale(1.1);
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        .icon-btn:active {
            transform: scale(1.05);
        }

        /* å¼¹çª—é®ç½©å±‚ */
        .modal, .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: #333;
            font-size: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            line-height: 1;
            transition: color 0.3s;
            position: relative;
            z-index: 10;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .connection-list {
            margin-top: 10px;
        }

        .connection-entry {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: flex-end;
        }

        .connection-entry button {
            padding: 10px 15px;
            min-width: auto;
        }

        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            min-height: 45px;
        }

        .tags-input:focus-within {
            border-color: #667eea;
        }

        .tag-item {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border-radius: 15px;
            font-size: 13px;
        }

        .tag-item button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            padding: 0;
        }

        .tag-input-field {
            flex: 1;
            border: none;
            outline: none;
            padding: 5px;
            min-width: 100px;
        }

        .purpose-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .suggestion-chip {
            padding: 6px 12px;
            background: #edf2f7;
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .suggestion-chip:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡† */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s;
        }

        .confirm-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: slideIn 0.3s;
        }

        .confirm-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .confirm-icon.warning {
            color: #ed8936;
        }

        .confirm-icon.success {
            color: #48bb78;
        }

        .confirm-icon.error {
            color: #f56565;
        }

        .confirm-icon.info {
            color: #4299e1;
        }

        .confirm-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .confirm-message {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .confirm-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        table th {
            background: #f7fafc;
            color: #333;
            font-weight: 600;
        }

        table th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            transition: background 0.2s;
        }

        table th.sortable:hover {
            background: #edf2f7;
        }

        .sort-icon {
            margin-left: 5px;
            color: #667eea;
            font-weight: bold;
        }

        table tr:hover {
            background: #f7fafc;
        }
        
        .record-filters {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .filter-row {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .record-search {
            flex: 1;
            min-width: 250px;
            padding: 10px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: #f7fafc;
            transition: all 0.3s;
        }
        
        .record-search:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .filter-select {
            padding: 10px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: #f7fafc;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn-secondary {
            background: #edf2f7;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
            border-color: #cbd5e0;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .ranking-list {
            list-style: none;
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .ranking-item:last-child {
            border-bottom: none;
        }

        .ranking-number {
            font-weight: bold;
            color: #667eea;
            margin-right: 15px;
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-count {
            color: #999;
            font-size: 14px;
        }

        /* Webç»ˆç«¯æ ·å¼ */
        .terminal-modal {
            z-index: 10000;
            animation: none;
            display: block;
        }

        .terminal-modal .modal-content {
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            padding: 0;
            background: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
        }

        .terminal-modal .modal-content.maximized {
            max-width: 100%;
            width: 100vw !important;
            max-height: 100vh;
            height: 100vh !important;
            border-radius: 0;
            top: 0 !important;
            left: 0 !important;
            transform: none !important;
            display: flex;
            flex-direction: column;
        }

        .terminal-modal .modal-header {
            background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
            padding: 15px 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
            height: 51px;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .terminal-modal .modal-header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .terminal-modal .maximize-btn {
            color: #999;
            font-size: 16px;
            padding: 0 10px;
            cursor: pointer;
            background: none;
            border: none;
        }

        .terminal-modal .maximize-btn:hover {
            color: #fff;
        }

        .terminal-modal .modal-header h3 {
            margin: 0;
            font-size: 16px;
            color: #fff;
            font-weight: 500;
        }

        .terminal-modal .close-btn {
            color: #999;
            font-size: 20px;
            padding: 0 10px;
        }

        .terminal-modal .close-btn:hover {
            color: #fff;
        }

        .terminal-container {
            background: #000;
            height: 600px;
            width: 100%;
            overflow: hidden;
            position: relative;
            transition: background-color 0.3s;
            flex: 1;
            min-height: 0;
        }

        .terminal-container.drag-over {
            background: rgba(102, 126, 234, 0.1);
            outline: 2px dashed #667eea;
            outline-offset: -10px;
        }

        .terminal-container.drag-over::after {
            content: 'ğŸ“ æ‹–æ”¾æ–‡ä»¶åˆ°è¿™é‡Œä¸Šä¼ ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #667eea;
            font-size: 18px;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 40px;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
        }

        .terminal-modal .modal-content.maximized .terminal-container {
            height: calc(100vh - 51px);
            width: 100%;
            flex: 1;
        }

        /* xterm.js æ ·å¼è°ƒæ•´ */
        #xterm-container {
            height: 100%;
            width: 100%;
            padding: 0;
        }

        #xterm-container .xterm {
            height: 100% !important;
            width: 100% !important;
            padding: 15px;
        }
        
        #xterm-container .xterm-viewport {
            background-color: #000 !important;
            width: 100% !important;
        }

        #xterm-container .xterm-screen {
            height: 100%;
            width: 100% !important;
        }

        .upload-area {
            margin-top: 15px;
            padding: 20px;
            border: 2px dashed #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: #edf2f7;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ç®¡ç†å‘˜ç™»å½•å¼¹çª— -->
        <div v-if="showLoginModal" class="modal-overlay">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h3>ğŸ” ç®¡ç†å‘˜ç™»å½•</h3>
                    <button class="close-btn" @click="showLoginModal = false">âœ•</button>
                </div>
                <div class="modal-body">
                    <form class="login-form" @submit.prevent="login">
                        <div class="form-group">
                            <label>ç”¨æˆ·å</label>
                            <input v-model="loginForm.username" type="text" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜ç”¨æˆ·å" required>
                        </div>
                        <div class="form-group">
                            <label>å¯†ç </label>
                            <input v-model="loginForm.password" type="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">ç™»å½•</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- æ™®é€šç”¨æˆ·ç™»å½•å¼¹çª— -->
        <div v-if="showUserLoginModal" class="modal-overlay">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h3>ğŸ‘¤ ç”¨æˆ·ç™»å½•</h3>
                    <button class="close-btn" @click="showUserLoginModal = false">âœ•</button>
                </div>
                <div class="modal-body">
                    <form class="login-form" @submit.prevent="userLogin">
                        <div class="form-group">
                            <label>è´¦å·</label>
                            <input v-model="userLoginForm.account" type="text" placeholder="è¯·è¾“å…¥è´¦å·" required>
                        </div>
                        <div class="form-group">
                            <label>å¯†ç </label>
                            <input v-model="userLoginForm.password" type="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                        </div>
                        <div style="margin-top: 10px; color: #999; font-size: 13px;">
                            <p>ğŸ’¡ é¦–æ¬¡ç™»å½•é»˜è®¤å¯†ç ï¼š123456</p>
                            <p style="margin-top: 5px;">ç™»å½•åå¯åœ¨å³ä¸Šè§’ä¿®æ”¹å¯†ç </p>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">ç™»å½•</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ä¿®æ”¹å¯†ç å¼¹çª— -->
        <div v-if="showChangePasswordModal" class="modal-overlay">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h3>ğŸ”‘ ä¿®æ”¹å¯†ç </h3>
                    <button class="close-btn" @click="closeChangePasswordModal">âœ•</button>
                </div>
                <div class="modal-body">
                    <form class="login-form" @submit.prevent="changePassword">
                        <div class="form-group">
                            <label>åŸå¯†ç </label>
                            <div class="password-input-wrapper">
                                <input v-model="passwordForm.oldPassword" :type="showOldPassword ? 'text' : 'password'" placeholder="è¯·è¾“å…¥åŸå¯†ç " required>
                                <button type="button" class="password-toggle-btn" @click="showOldPassword = !showOldPassword" :title="showOldPassword ? 'éšè—å¯†ç ' : 'æ˜¾ç¤ºå¯†ç '">
                                    {{ showOldPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>æ–°å¯†ç </label>
                            <div class="password-input-wrapper">
                                <input v-model="passwordForm.newPassword" :type="showNewPassword ? 'text' : 'password'" placeholder="è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required minlength="6">
                                <button type="button" class="password-toggle-btn" @click="showNewPassword = !showNewPassword" :title="showNewPassword ? 'éšè—å¯†ç ' : 'æ˜¾ç¤ºå¯†ç '">
                                    {{ showNewPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ç¡®è®¤æ–°å¯†ç </label>
                            <div class="password-input-wrapper">
                                <input v-model="passwordForm.confirmPassword" :type="showConfirmPassword ? 'text' : 'password'" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " required minlength="6">
                                <button type="button" class="password-toggle-btn" @click="showConfirmPassword = !showConfirmPassword" :title="showConfirmPassword ? 'éšè—å¯†ç ' : 'æ˜¾ç¤ºå¯†ç '">
                                    {{ showConfirmPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
                                </button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" class="btn btn-secondary" style="flex: 1;" @click="closeChangePasswordModal">å–æ¶ˆ</button>
                            <button type="submit" class="btn btn-primary" style="flex: 1;">ç¡®è®¤ä¿®æ”¹</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- æ·»åŠ ç”¨æˆ·æ¨¡æ€æ¡† -->
        <div v-if="showAddUserModal" class="modal-overlay">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h3>â• æ·»åŠ æˆæƒç”¨æˆ·</h3>
                    <button class="close-btn" @click="closeAddUserModal">âœ•</button>
                </div>
                <div class="modal-body">
                    <form @submit.prevent="addUser">
                        <div class="form-group">
                            <label>è´¦å· *</label>
                            <input v-model="newUserForm.account" type="text" placeholder="è¯·è¾“å…¥è´¦å·ï¼ˆè‹±æ–‡æˆ–æ‹¼éŸ³ï¼‰" required>
                        </div>
                        <div class="form-group">
                            <label>ä¸­æ–‡å *</label>
                            <input v-model="newUserForm.chinese_name" type="text" placeholder="è¯·è¾“å…¥ä¸­æ–‡å" required>
                        </div>
                        <div class="form-group">
                            <label>éƒ¨é—¨</label>
                            <input v-model="newUserForm.department" type="text" placeholder="è¯·è¾“å…¥éƒ¨é—¨ï¼ˆå¯é€‰ï¼‰">
                        </div>
                        <div class="form-group">
                            <label>å¯†ç </label>
                            <input v-model="newUserForm.password" type="text" placeholder="ä¸å¡«åˆ™ä½¿ç”¨é»˜è®¤å¯†ç 123456" minlength="6">
                            <small style="color: #999; margin-top: 5px; display: block;">å¯†ç è‡³å°‘6ä½ï¼Œä¸å¡«å†™åˆ™é»˜è®¤ä¸º123456</small>
                        </div>
                        <small style="color: #999; margin-top: 5px; display: block;">åªæœ‰åœ¨æ­¤åˆ—è¡¨ä¸­çš„è´¦å·æ‰èƒ½å ç”¨è®¾å¤‡</small>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" class="btn btn-secondary" style="flex: 1;" @click="closeAddUserModal">å–æ¶ˆ</button>
                            <button type="submit" class="btn btn-primary" style="flex: 1;">æ·»åŠ </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ç™»å½•æ¬¢è¿é¡µé¢ -->
        <div v-if="!isInitialized" style="display: flex; align-items: center; justify-content: center; min-height: 80vh;">
            <div style="background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 60px; max-width: 480px; width: 100%;">
                <div style="text-align: center;">
                    <div style="font-size: 64px; margin-bottom: 20px;">ğŸ–¥ï¸</div>
                    <h1 style="color: #333; margin-bottom: 10px; font-size: 32px;">è®¾å¤‡ä½¿ç”¨ç®¡ç†ç³»ç»Ÿ</h1>
                    <p style="color: #666; margin-bottom: 30px; font-size: 16px;">{{ loginPageMode === 'user' ? 'ç”¨æˆ·ç™»å½•' : 'ç®¡ç†å‘˜ç™»å½•' }}</p>
                </div>
                
                <!-- ç”¨æˆ·ç™»å½•è¡¨å• -->
                <form v-if="loginPageMode === 'user'" @submit.prevent="userLogin" class="login-form">
                    <div class="form-group">
                        <label>è´¦å·</label>
                        <input v-model="userLoginForm.account" type="text" placeholder="è¯·è¾“å…¥è´¦å·" required autofocus>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <div class="password-input-wrapper">
                            <input v-model="userLoginForm.password" :type="showUserLoginPassword ? 'text' : 'password'" placeholder="è¯·è¾“å…¥å¯†ç " required>
                            <button type="button" class="password-toggle-btn" @click="showUserLoginPassword = !showUserLoginPassword" :title="showUserLoginPassword ? 'éšè—å¯†ç ' : 'æ˜¾ç¤ºå¯†ç '">
                                {{ showUserLoginPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
                            </button>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px; font-size: 16px;">ç™»å½•</button>
                    </div>
                    <div style="text-align: center;">
                        <a href="javascript:void(0)" @click="switchLoginMode('admin')" style="color: #667eea; text-decoration: none; font-size: 14px;">åˆ‡æ¢åˆ°ç®¡ç†å‘˜ç™»å½•</a>
                    </div>
                </form>
                
                <!-- ç®¡ç†å‘˜ç™»å½•è¡¨å• -->
                <form v-else @submit.prevent="login" class="login-form">
                    <div class="form-group">
                        <label>ç”¨æˆ·å</label>
                        <input v-model="loginForm.username" type="text" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜è´¦å·" required autofocus>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <div class="password-input-wrapper">
                            <input v-model="loginForm.password" :type="showAdminLoginPassword ? 'text' : 'password'" placeholder="è¯·è¾“å…¥å¯†ç " required>
                            <button type="button" class="password-toggle-btn" @click="showAdminLoginPassword = !showAdminLoginPassword" :title="showAdminLoginPassword ? 'éšè—å¯†ç ' : 'æ˜¾ç¤ºå¯†ç '">
                                {{ showAdminLoginPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
                            </button>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px; font-size: 16px;">ç™»å½•</button>
                    </div>
                    <div style="text-align: center;">
                        <a href="javascript:void(0)" @click="switchLoginMode('user')" style="color: #667eea; text-decoration: none; font-size: 14px;">åˆ‡æ¢åˆ°ç”¨æˆ·ç™»å½•</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- ä¸»ç•Œé¢ -->
        <div v-if="isInitialized">
            <div class="header">
                <h1>ğŸ–¥ï¸ è®¾å¤‡ä½¿ç”¨ç®¡ç†ç³»ç»Ÿ</h1>
                <div class="header-right">
                    <div class="connection-status">
                        <div class="status-dot" :class="connectionStatus === 'online' ? 'online' : 'offline'"></div>
                        <span>{{ connectionStatus === 'online' ? 'å·²è¿æ¥' : (connectionStatus === 'offline' ? 'æœªè¿æ¥' : 'æ£€æŸ¥ä¸­...') }}</span>
                    </div>
                    <div class="user-info" v-if="isLoggedIn">
                        <span>ğŸ‘¤ {{ currentUser.chinese_name || currentUser.username }} ({{ currentUser.username }})</span>
                        <span v-if="currentUser.is_admin" style="color: #667eea; font-weight: bold;">ç®¡ç†å‘˜</span>
                    </div>
                    <div class="nav-tabs">
                        <button class="nav-btn" :class="{active: currentView === 'devices'}" @click="currentView = 'devices'">è®¾å¤‡åˆ—è¡¨</button>
                        <button class="nav-btn" :class="{active: currentView === 'records'}" @click="currentView = 'records'">ä½¿ç”¨è®°å½•</button>
                        <button class="nav-btn" :class="{active: currentView === 'users'}" @click="currentView = 'users'" v-if="isLoggedIn && currentUser.is_admin">ç”¨æˆ·ç®¡ç†</button>
                        <button class="nav-btn" :class="{active: currentView === 'statistics'}" @click="currentView = 'statistics'">ç»Ÿè®¡æŠ¥è¡¨</button>
                    </div>
                    <div v-if="!isLoggedIn" style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" @click="showUserLoginModal = true">ç”¨æˆ·ç™»å½•</button>
                        <button class="btn btn-secondary" @click="showLoginModal = true">ç®¡ç†å‘˜ç™»å½•</button>
                    </div>
                    <div v-else style="display: flex; gap: 10px; align-items: center;">
                        <button v-if="!currentUser.is_admin" class="btn btn-secondary" @click="showChangePasswordModal = true" style="font-size: 14px; padding: 8px 16px;">ä¿®æ”¹å¯†ç </button>
                        <button class="logout-btn" @click="logout">é€€å‡ºç™»å½•</button>
                    </div>
                </div>
            </div>

            <!-- è®¾å¤‡åˆ—è¡¨è§†å›¾ -->
            <template v-if="currentView === 'devices'">
                <div class="content">
                    <!-- æ•´åˆçš„æ ‡é¢˜å’Œç»Ÿè®¡å¡ç‰‡ -->
                    <div class="list-header-section">
                        <!-- ç¬¬ä¸€è¡Œï¼šæ ‡é¢˜ + ç»Ÿè®¡å¡ç‰‡ + æŒ‰é’® -->
                        <div class="title-stats-row" v-if="statistics">
                            <h2>è®¾å¤‡åˆ—è¡¨ <span class="count-badge">{{ filteredDevices.length }}</span></h2>
                            
                            <div class="stats-inline-group">
                                <div class="inline-stat-card">
                                    <span class="stat-label">æ€»è®¾å¤‡</span>
                                    <span class="stat-value">{{ statistics.total_devices }}</span>
                                </div>
                                <div class="inline-stat-card success">
                                    <span class="stat-label">ç©ºé—²</span>
                                    <span class="stat-value">{{ statistics.available_devices }}</span>
                                </div>
                                <div class="inline-stat-card danger">
                                    <span class="stat-label">å ç”¨</span>
                                    <span class="stat-value">{{ statistics.occupied_devices }}</span>
                                </div>
                                <div class="inline-stat-card warning">
                                    <span class="stat-label">è®°å½•</span>
                                    <span class="stat-value">{{ statistics.total_records }}</span>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn btn-primary" @click="showAddDeviceModal">â• æ·»åŠ è®¾å¤‡</button>
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn btn-secondary" @click="exportDevicesToExcel">ğŸ“¥ å¯¼å‡ºExcel</button>
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn btn-secondary" @click="triggerDeviceExcelUpload">ğŸ“¤ å¯¼å…¥Excel</button>
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn" style="background: #48bb78; color: white;" @click="downloadDeviceExcelTemplate">ğŸ“„ ä¸‹è½½æ¨¡æ¿</button>
                                <input type="file" ref="deviceExcelInput" @change="handleDeviceExcelUpload" accept=".xlsx,.xls" style="display: none;">
                                
                                <!-- æ‰¹é‡åˆ é™¤æŒ‰é’® -->
                                <div v-if="isLoggedIn && currentUser.is_admin" style="display: flex; gap: 10px; margin-left: auto;">
                                    <button v-if="!bulkDeleteMode" class="btn" style="background: #f56565; color: white;" @click="toggleBulkDeleteMode">
                                        ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤
                                    </button>
                                    <template v-else>
                                        <button class="btn" style="background: #667eea; color: white;" @click="selectAllDevices">
                                            {{ selectedDeviceIds.length === filteredDevices.length ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰' }}
                                        </button>
                                        <button class="btn" style="background: #f56565; color: white;" @click="batchDeleteDevices" :disabled="selectedDeviceIds.length === 0">
                                            ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­ ({{ selectedDeviceIds.length }})
                                        </button>
                                        <button class="btn btn-secondary" @click="toggleBulkDeleteMode">
                                            å–æ¶ˆ
                                        </button>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ç¬¬äºŒè¡Œï¼šçŠ¶æ€è¿‡æ»¤ + æœ¬äººå ç”¨ç­›é€‰ + æ ‡ç­¾ç­›é€‰ -->
                        <div class="filter-tags-row">
                            <div class="filter-group">
                                <label style="font-size: 13px; color: #666; margin-right: 10px; line-height: 1.5;">çŠ¶æ€ç­›é€‰ï¼š</label>
                                <select v-model="statusFilter" class="filter-select">
                                    <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                    <option value="available">ç©ºé—²</option>
                                    <option value="occupied">å ç”¨</option>
                                </select>
                            </div>
                            
                            <div v-if="isLoggedIn" class="filter-group">
                                <label style="font-size: 13px; color: #666; margin-right: 10px; line-height: 1.5;">å ç”¨ç­›é€‰ï¼š</label>
                                <select v-model="occupiedByMeFilter" class="filter-select">
                                    <option value="">å…¨éƒ¨è®¾å¤‡</option>
                                    <option value="yes">æœ¬äººå ç”¨</option>
                                    <option value="no">éæœ¬äººå ç”¨</option>
                                </select>
                            </div>
                            
                            <div v-if="allTags.length > 0" class="tag-filter">
                                <span class="tag-filter-label">æ ‡ç­¾ç­›é€‰ï¼š</span>
                                <div class="tag-chip" 
                                     v-for="tag in allTags" 
                                     :key="tag"
                                     :class="{active: selectedTags.includes(tag)}"
                                     @click="toggleTagFilter(tag)">
                                    {{ tag }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div v-if="filteredDevices.length === 0" class="empty-state">
                        <div class="empty-state-icon">{{ connectionStatus === 'offline' ? 'âš ï¸' : 'ğŸ“¦' }}</div>
                        <p v-if="connectionStatus === 'offline'">
                            æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨<br>
                            <small style="color: #999;">è¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆç«¯å£5001ï¼‰</small>
                        </p>
                        <p v-else>{{ searchQuery || statusFilter || selectedTags.length ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®¾å¤‡' : 'è¿˜æ²¡æœ‰è®¾å¤‡ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ ç¬¬ä¸€å°è®¾å¤‡å§ï¼' }}</p>
                        <button v-if="connectionStatus === 'offline'" class="btn btn-primary" @click="retryConnection" style="margin-top: 15px;">ğŸ”„ é‡è¯•è¿æ¥</button>
                    </div>

                    <div v-else class="devices-grid">
                        <div v-for="device in filteredDevices" :key="device.id" 
                             class="device-card" 
                             :class="[device.status, { 'selected': bulkDeleteMode && selectedDeviceIds.includes(device.id) }]">
                            <!-- æ‰¹é‡åˆ é™¤æ¨¡å¼ä¸‹çš„å¤é€‰æ¡† -->
                            <div v-if="isLoggedIn && currentUser.is_admin && bulkDeleteMode" class="device-checkbox" @click.stop="toggleDeviceSelection(device.id)">
                                <input type="checkbox" :checked="selectedDeviceIds.includes(device.id)" @click.stop>
                            </div>
                            
                            <div class="device-header">
                                <div class="device-name">{{ device.name }}</div>
                                <span class="status-badge" :class="device.status">
                                    {{ device.status === 'available' ? 'ç©ºé—²' : 'å ç”¨' }}
                                </span>
                            </div>
                            
                            <div class="device-tags" v-if="device.tags && device.tags.length > 0">
                                <span class="device-tag" v-for="tag in device.tags" :key="tag">{{ tag }}</span>
                            </div>

                            <div class="device-content-scroll">
                                <div class="device-info">
                                    <p v-if="device.status === 'occupied'">
                                        <strong>ä½¿ç”¨è€…ï¼š</strong>
                                        <span>{{ device.current_user || 'æœªçŸ¥' }}</span>
                                        <span v-if="device.current_user_account" style="color: #667eea; font-weight: 600; margin-left: 8px;">
                                            ({{ device.current_user_account }})
                                        </span>
                                    </p>
                                    <p v-if="device.status === 'occupied' && device.remaining_minutes > 0">
                                        <strong>å‰©ä½™æ—¶é—´ï¼š</strong>
                                        <span style="color: #f56565; font-weight: bold;">
                                            {{ Math.floor(device.remaining_minutes / 60) }}å°æ—¶{{ device.remaining_minutes % 60 }}åˆ†é’Ÿ
                                        </span>
                                    </p>
                                    <p><strong>è´¦å·ï¼š</strong>{{ device.username || 'æœªè®¾ç½®' }}</p>
                                    <p class="password-row">
                                        <strong>å¯†ç ï¼š</strong>
                                        <span>{{ passwordVisible[device.id] ? (device.password || 'æœªè®¾ç½®') : 'â€¢â€¢â€¢â€¢â€¢â€¢' }}</span>
                                        <button @click="device.status === 'occupied' && device.current_user_account === currentUser.username ? togglePasswordVisibility(device.id) : null" 
                                                class="icon-btn icon-btn-inline" 
                                                :style="device.status === 'occupied' && device.current_user_account === currentUser.username ? '' : 'opacity: 0.5; cursor: not-allowed; pointer-events: auto;'"
                                                :title="device.status === 'occupied' && device.current_user_account === currentUser.username ? (passwordVisible[device.id] ? 'éšè—å¯†ç ' : 'æ˜¾ç¤ºå¯†ç ') : 'å ç”¨åå¯è§'">
                                            {{ passwordVisible[device.id] ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
                                        </button>
                                        <button @click="device.status === 'occupied' && device.current_user_account === currentUser.username ? copyPassword(device.password) : null" 
                                                class="icon-btn icon-btn-inline" 
                                                :style="device.status === 'occupied' && device.current_user_account === currentUser.username ? '' : 'opacity: 0.5; cursor: not-allowed; pointer-events: auto;'"
                                                :title="device.status === 'occupied' && device.current_user_account === currentUser.username ? 'å¤åˆ¶å¯†ç ' : 'å ç”¨åå¯è§'">
                                            ğŸ“‹
                                        </button>
                                    </p>
                                </div>

                                <!-- SSHå’Œä¸²å£è¿æ¥ -->
                                <div class="device-connections" v-if="device.ssh_connections && device.ssh_connections.length > 0">
                                    <p style="font-weight: bold; margin-bottom: 8px; font-size: 13px;">è¿æ¥æ–¹å¼ï¼š</p>
                                    <div class="connection-item" v-for="(conn, idx) in device.ssh_connections" :key="'conn-'+idx">
                                        <span v-if="conn.type === 'SSH'">ğŸ–¥ï¸ SSH: {{ conn.ip }}:{{ conn.port }}</span>
                                        <span v-else-if="conn.type === 'Telnet'">ğŸ“Ÿ Telnet: {{ conn.ip }}:{{ conn.port }}</span>
                                        <span v-else>ï¿½ {{ conn.type }}: {{ conn.ip }}:{{ conn.port }}</span>
                                        <button class="connection-btn" 
                                                @click="device.status === 'occupied' && device.current_user_account === currentUser.username ? openConnection(device, conn) : null"
                                                :style="device.status === 'occupied' && device.current_user_account === currentUser.username ? '' : 'opacity: 0.5; cursor: not-allowed; pointer-events: auto;'"
                                                :title="device.status === 'occupied' && device.current_user_account === currentUser.username ? 'ç‚¹å‡»è¿æ¥' : 'å ç”¨åå¯è¿æ¥'">è¿æ¥</button>
                                    </div>
                                </div>
                            </div>

                            <div class="device-actions">
                                <button v-if="device.status === 'available'" 
                                        class="btn btn-success" 
                                        @click="showOccupyModal(device)">
                                    å ç”¨
                                </button>
                                <button v-else-if="isLoggedIn && (currentUser.is_admin || device.current_user_account === currentUser.username)" 
                                        class="btn btn-warning" 
                                        @click="confirmAction('é‡Šæ”¾è®¾å¤‡', 'ç¡®å®šè¦é‡Šæ”¾è¿™å°è®¾å¤‡å—ï¼Ÿ', () => releaseDevice(device.id))">
                                    é‡Šæ”¾
                                </button>
                                <button v-else-if="device.status === 'occupied'"
                                        class="btn btn-warning" 
                                        style="opacity: 0.5; cursor: not-allowed;"
                                        disabled
                                        title="åªæœ‰å ç”¨è€…æœ¬äººæˆ–ç®¡ç†å‘˜æ‰èƒ½é‡Šæ”¾">
                                    é‡Šæ”¾
                                </button>
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn btn-primary" @click="showEditDeviceModal(device)">ç¼–è¾‘</button>
                                <button v-if="isLoggedIn && currentUser.is_admin" class="btn btn-danger" @click="confirmAction('åˆ é™¤è®¾å¤‡', 'ç¡®å®šè¦åˆ é™¤è¿™å°è®¾å¤‡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼', () => deleteDevice(device.id))">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <!-- ä½¿ç”¨è®°å½•è§†å›¾ -->
            <div class="content" v-if="currentView === 'records'">
                <div class="section-header">
                    <h2>ä½¿ç”¨è®°å½•</h2>
                    <span v-if="records.length > 200" style="font-size: 14px; color: #718096; font-weight: normal;">
                        ï¼ˆæ˜¾ç¤ºæœ€è¿‘ 200 æ¡è®°å½•ï¼Œå…± {{ records.length }} æ¡ï¼‰
                    </span>
                </div>
                
                <!-- ç­›é€‰å’Œæœç´¢ -->
                <div class="record-filters" v-if="records.length > 0">
                    <div class="filter-row">
                        <input 
                            v-model="recordSearchQuery" 
                            type="text" 
                            placeholder="ğŸ” æœç´¢è®¾å¤‡ã€ç”¨æˆ·æˆ–ç›®çš„..."
                            class="record-search">
                        
                        <select v-model="recordDeviceFilter" class="filter-select">
                            <option value="">æ‰€æœ‰è®¾å¤‡</option>
                            <option v-for="device in uniqueDeviceNames" :key="device" :value="device">
                                {{ device }}
                            </option>
                        </select>
                        
                        <select v-model="recordUserFilter" class="filter-select">
                            <option value="">æ‰€æœ‰ç”¨æˆ·</option>
                            <option v-for="user in uniqueUserNames" :key="user" :value="user">
                                {{ user }}
                            </option>
                        </select>
                        
                        <button @click="recordSearchQuery = ''; recordDeviceFilter = ''; recordUserFilter = ''" 
                                class="btn btn-secondary"
                                style="padding: 8px 16px; font-size: 13px;">
                            ğŸ”„ æ¸…ç©ºç­›é€‰
                        </button>
                    </div>
                </div>
                
                <div v-if="records.length === 0" class="empty-state">
                    <div class="empty-state-icon">ğŸ“</div>
                    <p>æš‚æ— ä½¿ç”¨è®°å½•</p>
                </div>

                <table v-else-if="filteredRecords.length > 0">
                    <thead>
                        <tr>
                            <th @click="sortRecords('device_name')" class="sortable">
                                è®¾å¤‡åç§°
                                <span class="sort-icon" v-if="recordSortBy === 'device_name'">
                                    {{ recordSortOrder === 'asc' ? 'â†‘' : 'â†“' }}
                                </span>
                            </th>
                            <th @click="sortRecords('user_name')" class="sortable">
                                ä½¿ç”¨äºº
                                <span class="sort-icon" v-if="recordSortBy === 'user_name'">
                                    {{ recordSortOrder === 'asc' ? 'â†‘' : 'â†“' }}
                                </span>
                            </th>
                            <th>ä½¿ç”¨ç›®çš„</th>
                            <th @click="sortRecords('start_time')" class="sortable">
                                å¼€å§‹æ—¶é—´
                                <span class="sort-icon" v-if="recordSortBy === 'start_time'">
                                    {{ recordSortOrder === 'asc' ? 'â†‘' : 'â†“' }}
                                </span>
                            </th>
                            <th @click="sortRecords('end_time')" class="sortable">
                                ç»“æŸæ—¶é—´
                                <span class="sort-icon" v-if="recordSortBy === 'end_time'">
                                    {{ recordSortOrder === 'asc' ? 'â†‘' : 'â†“' }}
                                </span>
                            </th>
                            <th @click="sortRecords('duration')" class="sortable">
                                ä½¿ç”¨æ—¶é•¿(å°æ—¶)
                                <span class="sort-icon" v-if="recordSortBy === 'duration'">
                                    {{ recordSortOrder === 'asc' ? 'â†‘' : 'â†“' }}
                                </span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="record in filteredRecords" :key="record.id">
                            <td>{{ record.device_name }}</td>
                            <td>
                                {{ record.user_name }}
                                <span v-if="record.user_account" style="color: #667eea; font-weight: 600; margin-left: 8px;">
                                    ({{ record.user_account }})
                                </span>
                            </td>
                            <td>{{ record.purpose || '-' }}</td>
                            <td>{{ record.start_time }}</td>
                            <td>{{ record.end_time || 'ä½¿ç”¨ä¸­' }}</td>
                            <td>{{ record.duration }}</td>
                        </tr>
                    </tbody>
                </table>
                
                <div v-else class="empty-state">
                    <div class="empty-state-icon">ğŸ”</div>
                    <p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å½•</p>
                </div>
            </div>

            <!-- ç”¨æˆ·ç®¡ç†è§†å›¾ -->
            <div class="content" v-if="currentView === 'users' && isLoggedIn">
                <div class="section-header">
                    <h2>ç”¨æˆ·ç®¡ç† <span class="count-badge">{{ allowedUsers.length }}</span></h2>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-primary" @click="showAddUserModal = true">â• æ·»åŠ ç”¨æˆ·</button>
                        <button class="btn btn-secondary" @click="exportUsersToExcel">ğŸ“¤ å¯¼å‡ºExcel</button>
                        <button class="btn btn-secondary" @click="triggerExcelUpload">ğŸ“¤ å¯¼å…¥Excel</button>
                        <button class="btn" style="background: #48bb78; color: white;" @click="downloadExcelTemplate">ğŸ“„ ä¸‹è½½æ¨¡æ¿</button>
                        <button class="btn btn-danger" @click="batchDeleteUsers" v-if="selectedUsers.length > 0">
                            ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤ ({{ selectedUsers.length }})
                        </button>
                    </div>
                    <input type="file" ref="excelFileInput" @change="handleExcelUpload" accept=".xlsx,.xls" style="display: none;">
                </div>

                <div v-if="allowedUsers.length === 0" class="empty-state">
                    <div class="empty-state-icon">ğŸ‘¥</div>
                    <p>è¿˜æ²¡æœ‰æˆæƒç”¨æˆ·</p>
                    <small style="color: #999; margin-top: 10px; display: block;">æ·»åŠ ç”¨æˆ·åï¼Œåªæœ‰åœ¨åˆ—è¡¨ä¸­çš„ç”¨æˆ·æ‰èƒ½å ç”¨è®¾å¤‡</small>
                </div>

                <div v-else>
                    <div style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" @change="toggleSelectAll" :checked="isAllSelected">
                            <span>å…¨é€‰</span>
                        </label>
                        <span v-if="selectedUsers.length > 0" style="color: #667eea; font-weight: 600;">
                            å·²é€‰æ‹© {{ selectedUsers.length }} ä¸ªç”¨æˆ·
                        </span>
                    </div>
                    <div class="users-grid">
                    <div v-for="user in allowedUsers" :key="user.id" class="user-card" :class="{'user-card-selected': selectedUsers.includes(user.id)}">
                        <div class="user-card-checkbox">
                            <input type="checkbox" :value="user.id" v-model="selectedUsers">
                        </div>
                        <div class="user-card-header">
                            <div class="user-info">
                                <div class="user-name">{{ user.chinese_name }}</div>
                                <div class="user-account">è´¦å·: {{ user.account }}</div>
                                <div class="user-department-row">éƒ¨é—¨: {{ user.department }}</div>
                                <div class="user-account" style="margin-top: 5px;">
                                    å¯†ç : {{ userPasswordVisible[user.id] ? user.password : 'â€¢â€¢â€¢â€¢â€¢â€¢' }}
                                    <button @click="toggleUserPasswordVisibility(user.id)" 
                                            style="margin-left: 8px; padding: 2px 8px; font-size: 12px; border: none; background: #667eea; color: white; border-radius: 3px; cursor: pointer;">
                                        {{ userPasswordVisible[user.id] ? 'éšè—' : 'æ˜¾ç¤º' }}
                                    </button>
                                </div>
                                <div class="user-date">æ·»åŠ äº: {{ formatDateTime(user.created_at) }}</div>
                            </div>
                        </div>
                        <div class="user-card-actions">
                            <button class="btn btn-danger btn-sm" @click="deleteUser(user.id, user.account)">åˆ é™¤</button>
                        </div>
                    </div>
                </div>
                </div>
            </div>

            <!-- ç»Ÿè®¡æŠ¥è¡¨è§†å›¾ -->
            <div class="content" v-if="currentView === 'statistics'">
                <div class="section-header">
                    <h2>ç»Ÿè®¡æŠ¥è¡¨</h2>
                </div>
                
                <!-- é¥¼å›¾åŒºåŸŸ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <!-- è®¾å¤‡ä½¿ç”¨é¥¼å›¾ -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 15px; color: #333;">ğŸ“Š è®¾å¤‡ä½¿ç”¨å æ¯”</h3>
                        <div v-if="statistics && statistics.device_usage_ranking.length === 0" class="empty-state">
                            <div class="empty-state-icon">ğŸ“Š</div>
                            <p>æš‚æ— ç»Ÿè®¡æ•°æ®</p>
                        </div>
                        <div v-else style="position: relative; height: 300px;">
                            <canvas ref="devicePieChart"></canvas>
                        </div>
                    </div>

                    <!-- ä½¿ç”¨äººæ—¶é•¿é¥¼å›¾ -->
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 15px; color: #333;">â±ï¸ ä½¿ç”¨äººæ—¶é•¿å æ¯”</h3>
                        <div v-if="statistics && statistics.user_duration_ranking.length === 0" class="empty-state">
                            <div class="empty-state-icon">â±ï¸</div>
                            <p>æš‚æ— ç»Ÿè®¡æ•°æ®</p>
                        </div>
                        <div v-else style="position: relative; height: 300px;">
                            <canvas ref="userPieChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <!-- è®¾å¤‡ä½¿ç”¨æ’è¡Œæ¦œ -->
                    <div>
                        <h3 style="margin-bottom: 15px; color: #333;">ğŸ“Š è®¾å¤‡ä½¿ç”¨æ’è¡Œæ¦œ TOP 10</h3>
                        
                        <div v-if="statistics && statistics.device_usage_ranking.length === 0" class="empty-state">
                            <div class="empty-state-icon">ğŸ“Š</div>
                            <p>æš‚æ— ç»Ÿè®¡æ•°æ®</p>
                        </div>

                        <ul v-else class="ranking-list">
                            <li v-for="(item, index) in statistics.device_usage_ranking" :key="index" class="ranking-item">
                                <span class="ranking-number">{{ index + 1 }}.</span>
                                <div class="ranking-info">
                                    <div><strong>{{ item.device_name }}</strong></div>
                                    <div class="ranking-count">ä½¿ç”¨æ¬¡æ•°ï¼š{{ item.usage_count }} æ¬¡</div>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <!-- ä½¿ç”¨äººæ—¶é•¿æ’è¡Œæ¦œ -->
                    <div>
                        <h3 style="margin-bottom: 15px; color: #333;">â±ï¸ ä½¿ç”¨äººæ—¶é•¿æ’è¡Œæ¦œ TOP 10</h3>
                        
                        <div v-if="statistics && statistics.user_duration_ranking.length === 0" class="empty-state">
                            <div class="empty-state-icon">â±ï¸</div>
                            <p>æš‚æ— ç»Ÿè®¡æ•°æ®</p>
                        </div>

                        <ul v-else class="ranking-list">
                            <li v-for="(item, index) in statistics.user_duration_ranking" :key="index" class="ranking-item">
                                <span class="ranking-number">{{ index + 1 }}.</span>
                                <div class="ranking-info">
                                    <div><strong>{{ item.user_name }}</strong></div>
                                    <div class="ranking-count">ä½¿ç”¨æ—¶é•¿ï¼š{{ item.total_hours }} å°æ—¶ ({{ item.usage_count }} æ¬¡)</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </template>

        <!-- æ·»åŠ /ç¼–è¾‘è®¾å¤‡æ¨¡æ€æ¡† -->
        <div v-if="showDeviceModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>{{ isEditing ? 'ç¼–è¾‘è®¾å¤‡' : 'æ·»åŠ è®¾å¤‡' }}</h3>
                    <button class="close-btn" @click="closeDeviceModal">Ã—</button>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>è®¾å¤‡åç§° *</label>
                        <input v-model="deviceForm.name" placeholder="è¯·è¾“å…¥è®¾å¤‡åç§°">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ç™»å½•è´¦å·</label>
                        <input v-model="deviceForm.username" placeholder="è¯·è¾“å…¥ç™»å½•è´¦å·">
                    </div>
                    <div class="form-group">
                        <label>ç™»å½•å¯†ç </label>
                        <div class="password-input-wrapper">
                            <input v-model="deviceForm.password" :type="showDevicePassword ? 'text' : 'password'" placeholder="è¯·è¾“å…¥ç™»å½•å¯†ç ">
                            <button type="button" class="password-toggle-btn" @click="showDevicePassword = !showDevicePassword" :title="showDevicePassword ? 'éšè—å¯†ç ' : 'æ˜¾ç¤ºå¯†ç '">
                                {{ showDevicePassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
                            </button>
                        </div>
                    </div>
                </div>

                <!-- SSHè¿æ¥é…ç½® -->
                <div class="form-group">
                    <label>SSHè¿æ¥</label>
                    <div class="connection-list">
                        <div class="connection-entry" v-for="(conn, idx) in deviceForm.ssh_connections" :key="'ssh-'+idx">
                            <div class="form-group" style="flex: 2; margin: 0;">
                                <input v-model="conn.ip" placeholder="IPåœ°å€">
                            </div>
                            <div class="form-group" style="flex: 1; margin: 0;">
                                <input v-model="conn.port" type="number" placeholder="ç«¯å£">
                            </div>
                            <button class="btn btn-danger" @click="deviceForm.ssh_connections.splice(idx, 1)">åˆ é™¤</button>
                        </div>
                        <button class="btn btn-primary" style="margin-top: 10px;" @click="deviceForm.ssh_connections.push({ip: '', port: 22})">+ æ·»åŠ SSHè¿æ¥</button>
                    </div>
                </div>

                <!-- Telnetè¿æ¥é…ç½® -->
                <div class="form-group">
                    <label>Telnetè¿æ¥</label>
                    <div class="connection-list">
                        <div class="connection-entry" v-for="(conn, idx) in deviceForm.telnet_connections" :key="'telnet-'+idx">
                            <div class="form-group" style="flex: 2; margin: 0;">
                                <input v-model="conn.ip" placeholder="IPåœ°å€">
                            </div>
                            <div class="form-group" style="flex: 1; margin: 0;">
                                <input v-model="conn.port" type="number" placeholder="ç«¯å£">
                            </div>
                            <button class="btn btn-danger" @click="deviceForm.telnet_connections.splice(idx, 1)">åˆ é™¤</button>
                        </div>
                        <button class="btn btn-primary" style="margin-top: 10px;" @click="deviceForm.telnet_connections.push({type: 'Telnet', ip: '', port: 23})">+ æ·»åŠ Telnetè¿æ¥</button>
                    </div>
                </div>

                <!-- æ ‡ç­¾ -->
                <div class="form-group">
                    <label>è®¾å¤‡æ ‡ç­¾</label>
                    <div class="tags-input" @click="$refs.tagInput && $refs.tagInput.focus()">
                        <span class="tag-item" v-for="tag in deviceForm.tags" :key="tag">
                            {{ tag }}
                            <button @click="removeTag(tag)">Ã—</button>
                        </span>
                        <input ref="tagInput" 
                               class="tag-input-field" 
                               v-model="newTag"
                               @keypress.enter.prevent="addTag"
                               @keypress.comma.prevent="addTag"
                               placeholder="è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦">
                    </div>
                    <small style="color: #999;">æŒ‰å›è½¦æˆ–é€—å·æ·»åŠ æ ‡ç­¾</small>
                </div>

                <div class="form-actions">
                    <button class="btn btn-primary" @click="saveDevice">ä¿å­˜</button>
                    <button class="btn" style="background: #ccc;" @click="closeDeviceModal">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- å ç”¨è®¾å¤‡æ¨¡æ€æ¡† -->
        <div v-if="showOccupyDeviceModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>å ç”¨è®¾å¤‡ï¼š{{ occupyForm.deviceName }}</h3>
                    <button class="close-btn" @click="closeOccupyModal">Ã—</button>
                </div>
                <div class="form-group">
                    <label>è´¦å· *</label>
                    <input v-model="occupyForm.user_account" 
                           placeholder="è¯·è¾“å…¥æ‚¨çš„è´¦å·"
                           :disabled="isLoggedIn && !currentUser.is_admin"
                           :style="(isLoggedIn && !currentUser.is_admin) ? 'background: #f0f0f0; cursor: not-allowed;' : ''">
                    <small style="color: #999; margin-top: 5px; display: block;">
                        {{ (isLoggedIn && !currentUser.is_admin) ? 'å·²è‡ªåŠ¨å¡«å……æ‚¨çš„è´¦å·' : 'è¯·è¾“å…¥å·²æˆæƒçš„è´¦å·' }}
                    </small>
                </div>
                <div class="form-group">
                    <label>å ç”¨æ—¶é•¿ *</label>
                    <select v-model="occupyForm.duration" class="filter-select" style="width: 100%;">
                        <option :value="0.5">0.5å°æ—¶</option>
                        <option :value="1">1å°æ—¶</option>
                        <option :value="2">2å°æ—¶ï¼ˆé»˜è®¤ï¼‰</option>
                        <option :value="4">4å°æ—¶</option>
                        <option :value="8">8å°æ—¶</option>
                        <option :value="12">12å°æ—¶</option>
                        <option :value="24">24å°æ—¶</option>
                        <option :value="48">48å°æ—¶</option>
                    </select>
                    <small style="color: #999;">æœ€é•¿å¯å ç”¨48å°æ—¶</small>
                </div>
                <div class="form-group">
                    <label>ä½¿ç”¨ç›®çš„</label>
                    <textarea v-model="occupyForm.purpose" placeholder="è¯·è¾“å…¥ä½¿ç”¨ç›®çš„ï¼ˆå¯é€‰ï¼‰"></textarea>
                    <div class="purpose-suggestions">
                        <div class="suggestion-chip" 
                             v-for="suggestion in purposeSuggestions" 
                             :key="suggestion"
                             @click="occupyForm.purpose = suggestion">
                            {{ suggestion }}
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-success" @click="confirmOccupy">ç¡®è®¤å ç”¨</button>
                    <button class="btn" style="background: #ccc;" @click="closeOccupyModal">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- Webç»ˆç«¯æ¨¡æ€æ¡† -->
        <div v-if="showTerminalModal" class="modal terminal-modal">
            <div class="modal-content" :class="{ maximized: terminalMaximized }" ref="terminalModalContent">
                <div class="modal-header" @mousedown="startDragTerminal">
                    <h3>
                        <span style="margin-right: 10px;">ğŸ–¥ï¸</span>
                        {{ terminalInfo.title }}
                    </h3>
                    <div class="modal-header-buttons">
                        <button class="maximize-btn" @click="toggleMaximizeTerminal" :title="terminalMaximized ? 'è¿˜åŸ' : 'æœ€å¤§åŒ–'">
                            <span v-if="terminalMaximized">â–£</span>
                            <span v-else>â–¢</span>
                        </button>
                        <button class="close-btn" @click="closeTerminal" title="å…³é—­ç»ˆç«¯">Ã—</button>
                    </div>
                </div>
                <div 
                    ref="terminalContainer"
                    id="xterm-container"
                    class="terminal-container"
                    @drop.prevent="handleTerminalFileDrop"
                    @dragover.prevent="handleTerminalDragOver"
                    @dragleave.prevent="handleTerminalDragLeave"
                >
                </div>
            </div>
        </div>

        </div><!-- ä¸»ç•Œé¢ç»“æŸ -->

        <!-- è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡† -->
        <div v-if="confirmDialog.show" class="confirm-dialog">
            <div class="confirm-box">
                <div class="confirm-icon" :class="confirmDialog.type">
                    {{ confirmDialog.icon }}
                </div>
                <div class="confirm-title">{{ confirmDialog.title }}</div>
                <div class="confirm-message">{{ confirmDialog.message }}</div>
                <div class="confirm-actions">
                    <button class="btn btn-primary" @click="confirmDialog.onConfirm(); confirmDialog.show = false">ç¡®å®š</button>
                    <button class="btn" style="background: #ccc;" @click="confirmDialog.show = false">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- æ¶ˆæ¯æç¤ºå¯¹è¯æ¡† -->
        <div v-if="messageDialog.show" class="confirm-dialog" @click="messageDialog.show = false">
            <div class="confirm-box">
                <div class="confirm-icon" :class="messageDialog.type">
                    {{ messageDialog.icon }}
                </div>
                <div class="confirm-title">{{ messageDialog.title }}</div>
                <div class="confirm-message">{{ messageDialog.message }}</div>
                <div class="confirm-actions">
                    <button class="btn btn-primary" @click="messageDialog.show = false">ç¡®å®š</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    isInitialized: false, // æ˜¯å¦å·²åˆå§‹åŒ–ï¼ˆæ˜¾ç¤ºä¸»ç•Œé¢ï¼‰
                    loginPageMode: 'user', // ç™»å½•é¡µæ¨¡å¼ï¼š'user' æˆ– 'admin'
                    isLoggedIn: false,
                    currentUser: null,
                    showLoginModal: false,
                    showUserLoginModal: false,
                    showChangePasswordModal: false,
                    connectionStatus: 'checking', // online, offline, checking
                    
                    // å¯†ç å¯è§æ€§æ§åˆ¶
                    showUserLoginPassword: false, // ç”¨æˆ·ç™»å½•å¯†ç å¯è§
                    showAdminLoginPassword: false, // ç®¡ç†å‘˜ç™»å½•å¯†ç å¯è§
                    showOldPassword: false, // ä¿®æ”¹å¯†ç -åŸå¯†ç å¯è§
                    showNewPassword: false, // ä¿®æ”¹å¯†ç -æ–°å¯†ç å¯è§
                    showConfirmPassword: false, // ä¿®æ”¹å¯†ç -ç¡®è®¤å¯†ç å¯è§
                    showDevicePassword: false, // è®¾å¤‡å¯†ç å¯è§
                    loginForm: {
                        username: '',
                        password: ''
                    },
                    userLoginForm: {
                        account: '',
                        password: ''
                    },
                    passwordForm: {
                        oldPassword: '',
                        newPassword: '',
                        confirmPassword: ''
                    },
                    currentView: 'devices',
                    devices: [],
                    records: [],
                    statistics: null,
                    
                    // å›¾è¡¨å®ä¾‹
                    deviceChart: null,
                    userChart: null,
                    
                    // æœç´¢å’Œè¿‡æ»¤
                    searchQuery: '',
                    statusFilter: '',
                    occupiedByMeFilter: '', // æœ¬äººå ç”¨ç­›é€‰ï¼š'' å…¨éƒ¨, 'yes' æœ¬äººå ç”¨, 'no' éæœ¬äººå ç”¨
                    selectedTags: [],
                    allTags: [],
                    
                    // å¯†ç æ˜¾ç¤ºçŠ¶æ€
                    passwordVisible: {},
                    userPasswordVisible: {},
                    
                    // ä½¿ç”¨è®°å½•ç­›é€‰å’Œæ’åº
                    recordSearchQuery: '',
                    recordDeviceFilter: '',
                    recordUserFilter: '',
                    recordSortBy: 'start_time',
                    recordSortOrder: 'desc',
                    
                    showDeviceModal: false,
                    showOccupyDeviceModal: false,
                    showTerminalModal: false,
                    terminalMaximized: false,
                    terminalDragging: false,
                    terminalDragStart: { x: 0, y: 0 },
                    terminalPosition: { x: 0, y: 0 },
                    isEditing: false,
                    
                    deviceForm: {
                        id: null,
                        name: '',
                        ip: '',
                        username: '',
                        password: '',
                        ssh_connections: [],
                        telnet_connections: [],
                        tags: []
                    },
                    newTag: '',
                    
                    occupyForm: {
                        deviceId: null,
                        deviceName: '',
                        user_account: '',
                        purpose: '',
                        duration: 2
                    },
                    
                    purposeSuggestions: [
                        'å¼€å‘æµ‹è¯•',
                        'æ€§èƒ½æµ‹è¯•',
                        'åŠŸèƒ½éªŒè¯',
                        'æ¼”ç¤ºå±•ç¤º',
                        'Bugè°ƒè¯•',
                        'å‹åŠ›æµ‹è¯•',
                        'å…¼å®¹æ€§æµ‹è¯•',
                        'å­¦ä¹ ç ”ç©¶'
                    ],
                    
                    // ç”¨æˆ·ç®¡ç†
                    allowedUsers: [],
                    selectedUsers: [],
                    
                    // æ‰¹é‡åˆ é™¤è®¾å¤‡
                    selectedDeviceIds: [],
                    bulkDeleteMode: false,
                    showAddUserModal: false,
                    newUserForm: {
                        account: '',
                        chinese_name: '',
                        department: '',
                        password: ''
                    },
                    
                    terminalInfo: {
                        title: '',
                        content: ''
                    },
                    
                    confirmDialog: {
                        show: false,
                        title: '',
                        message: '',
                        type: 'warning',
                        icon: 'âš ï¸',
                        onConfirm: () => {}
                    },
                    
                    messageDialog: {
                        show: false,
                        title: '',
                        message: '',
                        type: 'success',
                        icon: 'âœ…'
                    },
                    
                    apiBaseUrl: '/api',
                    socket: null,
                    terminalSessionId: null,
                    terminalOutput: '',
                    // Xterm.js å®ä¾‹
                    term: null,
                    fitAddon: null
                };
            },
            computed: {
                filteredDevices() {
                    let filtered = this.devices;
                    
                    // æœç´¢è¿‡æ»¤
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        filtered = filtered.filter(d => 
                            d.name.toLowerCase().includes(query) ||
                            (d.model && d.model.toLowerCase().includes(query)) ||
                            (d.location && d.location.toLowerCase().includes(query))
                        );
                    }
                    
                    // çŠ¶æ€è¿‡æ»¤
                    if (this.statusFilter) {
                        filtered = filtered.filter(d => d.status === this.statusFilter);
                    }
                    
                    // æœ¬äººå ç”¨ç­›é€‰
                    if (this.occupiedByMeFilter && this.isLoggedIn && this.currentUser) {
                        if (this.occupiedByMeFilter === 'yes') {
                            // åªæ˜¾ç¤ºæœ¬äººå ç”¨çš„è®¾å¤‡
                            filtered = filtered.filter(d => 
                                d.status === 'occupied' && d.current_user_account === this.currentUser.username
                            );
                        } else if (this.occupiedByMeFilter === 'no') {
                            // åªæ˜¾ç¤ºéæœ¬äººå ç”¨çš„è®¾å¤‡ï¼ˆç©ºé—²æˆ–å…¶ä»–äººå ç”¨ï¼‰
                            filtered = filtered.filter(d => 
                                d.status === 'available' || d.current_user_account !== this.currentUser.username
                            );
                        }
                    }
                    
                    // æ ‡ç­¾è¿‡æ»¤
                    if (this.selectedTags.length > 0) {
                        filtered = filtered.filter(d => 
                            d.tags && this.selectedTags.every(tag => d.tags.includes(tag))
                        );
                    }
                    
                    return filtered;
                },
                
                filteredRecords() {
                    // åªå–æœ€è¿‘çš„200æ¡è®°å½•
                    let filtered = [...this.records].slice(0, 200);
                    
                    // å…³é”®å­—æœç´¢
                    if (this.recordSearchQuery) {
                        const query = this.recordSearchQuery.toLowerCase();
                        filtered = filtered.filter(r => 
                            (r.device_name && r.device_name.toLowerCase().includes(query)) ||
                            (r.user_name && r.user_name.toLowerCase().includes(query)) ||
                            (r.purpose && r.purpose.toLowerCase().includes(query))
                        );
                    }
                    
                    // è®¾å¤‡è¿‡æ»¤
                    if (this.recordDeviceFilter) {
                        filtered = filtered.filter(r => r.device_name === this.recordDeviceFilter);
                    }
                    
                    // ç”¨æˆ·è¿‡æ»¤
                    if (this.recordUserFilter) {
                        filtered = filtered.filter(r => r.user_name === this.recordUserFilter);
                    }
                    
                    // æ’åº
                    filtered.sort((a, b) => {
                        let aVal = a[this.recordSortBy];
                        let bVal = b[this.recordSortBy];
                        
                        // å¤„ç†æ•°å­—ç±»å‹ï¼ˆå¦‚durationï¼‰
                        if (this.recordSortBy === 'duration') {
                            aVal = parseFloat(aVal) || 0;
                            bVal = parseFloat(bVal) || 0;
                        }
                        
                        // å¤„ç†æ—¥æœŸæ—¶é—´
                        if (this.recordSortBy === 'start_time' || this.recordSortBy === 'end_time') {
                            aVal = new Date(aVal || '9999-12-31').getTime();
                            bVal = new Date(bVal || '9999-12-31').getTime();
                        }
                        
                        if (aVal < bVal) return this.recordSortOrder === 'asc' ? -1 : 1;
                        if (aVal > bVal) return this.recordSortOrder === 'asc' ? 1 : -1;
                        return 0;
                    });
                    
                    return filtered;
                },
                
                uniqueDeviceNames() {
                    return [...new Set(this.records.map(r => r.device_name))].filter(Boolean);
                },
                
                uniqueUserNames() {
                    return [...new Set(this.records.map(r => r.user_name))].filter(Boolean);
                },
                
                isAllSelected() {
                    return this.allowedUsers.length > 0 && this.selectedUsers.length === this.allowedUsers.length;
                }
            },
            mounted() {
                // é…ç½®axiosé”™è¯¯æ‹¦æˆªå™¨
                axios.interceptors.response.use(
                    response => response,
                    error => {
                        // ç»Ÿä¸€å¤„ç†ç½‘ç»œé”™è¯¯
                        if (error.code === 'ERR_NETWORK' || error.message === 'Network Error') {
                            console.error('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œåç«¯æœåŠ¡å¯èƒ½æœªå¯åŠ¨');
                            this.connectionStatus = 'offline';
                        }
                        return Promise.reject(error);
                    }
                );
                
                // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
                const token = localStorage.getItem('token');
                const user = localStorage.getItem('user');
                if (token && user) {
                    this.isLoggedIn = true;
                    this.isInitialized = true; // æ¢å¤ç™»å½•çŠ¶æ€åæ˜¾ç¤ºä¸»ç•Œé¢
                    this.currentUser = JSON.parse(user);
                    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
                    
                    // åŠ è½½æ•°æ®
                    this.loadAllData();
                    this.loadAllowedUsers();
                }
                
                // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡è¿æ¥çŠ¶æ€
                setInterval(() => {
                    if (this.connectionStatus === 'offline') {
                        this.checkConnection();
                    }
                }, 30000);
                
                // åˆå§‹åŒ–Socket.IOè¿æ¥
                this.initSocket();
            },
            watch: {
                currentView(newView) {
                    // åˆ‡æ¢åˆ°ç»Ÿè®¡è§†å›¾æ—¶é‡æ–°æ¸²æŸ“å›¾è¡¨
                    if (newView === 'statistics') {
                        this.$nextTick(() => {
                            this.renderCharts();
                        });
                    }
                }
            },
            methods: {
                switchLoginMode(mode) {
                    this.loginPageMode = mode;
                    // åˆ‡æ¢ç™»å½•æ¨¡å¼æ—¶é‡ç½®å¯†ç å¯è§çŠ¶æ€
                    this.showUserLoginPassword = false;
                    this.showAdminLoginPassword = false;
                },
                
                togglePasswordVisibility(deviceId) {
                    // Vue 3 å“åº”å¼æ›´æ–°
                    this.passwordVisible[deviceId] = !this.passwordVisible[deviceId];
                },
                
                sortRecords(field) {
                    if (this.recordSortBy === field) {
                        // åˆ‡æ¢æ’åºæ–¹å‘
                        this.recordSortOrder = this.recordSortOrder === 'asc' ? 'desc' : 'asc';
                    } else {
                        // æ–°å­—æ®µï¼Œé»˜è®¤é™åº
                        this.recordSortBy = field;
                        this.recordSortOrder = 'desc';
                    }
                },
                
                async copyPassword(password) {
                    if (!password || password === 'æœªè®¾ç½®') {
                        this.showMessage('å¤åˆ¶å¤±è´¥', 'å¯†ç æœªè®¾ç½®', 'error');
                        return;
                    }
                    
                    try {
                        await navigator.clipboard.writeText(password);
                        this.showMessage('å¤åˆ¶æˆåŠŸ', 'å¯†ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                    } catch (error) {
                        // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ textarea
                        const textarea = document.createElement('textarea');
                        textarea.value = password;
                        textarea.style.position = 'fixed';
                        textarea.style.opacity = '0';
                        document.body.appendChild(textarea);
                        textarea.select();
                        try {
                            document.execCommand('copy');
                            this.showMessage('å¤åˆ¶æˆåŠŸ', 'å¯†ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                        } catch (e) {
                            this.showMessage('å¤åˆ¶å¤±è´¥', 'è¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
                        }
                        document.body.removeChild(textarea);
                    }
                },
                
                formatDateTime(dateStr) {
                    if (!dateStr) return '-';
                    const date = new Date(dateStr);
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    const hours = String(date.getHours()).padStart(2, '0');
                    const minutes = String(date.getMinutes()).padStart(2, '0');
                    return `${year}-${month}-${day} ${hours}:${minutes}`;
                },
                
                async login() {
                    try {
                        // ä»åç«¯éªŒè¯ç®¡ç†å‘˜è´¦å·å¯†ç 
                        const configResponse = await axios.get(`${this.apiBaseUrl}/config`);
                        const adminUsername = configResponse.data.admin_username;
                        
                        // éªŒè¯ç®¡ç†å‘˜ç”¨æˆ·åå¯†ç ï¼ˆå¯†ç åœ¨åç«¯éªŒè¯ï¼‰
                        const loginResponse = await axios.post(`${this.apiBaseUrl}/admin/login`, {
                            username: this.loginForm.username,
                            password: this.loginForm.password
                        });
                        
                        if (loginResponse.data.success) {
                            const user = { username: adminUsername, is_admin: true };
                            this.currentUser = user;
                            this.isLoggedIn = true;
                            this.isInitialized = true; // æ˜¾ç¤ºä¸»ç•Œé¢
                            
                            // ä¿å­˜åˆ°localStorage
                            localStorage.setItem('token', 'admin-token');
                            localStorage.setItem('user', JSON.stringify(user));
                            
                            this.showLoginModal = false;
                            this.loginForm.username = '';
                            this.loginForm.password = '';
                            this.showAdminLoginPassword = false; // é‡ç½®å¯†ç å¯è§çŠ¶æ€
                            this.showMessage('ç™»å½•æˆåŠŸ', 'æ¬¢è¿å›æ¥ï¼', 'success');
                            
                            // åŠ è½½æ‰€æœ‰æ•°æ®
                            this.loadAllData();
                        } else {
                            this.showMessage('ç™»å½•å¤±è´¥', loginResponse.data.message || 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯', 'error');
                        }
                    } catch (error) {
                        console.error('ç®¡ç†å‘˜ç™»å½•å¤±è´¥ï¼š', error);
                        const message = error.response?.data?.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ';
                        this.showMessage('ç™»å½•å¤±è´¥', message, 'error');
                    }
                },
                
                logout() {
                    this.confirmAction('é€€å‡ºç™»å½•', 'ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ', () => {
                        this.isLoggedIn = false;
                        this.isInitialized = false; // è¿”å›ç™»å½•é¡µ
                        this.loginPageMode = 'user'; // é‡ç½®ä¸ºç”¨æˆ·ç™»å½•æ¨¡å¼
                        this.currentUser = null;
                        this.loginForm = { username: '', password: '' };
                        this.userLoginForm = { account: '', password: '' };
                        // é‡ç½®æ‰€æœ‰å¯†ç å¯è§çŠ¶æ€
                        this.showUserLoginPassword = false;
                        this.showAdminLoginPassword = false;
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        delete axios.defaults.headers.common['Authorization'];
                    });
                },
                
                async userLogin() {
                    try {
                        const response = await axios.post(`${this.apiBaseUrl}/users/login`, {
                            account: this.userLoginForm.account,
                            password: this.userLoginForm.password
                        });
                        
                        const user = response.data.user;
                        this.currentUser = user;
                        this.isLoggedIn = true;
                        this.isInitialized = true; // æ˜¾ç¤ºä¸»ç•Œé¢
                        
                        // ä¿å­˜åˆ°localStorage
                        localStorage.setItem('token', 'user-token-' + user.username);
                        localStorage.setItem('user', JSON.stringify(user));
                        
                        this.showUserLoginModal = false;
                        this.userLoginForm.account = '';
                        this.userLoginForm.password = '';
                        this.showUserLoginPassword = false; // é‡ç½®å¯†ç å¯è§çŠ¶æ€
                        this.showMessage('ç™»å½•æˆåŠŸ', `æ¬¢è¿å›æ¥ï¼Œ${user.chinese_name}ï¼`, 'success');
                        
                        this.loadAllData();
                    } catch (error) {
                        console.error('ç”¨æˆ·ç™»å½•å¤±è´¥ï¼š', error);
                        const message = error.response?.data?.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å’Œå¯†ç ';
                        this.showMessage('ç™»å½•å¤±è´¥', message, 'error');
                    }
                },
                
                async changePassword() {
                    // éªŒè¯æ–°å¯†ç å’Œç¡®è®¤å¯†ç æ˜¯å¦ä¸€è‡´
                    if (this.passwordForm.newPassword !== this.passwordForm.confirmPassword) {
                        this.showMessage('å¯†ç ä¸ä¸€è‡´', 'ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´ï¼Œè¯·é‡æ–°è¾“å…¥', 'error');
                        return;
                    }
                    
                    // éªŒè¯æ–°å¯†ç é•¿åº¦
                    if (this.passwordForm.newPassword.length < 6) {
                        this.showMessage('å¯†ç å¤ªçŸ­', 'æ–°å¯†ç è‡³å°‘éœ€è¦6ä¸ªå­—ç¬¦', 'error');
                        return;
                    }
                    
                    try {
                        await axios.post(`${this.apiBaseUrl}/users/change-password`, {
                            account: this.currentUser.username,
                            old_password: this.passwordForm.oldPassword,
                            new_password: this.passwordForm.newPassword
                        });
                        
                        this.showMessage('ä¿®æ”¹æˆåŠŸ', 'å¯†ç å·²ä¿®æ”¹ï¼Œè¯·é‡æ–°ç™»å½•', 'success');
                        this.closeChangePasswordModal();
                        
                        // å»¶è¿Ÿ1ç§’åè‡ªåŠ¨é€€å‡ºç™»å½•
                        setTimeout(() => {
                            this.logout();
                        }, 1000);
                    } catch (error) {
                        console.error('ä¿®æ”¹å¯†ç å¤±è´¥ï¼š', error);
                        const message = error.response?.data?.message || 'ä¿®æ”¹å¯†ç å¤±è´¥';
                        this.showMessage('ä¿®æ”¹å¤±è´¥', message, 'error');
                    }
                },
                
                closeChangePasswordModal() {
                    this.showChangePasswordModal = false;
                    this.passwordForm = {
                        oldPassword: '',
                        newPassword: '',
                        confirmPassword: ''
                    };
                    // é‡ç½®å¯†ç å¯è§çŠ¶æ€
                    this.showOldPassword = false;
                    this.showNewPassword = false;
                    this.showConfirmPassword = false;
                },
                
                loadAllData() {
                    this.loadDevices();
                    this.loadRecords();
                    this.loadStatistics();
                    if (this.isLoggedIn) {
                        this.loadAllowedUsers();
                    }
                },
                
                async loadDevices() {
                    try {
                        const response = await axios.get(`${this.apiBaseUrl}/devices`);
                        this.devices = response.data;
                        this.extractAllTags();
                        this.connectionStatus = 'online'; // è¿æ¥æˆåŠŸ
                    } catch (error) {
                        console.error('åŠ è½½è®¾å¤‡åˆ—è¡¨å¤±è´¥ï¼š', error);
                        this.connectionStatus = 'offline'; // è¿æ¥å¤±è´¥
                        let errorMsg = 'åŠ è½½è®¾å¤‡åˆ—è¡¨å¤±è´¥';
                        
                        if (error.code === 'ERR_NETWORK' || error.message === 'Network Error') {
                            errorMsg = 'âš ï¸ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨\n\nè¯·æ£€æŸ¥ï¼š\n\n1. åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼ˆç«¯å£5001ï¼‰\n   è¿è¡Œ: cd backend && python app.py\n\n2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸\n\n3. é˜²ç«å¢™è®¾ç½®æ˜¯å¦é˜»æ­¢è¿æ¥';
                        } else if (error.response) {
                            errorMsg = `æœåŠ¡å™¨é”™è¯¯ (${error.response.status}): ${error.response.data?.message || error.message}`;
                        } else {
                            errorMsg = `åŠ è½½å¤±è´¥: ${error.message}`;
                        }
                        
                        this.showMessage('æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨', errorMsg, 'error');
                        this.devices = []; // æ¸…ç©ºè®¾å¤‡åˆ—è¡¨
                    }
                },
                
                async loadRecords() {
                    try {
                        const response = await axios.get(`${this.apiBaseUrl}/records`);
                        this.records = response.data;
                    } catch (error) {
                        console.error('åŠ è½½ä½¿ç”¨è®°å½•å¤±è´¥ï¼š', error);
                        if (error.code === 'ERR_NETWORK' || error.message === 'Network Error') {
                            this.records = [];
                        }
                    }
                },
                
                async loadStatistics() {
                    try {
                        const response = await axios.get(`${this.apiBaseUrl}/statistics`);
                        this.statistics = response.data;
                        
                        // ç­‰å¾…DOMæ›´æ–°åç»˜åˆ¶å›¾è¡¨
                        this.$nextTick(() => {
                            this.renderCharts();
                        });
                    } catch (error) {
                        console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥ï¼š', error);
                        if (error.code === 'ERR_NETWORK' || error.message === 'Network Error') {
                            this.statistics = {
                                total_devices: 0,
                                available_devices: 0,
                                occupied_devices: 0,
                                total_records: 0
                            };
                        }
                    }
                },
                
                renderCharts() {
                    if (!this.statistics) return;
                    
                    // é”€æ¯ä¹‹å‰çš„å›¾è¡¨å®ä¾‹
                    if (this.deviceChart) {
                        this.deviceChart.destroy();
                    }
                    if (this.userChart) {
                        this.userChart.destroy();
                    }
                    
                    // ç»˜åˆ¶è®¾å¤‡ä½¿ç”¨é¥¼å›¾
                    if (this.$refs.devicePieChart && this.statistics.device_usage_ranking && this.statistics.device_usage_ranking.length > 0) {
                        const ctx = this.$refs.devicePieChart.getContext('2d');
                        const topDevices = this.statistics.device_usage_ranking.slice(0, 10);
                        
                        this.deviceChart = new Chart(ctx, {
                            type: 'pie',
                            data: {
                                labels: topDevices.map(item => item.device_name),
                                datasets: [{
                                    data: topDevices.map(item => item.usage_count),
                                    backgroundColor: [
                                        '#667eea', '#764ba2', '#f093fb', '#4facfe',
                                        '#43e97b', '#fa709a', '#fee140', '#30cfd0',
                                        '#a8edea', '#fed6e3'
                                    ],
                                    borderWidth: 2,
                                    borderColor: '#fff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            boxWidth: 12,
                                            padding: 10,
                                            font: {
                                                size: 11
                                            }
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = ((value / total) * 100).toFixed(1);
                                                return `${label}: ${value}æ¬¡ (${percentage}%)`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                    
                    // ç»˜åˆ¶ä½¿ç”¨äººæ—¶é•¿é¥¼å›¾
                    if (this.$refs.userPieChart && this.statistics.user_duration_ranking && this.statistics.user_duration_ranking.length > 0) {
                        const ctx = this.$refs.userPieChart.getContext('2d');
                        const topUsers = this.statistics.user_duration_ranking.slice(0, 10);
                        
                        this.userChart = new Chart(ctx, {
                            type: 'pie',
                            data: {
                                labels: topUsers.map(item => item.user_name),
                                datasets: [{
                                    data: topUsers.map(item => item.total_hours),
                                    backgroundColor: [
                                        '#fa709a', '#fee140', '#30cfd0', '#a8edea',
                                        '#fed6e3', '#667eea', '#764ba2', '#f093fb',
                                        '#4facfe', '#43e97b'
                                    ],
                                    borderWidth: 2,
                                    borderColor: '#fff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            boxWidth: 12,
                                            padding: 10,
                                            font: {
                                                size: 11
                                            }
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = ((value / total) * 100).toFixed(1);
                                                return `${label}: ${value}å°æ—¶ (${percentage}%)`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                },
                
                extractAllTags() {
                    const tagsSet = new Set();
                    this.devices.forEach(device => {
                        if (device.tags && Array.isArray(device.tags)) {
                            device.tags.forEach(tag => tagsSet.add(tag));
                        }
                    });
                    this.allTags = Array.from(tagsSet).sort();
                },
                
                toggleTagFilter(tag) {
                    const index = this.selectedTags.indexOf(tag);
                    if (index > -1) {
                        this.selectedTags.splice(index, 1);
                    } else {
                        this.selectedTags.push(tag);
                    }
                },
                
                showAddDeviceModal() {
                    if (!this.isLoggedIn || !this.currentUser.is_admin) {
                        this.showMessage('æƒé™ä¸è¶³', 'åªæœ‰ç®¡ç†å‘˜æ‰èƒ½æ·»åŠ è®¾å¤‡', 'error');
                        return;
                    }
                    this.isEditing = false;
                    this.deviceForm = {
                        id: null,
                        name: '',
                        ip: '',
                        username: '',
                        password: '',
                        ssh_connections: [],
                        telnet_connections: [],
                        tags: []
                    };
                    this.showDeviceModal = true;
                },
                
                showEditDeviceModal(device) {
                    if (!this.isLoggedIn || !this.currentUser.is_admin) {
                        this.showMessage('æƒé™ä¸è¶³', 'åªæœ‰ç®¡ç†å‘˜æ‰èƒ½ç¼–è¾‘è®¾å¤‡', 'error');
                        return;
                    }
                    this.isEditing = true;
                    // åˆ†ç¦»SSHå’ŒTelnetè¿æ¥
                    const ssh_conns = [];
                    const telnet_conns = [];
                    if (device.ssh_connections && Array.isArray(device.ssh_connections)) {
                        device.ssh_connections.forEach(conn => {
                            if (conn.type === 'Telnet') {
                                telnet_conns.push(JSON.parse(JSON.stringify(conn)));
                            } else {
                                ssh_conns.push(JSON.parse(JSON.stringify(conn)));
                            }
                        });
                    }
                    
                    this.deviceForm = {
                        id: device.id,
                        name: device.name,
                        ip: device.ip || '',
                        username: device.username || '',
                        password: device.password || '',
                        ssh_connections: ssh_conns,
                        telnet_connections: telnet_conns,
                        tags: device.tags ? JSON.parse(JSON.stringify(device.tags)) : []
                    };
                    this.showDeviceModal = true;
                },
                
                closeDeviceModal() {
                    this.showDeviceModal = false;
                    this.newTag = '';
                    this.showDevicePassword = false; // é‡ç½®è®¾å¤‡å¯†ç å¯è§çŠ¶æ€
                },
                
                addTag() {
                    const tag = this.newTag.trim();
                    if (tag && !this.deviceForm.tags.includes(tag)) {
                        this.deviceForm.tags.push(tag);
                    }
                    this.newTag = '';
                },
                
                removeTag(tag) {
                    const index = this.deviceForm.tags.indexOf(tag);
                    if (index > -1) {
                        this.deviceForm.tags.splice(index, 1);
                    }
                },
                
                async saveDevice() {
                    if (!this.deviceForm.name) {
                        this.showMessage('éªŒè¯å¤±è´¥', 'è¯·è¾“å…¥è®¾å¤‡åç§°', 'error');
                        return;
                    }

                    try {
                        // åˆå¹¶SSHå’ŒTelnetè¿æ¥
                        const allConnections = [];
                        
                        // æ·»åŠ SSHè¿æ¥
                        this.deviceForm.ssh_connections.filter(c => c.ip).forEach(conn => {
                            allConnections.push({
                                type: conn.type || 'SSH',
                                ip: conn.ip,
                                port: conn.port
                            });
                        });
                        
                        // æ·»åŠ Telnetè¿æ¥
                        this.deviceForm.telnet_connections.filter(c => c.ip).forEach(conn => {
                            allConnections.push({
                                type: 'Telnet',
                                ip: conn.ip,
                                port: conn.port
                            });
                        });
                        
                        const data = {
                            name: this.deviceForm.name,
                            ip: this.deviceForm.ip,
                            username: this.deviceForm.username,
                            password: this.deviceForm.password,
                            ssh_connections: allConnections,
                            serial_connections: [],  // ä¸å†ä½¿ç”¨serial_connections
                            tags: this.deviceForm.tags
                        };

                        if (this.isEditing) {
                            await axios.put(`${this.apiBaseUrl}/devices/${this.deviceForm.id}`, data);
                            this.showMessage('æ›´æ–°æˆåŠŸ', 'è®¾å¤‡ä¿¡æ¯å·²æ›´æ–°', 'success');
                        } else {
                            await axios.post(`${this.apiBaseUrl}/devices`, data);
                            this.showMessage('æ·»åŠ æˆåŠŸ', 'è®¾å¤‡å·²æˆåŠŸæ·»åŠ ', 'success');
                        }
                        
                        this.closeDeviceModal();
                        this.loadAllData();
                    } catch (error) {
                        this.showMessage('æ“ä½œå¤±è´¥', error.message, 'error');
                    }
                },
                
                async deleteDevice(deviceId) {
                    try {
                        await axios.delete(`${this.apiBaseUrl}/devices/${deviceId}`);
                        this.showMessage('åˆ é™¤æˆåŠŸ', 'è®¾å¤‡å·²åˆ é™¤', 'success');
                        this.loadAllData();
                    } catch (error) {
                        this.showMessage('åˆ é™¤å¤±è´¥', error.message, 'error');
                    }
                },
                
                // æ‰¹é‡åˆ é™¤ç›¸å…³æ–¹æ³•
                toggleBulkDeleteMode() {
                    this.bulkDeleteMode = !this.bulkDeleteMode;
                    if (!this.bulkDeleteMode) {
                        this.selectedDeviceIds = [];
                    }
                },
                
                toggleDeviceSelection(deviceId) {
                    const index = this.selectedDeviceIds.indexOf(deviceId);
                    if (index > -1) {
                        this.selectedDeviceIds.splice(index, 1);
                    } else {
                        this.selectedDeviceIds.push(deviceId);
                    }
                },
                
                selectAllDevices() {
                    if (this.selectedDeviceIds.length === this.filteredDevices.length) {
                        this.selectedDeviceIds = [];
                    } else {
                        this.selectedDeviceIds = this.filteredDevices.map(d => d.id);
                    }
                },
                
                async batchDeleteDevices() {
                    if (this.selectedDeviceIds.length === 0) {
                        this.showMessage('æç¤º', 'è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è®¾å¤‡', 'warning');
                        return;
                    }
                    
                    this.confirmAction(
                        'æ‰¹é‡åˆ é™¤è®¾å¤‡',
                        `ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${this.selectedDeviceIds.length} å°è®¾å¤‡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`,
                        async () => {
                            try {
                                const response = await axios.post(`${this.apiBaseUrl}/devices/batch-delete`, {
                                    device_ids: this.selectedDeviceIds
                                });
                                this.showMessage('åˆ é™¤æˆåŠŸ', response.data.message, 'success');
                                this.selectedDeviceIds = [];
                                this.bulkDeleteMode = false;
                                this.loadAllData();
                            } catch (error) {
                                this.showMessage('åˆ é™¤å¤±è´¥', error.response?.data?.message || error.message, 'error');
                            }
                        }
                    );
                },
                
                showOccupyModal(device) {
                    // å¦‚æœæ˜¯æ™®é€šç”¨æˆ·ç™»å½•,è‡ªåŠ¨å¡«å……è´¦å·
                    const userAccount = (this.isLoggedIn && !this.currentUser.is_admin) 
                        ? this.currentUser.username 
                        : '';
                    
                    this.occupyForm = {
                        deviceId: device.id,
                        deviceName: device.name,
                        user_account: userAccount,
                        purpose: '',
                        duration: 2
                    };
                    this.showOccupyDeviceModal = true;
                },
                
                closeOccupyModal() {
                    this.showOccupyDeviceModal = false;
                },
                
                // ç”¨æˆ·ç®¡ç†æ–¹æ³•
                async loadAllowedUsers() {
                    try {
                        const response = await axios.get(`${this.apiBaseUrl}/users`);
                        this.allowedUsers = response.data;
                    } catch (error) {
                        console.error('åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥ï¼š', error);
                    }
                },
                
                closeAddUserModal() {
                    this.showAddUserModal = false;
                    this.newUserForm = {
                        account: '',
                        chinese_name: '',
                        department: '',
                        password: ''
                    };
                },
                
                async addUser() {
                    if (!this.newUserForm.account.trim()) {
                        this.showMessage('éªŒè¯å¤±è´¥', 'è¯·è¾“å…¥è´¦å·', 'error');
                        return;
                    }
                    if (!this.newUserForm.chinese_name.trim()) {
                        this.showMessage('éªŒè¯å¤±è´¥', 'è¯·è¾“å…¥ä¸­æ–‡å', 'error');
                        return;
                    }
                    
                    try {
                        const password = this.newUserForm.password.trim() || '123456';
                        
                        await axios.post(`${this.apiBaseUrl}/users`, {
                            account: this.newUserForm.account.trim(),
                            chinese_name: this.newUserForm.chinese_name.trim(),
                            department: this.newUserForm.department.trim() || 'æœªå¡«å†™',
                            password: password
                        });
                        this.showMessage('æ·»åŠ æˆåŠŸ', `ç”¨æˆ· "${this.newUserForm.chinese_name}" (${this.newUserForm.account}) å·²æ·»åŠ ï¼Œåˆå§‹å¯†ç ï¼š${password}`, 'success');
                        this.closeAddUserModal();
                        this.loadAllowedUsers();
                    } catch (error) {
                        this.showMessage('æ·»åŠ å¤±è´¥', error.response?.data?.message || error.message, 'error');
                    }
                },
                
                async deleteUser(userId, userAccount) {
                    if (!confirm(`ç¡®å®šè¦åˆ é™¤è´¦å· "${userAccount}" å—ï¼Ÿåˆ é™¤åè¯¥è´¦å·å°†æ— æ³•å ç”¨è®¾å¤‡ã€‚`)) {
                        return;
                    }
                    
                    try {
                        await axios.delete(`${this.apiBaseUrl}/users/${userId}`);
                        this.showMessage('åˆ é™¤æˆåŠŸ', `è´¦å· "${userAccount}" å·²åˆ é™¤`, 'success');
                        this.loadAllowedUsers();
                    } catch (error) {
                        this.showMessage('åˆ é™¤å¤±è´¥', error.response?.data?.message || error.message, 'error');
                    }
                },
                
                toggleSelectAll(event) {
                    if (event.target.checked) {
                        this.selectedUsers = this.allowedUsers.map(u => u.id);
                    } else {
                        this.selectedUsers = [];
                    }
                },
                
                async batchDeleteUsers() {
                    if (this.selectedUsers.length === 0) {
                        this.showMessage('æç¤º', 'è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„ç”¨æˆ·', 'error');
                        return;
                    }
                    
                    if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${this.selectedUsers.length} ä¸ªç”¨æˆ·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                        return;
                    }
                    
                    try {
                        // æ‰¹é‡åˆ é™¤
                        await axios.post(`${this.apiBaseUrl}/users/batch-delete`, {
                            user_ids: this.selectedUsers
                        });
                        
                        this.showMessage('åˆ é™¤æˆåŠŸ', `å·²åˆ é™¤ ${this.selectedUsers.length} ä¸ªç”¨æˆ·`, 'success');
                        this.selectedUsers = [];
                        this.loadAllowedUsers();
                    } catch (error) {
                        this.showMessage('åˆ é™¤å¤±è´¥', error.response?.data?.message || error.message, 'error');
                    }
                },
                
                toggleUserPasswordVisibility(userId) {
                    // Vue 3 å“åº”å¼æ›´æ–°
                    this.userPasswordVisible[userId] = !this.userPasswordVisible[userId];
                },
                
                exportUsersToExcel() {
                    if (!this.allowedUsers || this.allowedUsers.length === 0) {
                        this.showMessage('å¯¼å‡ºå¤±è´¥', 'æ²¡æœ‰ç”¨æˆ·æ•°æ®å¯å¯¼å‡º', 'warning');
                        return;
                    }
                    
                    // å‡†å¤‡å¯¼å‡ºæ•°æ®
                    const exportData = this.allowedUsers.map(user => {
                        return {
                            'è´¦å·': user.account,
                            'ä¸­æ–‡å': user.chinese_name,
                            'éƒ¨é—¨': user.department || 'æœªå¡«å†™',
                            'å¯†ç ': user.password || '123456',
                            'åˆ›å»ºæ—¶é—´': this.formatDateTime(user.created_at)
                        };
                    });
                    
                    // åˆ›å»ºå·¥ä½œè¡¨
                    const ws = XLSX.utils.json_to_sheet(exportData);
                    
                    // è®¾ç½®åˆ—å®½
                    ws['!cols'] = [
                        { wch: 15 },  // è´¦å·
                        { wch: 15 },  // ä¸­æ–‡å
                        { wch: 15 },  // éƒ¨é—¨
                        { wch: 15 },  // å¯†ç 
                        { wch: 20 }   // åˆ›å»ºæ—¶é—´
                    ];
                    
                    // åˆ›å»ºè¯´æ˜å·¥ä½œè¡¨
                    const instructions = [
                        { 'å­—æ®µå': 'è´¦å·', 'è¯´æ˜': 'ç”¨æˆ·ç™»å½•è´¦å·ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆå¿…å¡«ï¼‰', 'ç¤ºä¾‹': 'zhangsan' },
                        { 'å­—æ®µå': 'ä¸­æ–‡å', 'è¯´æ˜': 'ç”¨æˆ·ä¸­æ–‡å§“åï¼ˆå¿…å¡«ï¼‰', 'ç¤ºä¾‹': 'å¼ ä¸‰' },
                        { 'å­—æ®µå': 'éƒ¨é—¨', 'è¯´æ˜': 'ç”¨æˆ·æ‰€å±éƒ¨é—¨ï¼ˆå¯é€‰ï¼‰', 'ç¤ºä¾‹': 'æŠ€æœ¯éƒ¨' },
                        { 'å­—æ®µå': 'å¯†ç ', 'è¯´æ˜': 'ç™»å½•å¯†ç ï¼Œä¸å¡«åˆ™ä½¿ç”¨é»˜è®¤å¯†ç 123456ï¼ˆå¯é€‰ï¼‰', 'ç¤ºä¾‹': '123456' },
                        { 'å­—æ®µå': 'åˆ›å»ºæ—¶é—´', 'è¯´æ˜': 'ç”¨æˆ·åˆ›å»ºæ—¶é—´ï¼ˆå¯¼å‡ºæ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œå¯¼å…¥æ—¶å¿½ç•¥ï¼‰', 'ç¤ºä¾‹': '2024-01-01 12:00' }
                    ];
                    const wsInstructions = XLSX.utils.json_to_sheet(instructions);
                    wsInstructions['!cols'] = [
                        { wch: 15 },  // å­—æ®µå
                        { wch: 45 },  // è¯´æ˜
                        { wch: 25 }   // ç¤ºä¾‹
                    ];
                    
                    // åˆ›å»ºå·¥ä½œç°¿
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'ç”¨æˆ·åˆ—è¡¨');
                    XLSX.utils.book_append_sheet(wb, wsInstructions, 'å­—æ®µè¯´æ˜');
                    
                    // ç”Ÿæˆæ–‡ä»¶åï¼ˆåŒ…å«å¯¼å‡ºæ—¶é—´ï¼‰
                    const now = new Date();
                    const dateStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
                    const filename = `ç”¨æˆ·åˆ—è¡¨_${dateStr}.xlsx`;
                    
                    // ä¸‹è½½æ–‡ä»¶
                    XLSX.writeFile(wb, filename);
                    
                    this.showMessage('å¯¼å‡ºæˆåŠŸ', `å·²å¯¼å‡º ${this.allowedUsers.length} ä¸ªç”¨æˆ·åˆ° ${filename}`, 'success');
                },
                
                triggerExcelUpload() {
                    this.$refs.excelFileInput.click();
                },
                
                async handleExcelUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    try {
                        const reader = new FileReader();
                        reader.onload = async (e) => {
                            try {
                                const data = new Uint8Array(e.target.result);
                                const workbook = XLSX.read(data, { type: 'array' });
                                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                                const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                                
                                if (jsonData.length === 0) {
                                    this.showMessage('å¯¼å…¥å¤±è´¥', 'Excelæ–‡ä»¶ä¸ºç©º', 'error');
                                    return;
                                }
                                
                                // éªŒè¯æ•°æ®æ ¼å¼å¹¶è½¬æ¢
                                const users = [];
                                for (let i = 0; i < jsonData.length; i++) {
                                    const row = jsonData[i];
                                    // æ”¯æŒå¤šç§åˆ—åæ ¼å¼
                                    const account = row['è´¦å·'] || row['account'] || row['Account'];
                                    const chinese_name = row['ä¸­æ–‡å'] || row['å§“å'] || row['chinese_name'] || row['name'];
                                    const department = row['éƒ¨é—¨'] || row['department'] || row['Department'] || 'æœªå¡«å†™';
                                    const password = row['å¯†ç '] || row['password'] || row['Password'] || '123456';
                                    
                                    if (!account || !chinese_name) {
                                        this.showMessage('å¯¼å…¥å¤±è´¥', `ç¬¬ ${i + 2} è¡Œæ•°æ®ä¸å®Œæ•´ï¼ˆç¼ºå°‘è´¦å·æˆ–ä¸­æ–‡åï¼‰`, 'error');
                                        return;
                                    }
                                    
                                    users.push({
                                        account: String(account).trim(),
                                        chinese_name: String(chinese_name).trim(),
                                        department: String(department).trim(),
                                        password: String(password).trim()
                                    });
                                }
                                
                                // æ‰¹é‡å¯¼å…¥
                                const response = await axios.post(`${this.apiBaseUrl}/users/batch-import`, {
                                    users: users
                                });
                                
                                this.showMessage('å¯¼å…¥æˆåŠŸ', 
                                    `æˆåŠŸå¯¼å…¥ ${response.data.success_count} ä¸ªç”¨æˆ·ï¼Œå¤±è´¥ ${response.data.fail_count} ä¸ª`, 
                                    'success'
                                );
                                this.loadAllowedUsers();
                                
                            } catch (error) {
                                this.showMessage('å¯¼å…¥å¤±è´¥', error.response?.data?.message || error.message, 'error');
                            }
                        };
                        reader.readAsArrayBuffer(file);
                        
                    } catch (error) {
                        this.showMessage('è¯»å–æ–‡ä»¶å¤±è´¥', error.message, 'error');
                    }
                    
                    // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©ï¼Œå…è®¸é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶
                    event.target.value = '';
                },
                
                downloadExcelTemplate() {
                    // åˆ›å»ºç¤ºä¾‹æ•°æ®
                    const template = [
                        { 'è´¦å·': 'zhangsan', 'ä¸­æ–‡å': 'å¼ ä¸‰', 'éƒ¨é—¨': 'æŠ€æœ¯éƒ¨', 'å¯†ç ': '123456' },
                        { 'è´¦å·': 'lisi', 'ä¸­æ–‡å': 'æå››', 'éƒ¨é—¨': 'äº§å“éƒ¨', 'å¯†ç ': '123456' },
                        { 'è´¦å·': 'wangwu', 'ä¸­æ–‡å': 'ç‹äº”', 'éƒ¨é—¨': 'æµ‹è¯•éƒ¨', 'å¯†ç ': '123456' }
                    ];
                    
                    // åˆ›å»ºè¯´æ˜å·¥ä½œè¡¨
                    const instructions = [
                        { 'å­—æ®µå': 'è´¦å·', 'è¯´æ˜': 'ç”¨æˆ·ç™»å½•è´¦å·ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆå¿…å¡«ï¼‰', 'ç¤ºä¾‹': 'zhangsan' },
                        { 'å­—æ®µå': 'ä¸­æ–‡å', 'è¯´æ˜': 'ç”¨æˆ·ä¸­æ–‡å§“åï¼ˆå¿…å¡«ï¼‰', 'ç¤ºä¾‹': 'å¼ ä¸‰' },
                        { 'å­—æ®µå': 'éƒ¨é—¨', 'è¯´æ˜': 'ç”¨æˆ·æ‰€å±éƒ¨é—¨ï¼ˆå¯é€‰ï¼‰', 'ç¤ºä¾‹': 'æŠ€æœ¯éƒ¨' },
                        { 'å­—æ®µå': 'å¯†ç ', 'è¯´æ˜': 'ç™»å½•å¯†ç ï¼Œä¸å¡«åˆ™ä½¿ç”¨é»˜è®¤å¯†ç 123456ï¼ˆå¯é€‰ï¼‰', 'ç¤ºä¾‹': '123456' }
                    ];
                    
                    // åˆ›å»ºå·¥ä½œè¡¨
                    const ws = XLSX.utils.json_to_sheet(template);
                    const wsInstructions = XLSX.utils.json_to_sheet(instructions);
                    
                    // è®¾ç½®åˆ—å®½
                    ws['!cols'] = [
                        { wch: 15 },  // è´¦å·åˆ—å®½
                        { wch: 15 },  // ä¸­æ–‡ååˆ—å®½
                        { wch: 15 },  // éƒ¨é—¨åˆ—å®½
                        { wch: 15 }   // å¯†ç åˆ—å®½
                    ];
                    
                    wsInstructions['!cols'] = [
                        { wch: 15 },  // å­—æ®µå
                        { wch: 40 },  // è¯´æ˜
                        { wch: 20 }   // ç¤ºä¾‹
                    ];
                    
                    // åˆ›å»ºå·¥ä½œç°¿
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'ç”¨æˆ·åˆ—è¡¨');
                    XLSX.utils.book_append_sheet(wb, wsInstructions, 'å­—æ®µè¯´æ˜');
                    
                    // ä¸‹è½½æ–‡ä»¶
                    XLSX.writeFile(wb, 'ç”¨æˆ·å¯¼å…¥æ¨¡æ¿.xlsx');
                    
                    this.showMessage('ä¸‹è½½æˆåŠŸ', 'æ¨¡æ¿æ–‡ä»¶å·²ä¸‹è½½ï¼Œè¯·æŒ‰ç…§æ ¼å¼å¡«å†™åå¯¼å…¥', 'success');
                },
                
                // è®¾å¤‡Excelå¯¼å‡º
                exportDevicesToExcel() {
                    if (!this.devices || this.devices.length === 0) {
                        this.showMessage('å¯¼å‡ºå¤±è´¥', 'æ²¡æœ‰è®¾å¤‡æ•°æ®å¯å¯¼å‡º', 'warning');
                        return;
                    }
                    
                    // å‡†å¤‡å¯¼å‡ºæ•°æ®
                    const exportData = this.devices.map(device => {
                        // åˆå¹¶æ‰€æœ‰è¿æ¥ä¿¡æ¯
                        const allConnections = [];
                        
                        // æ‰€æœ‰è¿æ¥éƒ½åœ¨ssh_connectionsä¸­
                        if (device.ssh_connections && Array.isArray(device.ssh_connections) && device.ssh_connections.length > 0) {
                            device.ssh_connections.forEach(conn => {
                                allConnections.push(`${conn.type || 'SSH'}:${conn.ip}:${conn.port}`);
                            });
                        }
                        
                        const connectionStr = allConnections.join('; ');
                        const tagsStr = (device.tags || []).join(', ');
                        
                        return {
                            'è®¾å¤‡åç§°': device.name,
                            'çŠ¶æ€': device.status === 'available' ? 'ç©ºé—²' : 'å ç”¨',
                            'ä½¿ç”¨è€…': device.current_user || '',
                            'ä½¿ç”¨è€…è´¦å·': device.current_user_account || '',
                            'ç”¨æˆ·å': device.username || '',
                            'å¯†ç ': device.password || '',
                            'è¿æ¥ä¿¡æ¯': connectionStr,
                            'æ ‡ç­¾': tagsStr
                        };
                    });
                    
                    // åˆ›å»ºå·¥ä½œè¡¨
                    const ws = XLSX.utils.json_to_sheet(exportData);
                    
                    // è®¾ç½®åˆ—å®½
                    ws['!cols'] = [
                        { wch: 20 },  // è®¾å¤‡åç§°
                        { wch: 10 },  // çŠ¶æ€
                        { wch: 15 },  // ä½¿ç”¨è€…
                        { wch: 15 },  // ä½¿ç”¨è€…è´¦å·
                        { wch: 15 },  // ç”¨æˆ·å
                        { wch: 15 },  // å¯†ç 
                        { wch: 40 },  // è¿æ¥ä¿¡æ¯
                        { wch: 20 }   // æ ‡ç­¾
                    ];
                    
                    // åˆ›å»ºè¯´æ˜å·¥ä½œè¡¨
                    const instructions = [
                        { 'å­—æ®µå': 'è®¾å¤‡åç§°', 'è¯´æ˜': 'è®¾å¤‡çš„å”¯ä¸€åç§°ï¼ˆå¿…å¡«ï¼‰', 'ç¤ºä¾‹': 'iPhone 13 Pro' },
                        { 'å­—æ®µå': 'çŠ¶æ€', 'è¯´æ˜': 'è®¾å¤‡çŠ¶æ€ï¼ˆå¯¼å‡ºæ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œå¯¼å…¥æ—¶å¿½ç•¥ï¼‰', 'ç¤ºä¾‹': 'ç©ºé—² æˆ– å ç”¨' },
                        { 'å­—æ®µå': 'ä½¿ç”¨è€…', 'è¯´æ˜': 'å½“å‰ä½¿ç”¨è€…ä¸­æ–‡åï¼ˆå¯¼å‡ºæ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œå¯¼å…¥æ—¶å¿½ç•¥ï¼‰', 'ç¤ºä¾‹': 'å¼ ä¸‰' },
                        { 'å­—æ®µå': 'ä½¿ç”¨è€…è´¦å·', 'è¯´æ˜': 'å½“å‰ä½¿ç”¨è€…è´¦å·ï¼ˆå¯¼å‡ºæ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œå¯¼å…¥æ—¶å¿½ç•¥ï¼‰', 'ç¤ºä¾‹': 'zhangsan' },
                        { 'å­—æ®µå': 'ç”¨æˆ·å', 'è¯´æ˜': 'è®¾å¤‡ç™»å½•ç”¨æˆ·åï¼ˆå¯é€‰ï¼‰', 'ç¤ºä¾‹': 'root' },
                        { 'å­—æ®µå': 'å¯†ç ', 'è¯´æ˜': 'è®¾å¤‡ç™»å½•å¯†ç ï¼ˆå¯é€‰ï¼‰', 'ç¤ºä¾‹': '123456' },
                        { 'å­—æ®µå': 'è¿æ¥ä¿¡æ¯', 'è¯´æ˜': 'æ ¼å¼: ç±»å‹:IP:ç«¯å£\nå¤šä¸ªè¿æ¥ç”¨åˆ†å·åˆ†éš”\næ”¯æŒç±»å‹: SSHã€Telnet', 'ç¤ºä¾‹': 'SSH:192.168.1.100:22; Telnet:192.168.1.100:23' },
                        { 'å­—æ®µå': 'æ ‡ç­¾', 'è¯´æ˜': 'è®¾å¤‡æ ‡ç­¾ï¼Œå¤šä¸ªæ ‡ç­¾ç”¨é€—å·åˆ†éš”ï¼ˆå¯é€‰ï¼‰', 'ç¤ºä¾‹': 'iOS,æµ‹è¯•æœº,5G' }
                    ];
                    const wsInstructions = XLSX.utils.json_to_sheet(instructions);
                    wsInstructions['!cols'] = [
                        { wch: 15 },  // å­—æ®µå
                        { wch: 50 },  // è¯´æ˜
                        { wch: 40 }   // ç¤ºä¾‹
                    ];
                    
                    // åˆ›å»ºå·¥ä½œç°¿
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'è®¾å¤‡åˆ—è¡¨');
                    XLSX.utils.book_append_sheet(wb, wsInstructions, 'å­—æ®µè¯´æ˜');
                    
                    // ç”Ÿæˆæ–‡ä»¶åï¼ˆåŒ…å«å¯¼å‡ºæ—¶é—´ï¼‰
                    const now = new Date();
                    const dateStr = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}`;
                    const filename = `è®¾å¤‡åˆ—è¡¨_${dateStr}.xlsx`;
                    
                    // ä¸‹è½½æ–‡ä»¶
                    XLSX.writeFile(wb, filename);
                    
                    this.showMessage('å¯¼å‡ºæˆåŠŸ', `å·²å¯¼å‡º ${this.devices.length} æ¡è®¾å¤‡æ•°æ®`, 'success');
                },
                
                // ä¸‹è½½è®¾å¤‡å¯¼å…¥æ¨¡æ¿
                downloadDeviceExcelTemplate() {
                    // åˆ›å»ºç¤ºä¾‹æ•°æ®
                    const template = [
                        { 
                            'è®¾å¤‡åç§°': 'iPhone 13 Pro', 
                            'ç”¨æˆ·å': 'root', 
                            'å¯†ç ': '123456', 
                            'è¿æ¥ä¿¡æ¯': 'SSH:192.168.1.100:22; Telnet:192.168.1.100:23', 
                            'æ ‡ç­¾': 'iOS,æµ‹è¯•æœº,5G' 
                        },
                        { 
                            'è®¾å¤‡åç§°': 'MacBook Pro', 
                            'ç”¨æˆ·å': 'admin', 
                            'å¯†ç ': 'admin123', 
                            'è¿æ¥ä¿¡æ¯': 'SSH:192.168.1.101:22', 
                            'æ ‡ç­¾': 'macOS,å¼€å‘æœº' 
                        },
                        { 
                            'è®¾å¤‡åç§°': 'Ubuntu Server', 
                            'ç”¨æˆ·å': 'ubuntu', 
                            'å¯†ç ': 'ubuntu123', 
                            'è¿æ¥ä¿¡æ¯': 'SSH:192.168.1.102:22; Telnet:192.168.1.102:23', 
                            'æ ‡ç­¾': 'Linux,æœåŠ¡å™¨' 
                        }
                    ];
                    
                    // åˆ›å»ºè¯´æ˜å·¥ä½œè¡¨
                    const instructions = [
                        { 'å­—æ®µå': 'è®¾å¤‡åç§°', 'è¯´æ˜': 'è®¾å¤‡çš„å”¯ä¸€åç§°ï¼ˆå¿…å¡«ï¼‰', 'ç¤ºä¾‹': 'iPhone 13 Pro' },
                        { 'å­—æ®µå': 'ç”¨æˆ·å', 'è¯´æ˜': 'è®¾å¤‡ç™»å½•ç”¨æˆ·åï¼ˆå¯é€‰ï¼‰', 'ç¤ºä¾‹': 'root' },
                        { 'å­—æ®µå': 'å¯†ç ', 'è¯´æ˜': 'è®¾å¤‡ç™»å½•å¯†ç ï¼ˆå¯é€‰ï¼‰', 'ç¤ºä¾‹': '123456' },
                        { 'å­—æ®µå': 'è¿æ¥ä¿¡æ¯', 'è¯´æ˜': 'æ ¼å¼: ç±»å‹:IP:ç«¯å£\nå¤šä¸ªè¿æ¥ç”¨åˆ†å·åˆ†éš”\næ”¯æŒç±»å‹: SSHã€Telnet', 'ç¤ºä¾‹': 'SSH:192.168.1.100:22; Telnet:192.168.1.100:23' },
                        { 'å­—æ®µå': 'æ ‡ç­¾', 'è¯´æ˜': 'è®¾å¤‡æ ‡ç­¾ï¼Œå¤šä¸ªæ ‡ç­¾ç”¨é€—å·åˆ†éš”ï¼ˆå¯é€‰ï¼‰', 'ç¤ºä¾‹': 'iOS,æµ‹è¯•æœº,5G' }
                    ];
                    
                    // åˆ›å»ºå·¥ä½œè¡¨
                    const ws = XLSX.utils.json_to_sheet(template);
                    const wsInstructions = XLSX.utils.json_to_sheet(instructions);
                    
                    // è®¾ç½®åˆ—å®½
                    ws['!cols'] = [
                        { wch: 20 },  // è®¾å¤‡åç§°
                        { wch: 15 },  // ç”¨æˆ·å
                        { wch: 15 },  // å¯†ç 
                        { wch: 50 },  // è¿æ¥ä¿¡æ¯
                        { wch: 25 }   // æ ‡ç­¾
                    ];
                    
                    wsInstructions['!cols'] = [
                        { wch: 15 },  // å­—æ®µå
                        { wch: 50 },  // è¯´æ˜
                        { wch: 40 }   // ç¤ºä¾‹
                    ];
                    
                    // åˆ›å»ºå·¥ä½œç°¿
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'è®¾å¤‡åˆ—è¡¨');
                    XLSX.utils.book_append_sheet(wb, wsInstructions, 'å­—æ®µè¯´æ˜');
                    
                    // ä¸‹è½½æ–‡ä»¶
                    XLSX.writeFile(wb, 'è®¾å¤‡å¯¼å…¥æ¨¡æ¿.xlsx');
                    
                    this.showMessage('ä¸‹è½½æˆåŠŸ', 'æ¨¡æ¿æ–‡ä»¶å·²ä¸‹è½½ï¼Œè¯·æŒ‰ç…§æ ¼å¼å¡«å†™åå¯¼å…¥', 'success');
                },
                
                // è§¦å‘è®¾å¤‡Excelä¸Šä¼ 
                triggerDeviceExcelUpload() {
                    this.$refs.deviceExcelInput.click();
                },
                
                // å¤„ç†è®¾å¤‡Excelå¯¼å…¥
                async handleDeviceExcelUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                            
                            if (jsonData.length === 0) {
                                this.showMessage('å¯¼å…¥å¤±è´¥', 'Excelæ–‡ä»¶ä¸­æ²¡æœ‰æ•°æ®', 'error');
                                return;
                            }
                            
                            // è§£æè®¾å¤‡æ•°æ®
                            const devices = [];
                            const errors = [];
                            
                            jsonData.forEach((row, index) => {
                                try {
                                    const name = row['è®¾å¤‡åç§°'] || row['name'];
                                    
                                    if (!name) {
                                        errors.push(`ç¬¬${index + 2}è¡Œ: ç¼ºå°‘å¿…å¡«å­—æ®µï¼ˆè®¾å¤‡åç§°ï¼‰`);
                                        return;
                                    }
                                    
                                    // è§£æè¿æ¥ä¿¡æ¯
                                    const connectionStr = row['è¿æ¥ä¿¡æ¯'] || row['connections'] || '';
                                    const connections = [];
                                    if (connectionStr) {
                                        const connParts = connectionStr.split(';');
                                        connParts.forEach(conn => {
                                            const parts = conn.trim().split(':');
                                            if (parts.length === 3) {
                                                // æ‰€æœ‰è¿æ¥éƒ½æ˜¯: type:ip:port æ ¼å¼
                                                connections.push({
                                                    type: parts[0].trim(),
                                                    ip: parts[1].trim(),
                                                    port: parts[2].trim()
                                                });
                                            }
                                        });
                                    }
                                    
                                    // è§£ææ ‡ç­¾
                                    const tagsStr = row['æ ‡ç­¾'] || row['tags'] || '';
                                    const tags = tagsStr ? tagsStr.split(',').map(t => t.trim()).filter(t => t) : [];
                                    
                                    devices.push({
                                        name: name,
                                        username: row['ç”¨æˆ·å'] || row['username'] || '',
                                        password: row['å¯†ç '] || row['password'] || '',
                                        connections: connections,
                                        tags: tags
                                    });
                                } catch (err) {
                                    errors.push(`ç¬¬${index + 2}è¡Œ: ${err.message}`);
                                }
                            });
                            
                            if (errors.length > 0) {
                                this.showMessage('å¯¼å…¥è­¦å‘Š', `è§£æé”™è¯¯ï¼š\n${errors.join('\n')}`, 'warning');
                            }
                            
                            if (devices.length === 0) {
                                this.showMessage('å¯¼å…¥å¤±è´¥', 'æ²¡æœ‰æœ‰æ•ˆçš„è®¾å¤‡æ•°æ®', 'error');
                                return;
                            }
                            
                            // æ‰¹é‡å¯¼å…¥è®¾å¤‡
                            const response = await axios.post(`${this.apiBaseUrl}/devices/batch-import`, {
                                devices: devices
                            });
                            
                            this.showMessage('å¯¼å…¥æˆåŠŸ', `æˆåŠŸå¯¼å…¥ ${response.data.imported_count} æ¡è®¾å¤‡æ•°æ®`, 'success');
                            this.loadAllData();
                            
                        } catch (error) {
                            console.error('å¯¼å…¥å¤±è´¥ï¼š', error);
                            this.showMessage('å¯¼å…¥å¤±è´¥', error.response?.data?.message || error.message, 'error');
                        }
                    };
                    
                    reader.readAsArrayBuffer(file);
                    
                    // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                    event.target.value = '';
                },
                
                async confirmOccupy() {
                    if (!this.occupyForm.user_account) {
                        this.showMessage('éªŒè¯å¤±è´¥', 'è¯·å¡«å†™è´¦å·', 'error');
                        return;
                    }
                    
                    // å¦‚æœæœªç™»å½•ï¼Œæç¤ºéœ€è¦ç™»å½•
                    if (!this.isLoggedIn) {
                        this.showMessage('éœ€è¦ç™»å½•', 'è¯·å…ˆç™»å½•åå†å ç”¨è®¾å¤‡', 'error');
                        this.closeOccupyModal();
                        this.showUserLoginModal = true;
                        return;
                    }

                    try {
                        const response = await axios.post(`${this.apiBaseUrl}/devices/${this.occupyForm.deviceId}/occupy`, {
                            user_account: this.occupyForm.user_account,
                            purpose: this.occupyForm.purpose || 'æœªå¡«å†™',
                            duration: this.occupyForm.duration
                        });
                        this.showMessage('å ç”¨æˆåŠŸ', `è®¾å¤‡å·²è¢«å ç”¨ï¼Œå°†åœ¨${this.occupyForm.duration}å°æ—¶åè‡ªåŠ¨é‡Šæ”¾`, 'success');
                        this.closeOccupyModal();
                        this.loadAllData();
                    } catch (error) {
                        this.showMessage('å ç”¨å¤±è´¥', error.response?.data?.message || error.message, 'error');
                    }
                },
                
                async releaseDevice(deviceId) {
                    try {
                        await axios.post(`${this.apiBaseUrl}/devices/${deviceId}/release`);
                        this.showMessage('é‡Šæ”¾æˆåŠŸ', 'è®¾å¤‡å·²é‡Šæ”¾', 'success');
                        this.loadAllData();
                    } catch (error) {
                        this.showMessage('é‡Šæ”¾å¤±è´¥', error.response?.data?.message || error.message, 'error');
                    }
                },
                
                openConnection(device, connection) {
                    const connType = connection.type || 'SSH';
                    this.terminalInfo = {
                        title: `${connType} - ${device.name} (${connection.ip}:${connection.port})`
                    };
                    // é‡ç½®å¼¹çª—çŠ¶æ€
                    this.terminalMaximized = false;
                    this.terminalPosition = { x: 0, y: 0 };
                    this.showTerminalModal = true;
                    
                    // ç­‰å¾…DOMæ›´æ–°ååˆå§‹åŒ–ç»ˆç«¯
                    this.$nextTick(() => {
                        // ç¡®ä¿å¼¹çª—transformæ­£ç¡®
                        const modalContent = this.$refs.terminalModalContent;
                        if (modalContent) {
                            modalContent.style.transform = 'translate(-50%, -50%)';
                        }
                        this.initTerminal();
                        
                        if (connType === 'SSH') {
                            this.term.writeln('æ­£åœ¨å»ºç«‹SSHè¿æ¥...');
                            this.term.writeln(`ç›®æ ‡: ${connection.ip}:${connection.port}`);
                            this.term.writeln(`ç”¨æˆ·: ${device.username}`);
                            this.term.writeln('è¯·ç¨å€™...\r\n');
                            
                            const sessionId = 'ssh_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                            this.terminalSessionId = sessionId;
                            
                            if (this.socket && this.socket.connected) {
                                this.socket.emit('ssh_connect', {
                                    session_id: sessionId,
                                    host: connection.ip,
                                    port: parseInt(connection.port),
                                    username: device.username,
                                    password: device.password
                                });
                            } else {
                                this.term.writeln('\r\n========================================');
                                this.term.writeln('âŒ é”™è¯¯ï¼šWebSocketæœªè¿æ¥');
                                this.term.writeln('========================================');
                                this.term.writeln('è¯·åˆ·æ–°é¡µé¢é‡è¯•');
                            }
                        } else if (connType === 'Telnet') {
                            this.term.writeln('æ­£åœ¨å»ºç«‹Telnetè¿æ¥...');
                            this.term.writeln(`ç›®æ ‡: ${connection.ip}:${connection.port}`);
                            this.term.writeln('è¯·ç¨å€™...\r\n');
                            
                            const sessionId = 'telnet_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                            this.terminalSessionId = sessionId;
                            
                            if (this.socket && this.socket.connected) {
                                this.socket.emit('telnet_connect', {
                                    session_id: sessionId,
                                    host: connection.ip,
                                    port: parseInt(connection.port)
                                });
                            } else {
                                this.term.writeln('\r\n========================================');
                                this.term.writeln('âŒ é”™è¯¯ï¼šWebSocketæœªè¿æ¥');
                                this.term.writeln('========================================');
                                this.term.writeln('è¯·åˆ·æ–°é¡µé¢é‡è¯•');
                            }
                        }
                    });
                },
                
                openSSH(device, connection) {
                    // å…¼å®¹æ—§çš„è°ƒç”¨æ–¹å¼
                    this.openConnection(device, { ...connection, type: 'SSH' });
                },
                
                openSerial(device, connection) {
                    this.terminalInfo = {
                        title: `Telnet - ${device.name} (${connection.ip}:${connection.port})`
                    };
                    // é‡ç½®å¼¹çª—çŠ¶æ€
                    this.terminalMaximized = false;
                    this.terminalPosition = { x: 0, y: 0 };
                    this.showTerminalModal = true;
                    
                    // ç­‰å¾…DOMæ›´æ–°ååˆå§‹åŒ–ç»ˆç«¯
                    this.$nextTick(() => {
                        // ç¡®ä¿å¼¹çª—transformæ­£ç¡®
                        const modalContent = this.$refs.terminalModalContent;
                        if (modalContent) {
                            modalContent.style.transform = 'translate(-50%, -50%)';
                        }
                        this.initTerminal();
                        
                        this.term.writeln('æ­£åœ¨å»ºç«‹Telnetè¿æ¥...');
                        this.term.writeln(`ç›®æ ‡: ${connection.ip}:${connection.port}`);
                        this.term.writeln('è¯·ç¨å€™...\r\n');
                        
                        // ç”Ÿæˆå”¯ä¸€session_id
                        const sessionId = 'telnet_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        this.terminalSessionId = sessionId;
                        
                        // å‘é€Telnetè¿æ¥è¯·æ±‚
                        if (this.socket && this.socket.connected) {
                            this.socket.emit('telnet_connect', {
                                session_id: sessionId,
                                host: connection.ip,
                                port: parseInt(connection.port)
                            });
                        } else {
                            this.term.writeln('\r\n========================================');
                            this.term.writeln('âŒ é”™è¯¯ï¼šWebSocketæœªè¿æ¥');
                            this.term.writeln('========================================');
                            this.term.writeln('è¯·åˆ·æ–°é¡µé¢é‡è¯•');
                        }
                    });
                },
                
                initTerminal() {
                    // é”€æ¯æ—§ç»ˆç«¯
                    if (this.term) {
                        try {
                            this.term.dispose();
                        } catch (e) {
                            console.warn('Terminal disposal error:', e);
                        }
                        this.term = null;
                    }
                    this.fitAddon = null;
                    
                    // åˆ›å»ºæ–°ç»ˆç«¯
                    this.term = new Terminal({
                        cursorBlink: true,
                        fontSize: 14,
                        fontFamily: 'Courier New, monospace',
                        theme: {
                            background: '#000000',
                            foreground: '#ffffff',
                            cursor: '#00ff00',
                            cursorAccent: '#00ff00',
                            selection: 'rgba(255, 255, 255, 0.3)'
                        },
                        cols: 80,
                        rows: 24
                    });
                    
                    // åˆ›å»ºFitAddonç”¨äºè‡ªé€‚åº”å¤§å°
                    this.fitAddon = new FitAddon.FitAddon();
                    this.term.loadAddon(this.fitAddon);
                    
                    // æŒ‚è½½åˆ°DOM
                    const container = document.getElementById('xterm-container');
                    container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
                    this.term.open(container);
                    this.fitAddon.fit();
                    
                    // èšç„¦ç»ˆç«¯
                    this.term.focus();
                    
                    // ç›‘å¬ç”¨æˆ·è¾“å…¥
                    this.term.onData(data => {
                        if (this.socket && this.terminalSessionId) {
                            this.socket.emit('terminal_input', {
                                session_id: this.terminalSessionId,
                                data: data
                            });
                        }
                    });
                    
                    // çª—å£å¤§å°æ”¹å˜æ—¶è‡ªé€‚åº”
                    window.addEventListener('resize', () => {
                        if (this.fitAddon) {
                            this.fitAddon.fit();
                        }
                    });
                },
                
                closeTerminal() {
                    if (this.socket && this.terminalSessionId) {
                        this.socket.emit('close_terminal', {
                            session_id: this.terminalSessionId
                        });
                    }
                    
                    // é”€æ¯ç»ˆç«¯
                    if (this.term) {
                        try {
                            this.term.dispose();
                        } catch (e) {
                            console.warn('Terminal disposal error:', e);
                        }
                        this.term = null;
                    }
                    
                    this.fitAddon = null;
                    this.showTerminalModal = false;
                    this.terminalOutput = '';
                    this.terminalSessionId = null;
                    this.terminalMaximized = false;
                    this.terminalPosition = { x: 0, y: 0 };
                },

                toggleMaximizeTerminal() {
                    this.terminalMaximized = !this.terminalMaximized;
                    
                    // æœ€å¤§åŒ–æ—¶é‡ç½®æ‹–åŠ¨ä½ç½®
                    if (this.terminalMaximized) {
                        this.terminalPosition = { x: 0, y: 0 };
                        const modalContent = this.$refs.terminalModalContent;
                        if (modalContent) {
                            modalContent.style.transform = '';
                        }
                    }
                    
                    // æœ€å¤§åŒ–æˆ–è¿˜åŸåé‡æ–°è°ƒæ•´ç»ˆç«¯å¤§å°å¹¶èšç„¦
                    this.$nextTick(() => {
                        if (this.fitAddon && this.term) {
                            // ç¬¬ä¸€æ¬¡è°ƒæ•´
                            setTimeout(() => {
                                this.fitAddon.fit();
                            }, 50);
                            
                            // ç¬¬äºŒæ¬¡è°ƒæ•´ï¼ˆç¡®ä¿CSSåŠ¨ç”»å®Œæˆï¼‰
                            setTimeout(() => {
                                this.fitAddon.fit();
                                this.term.focus();
                            }, 200);
                            
                            // ç¬¬ä¸‰æ¬¡è°ƒæ•´ï¼ˆæœ€ç»ˆç¡®è®¤ï¼‰
                            setTimeout(() => {
                                this.fitAddon.fit();
                            }, 400);
                        }
                    });
                },

                startDragTerminal(e) {
                    // å¦‚æœæ˜¯æœ€å¤§åŒ–çŠ¶æ€ï¼Œä¸å…è®¸æ‹–åŠ¨
                    if (this.terminalMaximized) return;
                    
                    // åªæœ‰ç‚¹å‡»headeråŒºåŸŸæ‰èƒ½æ‹–åŠ¨ï¼ˆä¸åŒ…æ‹¬æŒ‰é’®ï¼‰
                    if (e.target.tagName === 'BUTTON' || e.target.closest('button')) return;
                    
                    this.terminalDragging = true;
                    this.terminalDragStart = {
                        x: e.clientX - this.terminalPosition.x,
                        y: e.clientY - this.terminalPosition.y
                    };
                    
                    document.addEventListener('mousemove', this.onDragTerminal);
                    document.addEventListener('mouseup', this.stopDragTerminal);
                    e.preventDefault();
                },

                onDragTerminal(e) {
                    if (!this.terminalDragging) return;
                    
                    const modalContent = this.$refs.terminalModalContent;
                    if (!modalContent) return;
                    
                    // è®¡ç®—æ–°ä½ç½®
                    let newX = e.clientX - this.terminalDragStart.x;
                    let newY = e.clientY - this.terminalDragStart.y;
                    
                    // è·å–å¼¹çª—å’Œè§†å£å°ºå¯¸
                    const modalRect = modalContent.getBoundingClientRect();
                    const modalWidth = modalRect.width;
                    const modalHeight = modalRect.height;
                    const viewportWidth = window.innerWidth;
                    const viewportHeight = window.innerHeight;
                    
                    // è®¡ç®—è¾¹ç•Œé™åˆ¶
                    const minX = -(viewportWidth / 2 - 100); // å·¦è¾¹ç•Œï¼Œè‡³å°‘ä¿ç•™100pxå¯è§
                    const maxX = viewportWidth / 2 - 100; // å³è¾¹ç•Œ
                    const minY = -(viewportHeight / 2 - 50); // ä¸Šè¾¹ç•Œï¼Œè‡³å°‘ä¿ç•™50pxï¼ˆheaderé«˜åº¦ï¼‰
                    const maxY = viewportHeight / 2 - 50; // ä¸‹è¾¹ç•Œ
                    
                    // é™åˆ¶åœ¨è¾¹ç•Œå†…
                    newX = Math.max(minX, Math.min(maxX, newX));
                    newY = Math.max(minY, Math.min(maxY, newY));
                    
                    this.terminalPosition = { x: newX, y: newY };
                    modalContent.style.transform = `translate(calc(-50% + ${newX}px), calc(-50% + ${newY}px))`;
                },

                stopDragTerminal() {
                    this.terminalDragging = false;
                    document.removeEventListener('mousemove', this.onDragTerminal);
                    document.removeEventListener('mouseup', this.stopDragTerminal);
                },

                handleTerminalDragOver(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const container = this.$refs.terminalContainer;
                    if (container && !container.classList.contains('drag-over')) {
                        container.classList.add('drag-over');
                    }
                },

                handleTerminalDragLeave(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const container = this.$refs.terminalContainer;
                    if (container && e.target === container) {
                        container.classList.remove('drag-over');
                    }
                },

                handleTerminalFileDrop(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const container = this.$refs.terminalContainer;
                    if (container) {
                        container.classList.remove('drag-over');
                    }

                    const files = e.dataTransfer.files;
                    if (files.length === 0) {
                        return;
                    }

                    const file = files[0];
                    
                    // æ–‡ä»¶å¤§å°é™åˆ¶ï¼š1GB
                    const maxSize = 1024 * 1024 * 1024;
                    if (file.size > maxSize) {
                        if (this.term) {
                            this.term.writeln(`\r\nâŒ é”™è¯¯: æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ (æœ€å¤§1GB)\r\n`);
                        }
                        return;
                    }
                    
                    // æ˜¾ç¤ºä¸Šä¼ ä¿¡æ¯
                    if (this.term) {
                        this.term.writeln(`\r\nğŸ“¤ å‡†å¤‡ä¸Šä¼ æ–‡ä»¶: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`);
                        this.term.writeln(`â³ æ­£åœ¨è¯»å–æ–‡ä»¶...\r\n`);
                    }

                    // è¯»å–æ–‡ä»¶å¹¶é€šè¿‡WebSocketå‘é€
                    const reader = new FileReader();
                    
                    // è¯»å–è¿›åº¦
                    reader.onprogress = (e) => {
                        if (e.lengthComputable && this.term) {
                            const percentComplete = Math.round((e.loaded / e.total) * 100);
                            // ä½¿ç”¨ \r å›åˆ°è¡Œé¦–æ›´æ–°è¿›åº¦
                            this.term.write(`\rğŸ“– è¯»å–è¿›åº¦: ${percentComplete}%`);
                        }
                    };
                    
                    reader.onload = (event) => {
                        const fileData = event.target.result;
                        
                        if (this.term) {
                            this.term.writeln(`\rğŸ“– è¯»å–è¿›åº¦: 100%`);
                        }
                        
                        if (this.socket && this.socket.connected && this.terminalSessionId) {
                            if (this.term) {
                                this.term.writeln(`â³ æ­£åœ¨ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨...\r\n`);
                            }
                            
                            const startTime = Date.now();
                            
                            // å‘é€æ–‡ä»¶ä¸Šä¼ è¯·æ±‚
                            try {
                                this.socket.emit('upload_file', {
                                    session_id: this.terminalSessionId,
                                    filename: file.name,
                                    filedata: fileData,
                                    filesize: file.size
                                }, (response) => {
                                    // ä¸Šä¼ å®Œæˆå›è°ƒ
                                    const duration = ((Date.now() - startTime) / 1000).toFixed(2);
                                    
                                    if (response && response.error) {
                                        if (this.term) {
                                            this.term.writeln(`âŒ ä¸Šä¼ å¤±è´¥: ${response.error}\r\n`);
                                        }
                                    } else {
                                        if (this.term) {
                                            this.term.writeln(`âœ… ä¸Šä¼ å®Œæˆï¼è€—æ—¶: ${duration}ç§’\r\n`);
                                        }
                                    }
                                });
                                
                                // æ¨¡æ‹Ÿä¸Šä¼ è¿›åº¦ï¼ˆå› ä¸ºSocket.IO emitä¸æ”¯æŒåŸç”Ÿè¿›åº¦ï¼‰
                                let progress = 0;
                                const progressInterval = setInterval(() => {
                                    if (progress < 90) {
                                        progress += 10;
                                        if (this.term) {
                                            this.term.write(`\râ¬†ï¸  ä¸Šä¼ è¿›åº¦: ${progress}%`);
                                        }
                                    } else {
                                        clearInterval(progressInterval);
                                    }
                                }, 200);
                                
                                // æ¸…ç†å®šæ—¶å™¨
                                setTimeout(() => {
                                    clearInterval(progressInterval);
                                    if (this.term) {
                                        this.term.write(`\râ¬†ï¸  ä¸Šä¼ è¿›åº¦: 100%\r\n`);
                                    }
                                }, 5000);
                                
                            } catch (error) {
                                if (this.term) {
                                    this.term.writeln(`âŒ å‘é€å¤±è´¥: ${error.message}\r\n`);
                                }
                            }
                        } else {
                            if (this.term) {
                                this.term.writeln(`âŒ é”™è¯¯: Socket.IOæœªè¿æ¥æˆ–ä¼šè¯æ— æ•ˆ\r\n`);
                            }
                        }
                    };
                    
                    reader.onerror = () => {
                        if (this.term) {
                            this.term.writeln(`âŒ é”™è¯¯: æ–‡ä»¶è¯»å–å¤±è´¥\r\n`);
                        }
                    };
                    
                    reader.readAsDataURL(file);
                },
                
                dragOver(e) {
                    e.currentTarget.classList.add('dragover');
                },
                
                handleDrop(e) {
                    e.currentTarget.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.uploadFile(files[0]);
                    }
                },
                
                handleFileUpload(e) {
                    const file = e.target.files[0];
                    if (file) {
                        this.uploadFile(file);
                    }
                },
                
                uploadFile(file) {
                    this.showMessage('ä¸Šä¼ æ–‡ä»¶', `æ–‡ä»¶ ${file.name} å‡†å¤‡ä¸Šä¼ \n\næ­¤åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒï¼Œå½“å‰ä¸ºæ¼”ç¤ºæ¨¡å¼ã€‚`, 'info');
                },
                
                confirmAction(title, message, onConfirm) {
                    this.confirmDialog = {
                        show: true,
                        title: title,
                        message: message,
                        type: 'warning',
                        icon: 'âš ï¸',
                        onConfirm: onConfirm
                    };
                },
                
                showMessage(title, message, type = 'success') {
                    const icons = {
                        success: 'âœ…',
                        error: 'âŒ',
                        warning: 'âš ï¸',
                        info: 'â„¹ï¸'
                    };
                    
                    this.messageDialog = {
                        show: true,
                        title: title,
                        message: message,
                        type: type,
                        icon: icons[type] || icons.info
                    };
                },
                
                async checkConnection() {
                    try {
                        await axios.get(`${this.apiBaseUrl}/health`, { timeout: 3000 });
                        if (this.connectionStatus === 'offline') {
                            this.showMessage('è¿æ¥æ¢å¤', 'å·²æˆåŠŸè¿æ¥åˆ°åç«¯æœåŠ¡å™¨', 'success');
                            this.loadAllData(); // é‡æ–°åŠ è½½æ•°æ®
                        }
                        this.connectionStatus = 'online';
                    } catch (error) {
                        this.connectionStatus = 'offline';
                    }
                },
                
                retryConnection() {
                    this.connectionStatus = 'checking';
                    this.checkConnection();
                },
                
                // Socket.IOç›¸å…³æ–¹æ³•
                initSocket() {
                    try {
                        this.socket = io({
                            transports: ['polling'],
                            upgrade: false,
                            reconnection: true,
                            reconnectionDelay: 1000,
                            reconnectionAttempts: 10,
                            timeout: 60000,
                            pingTimeout: 60000,
                            pingInterval: 25000
                        });
                        
                        this.socket.on('connect', () => {
                            console.log('Socket.IOå·²è¿æ¥');
                        });
                        
                        this.socket.on('disconnect', (reason) => {
                            // åªåœ¨éæ­£å¸¸æ–­å¼€æ—¶æ˜¾ç¤ºè­¦å‘Š
                            if (reason !== 'io client disconnect' && reason !== 'io server disconnect') {
                                console.warn('Socket.IOè¿æ¥æ–­å¼€:', reason);
                            } else {
                                console.log('Socket.IOå·²æ–­å¼€');
                            }
                        });
                        
                        this.socket.on('reconnect', (attemptNumber) => {
                            console.log('Socket.IOé‡è¿æˆåŠŸï¼Œå°è¯•æ¬¡æ•°:', attemptNumber);
                        });
                        
                        this.socket.on('reconnect_error', (error) => {
                            console.error('Socket.IOé‡è¿å¤±è´¥:', error);
                        });
                        
                        // SSH/Telnetè¿æ¥æˆåŠŸ
                        this.socket.on('terminal_connected', (data) => {
                            this.terminalSessionId = data.session_id;
                            if (this.term) {
                                this.term.writeln('\r\n========================================');
                                this.term.writeln(`âœ… ${data.type === 'ssh' ? 'SSH' : 'Telnet'} è¿æ¥æˆåŠŸï¼`);
                                this.term.writeln('========================================');
                                this.term.writeln(`ä¼šè¯ID: ${data.session_id}`);
                                if (data.message) {
                                    this.term.writeln(data.message);
                                }
                                this.term.writeln('\r\næ‚¨ç°åœ¨å¯ä»¥è¾“å…¥å‘½ä»¤äº†...\r\n');
                            }
                        });
                        
                        // æ¥æ”¶ç»ˆç«¯è¾“å‡º
                        this.socket.on('terminal_output', (data) => {
                            if (data.session_id === this.terminalSessionId && this.term) {
                                // xterm.js è‡ªåŠ¨å¤„ç†æ‰€æœ‰ANSIç å’Œæ§åˆ¶å­—ç¬¦
                                this.term.write(data.data);
                            }
                        });
                        
                        // è¿æ¥é”™è¯¯
                        this.socket.on('terminal_error', (data) => {
                            if (this.term) {
                                this.term.writeln('\r\n\r\n========================================');
                                this.term.writeln('âŒ è¿æ¥å¤±è´¥');
                                this.term.writeln('========================================');
                                this.term.writeln(`é”™è¯¯ä¿¡æ¯: ${data.error}`);
                                this.term.writeln('\r\nè¯·æ£€æŸ¥:');
                                this.term.writeln('1. ç›®æ ‡ä¸»æœºIPå’Œç«¯å£æ˜¯å¦æ­£ç¡®');
                                this.term.writeln('2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸');
                                this.term.writeln('3. SSH/TelnetæœåŠ¡æ˜¯å¦å·²å¯åŠ¨');
                                this.term.writeln('4. ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®ï¼ˆSSHï¼‰');
                                this.term.writeln('========================================');
                            }
                        });
                        
                        // è¿æ¥å…³é—­
                        this.socket.on('terminal_closed', (data) => {
                            if (data.session_id === this.terminalSessionId && this.term) {
                                this.term.writeln('\r\n\r\nè¿æ¥å·²å…³é—­');
                            }
                        });
                        
                    } catch (error) {
                        console.error('Socket.IOåˆå§‹åŒ–å¤±è´¥:', error);
                    }
                }
                // è¿™äº›å‡½æ•°å·²ä¸å†éœ€è¦ï¼Œxterm.js è‡ªåŠ¨å¤„ç†æ‰€æœ‰ç»ˆç«¯é€»è¾‘
            }
        }).mount('#app');
    </script>
</body>
</html>
